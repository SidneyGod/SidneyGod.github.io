<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.2.0"><link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin><link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.ico"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.ico"><link rel="mask-icon" href="/images/logo.svg" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" integrity="sha256-DfWjNxDkM94fVBWx1H5BMMp0Zq7luBlV8QRcSES7s+0=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/pink/pace-theme-minimal.css"><script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script><script class="next-config" data-name="main" type="application/json">{"hostname":"sidneyding.cn","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.12.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":"mac"},"bookmark":{"enable":true,"color":"#222","save":"auto"},"mediumzoom":true,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":true,"nav":null},"stickytabs":true,"motion":{"enable":true,"async":true,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script><link rel="canonical" href="https://sidneyding.cn/"><script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"en","comments":"","permalink":"","path":"index.html","title":""}</script><script class="next-config" data-name="calendar" type="application/json">""</script><title>Sidney God</title><script src="/lib/fireworks.js"></script><script>let titleTime,originTitile=document.title;document.addEventListener("visibilitychange",(function(){let i=document.querySelector('link[rel="icon"]');document.hidden?(i.setAttribute("href","/images/favicon.ico"),document.title="(つェ⊂) 我藏好了哦~"+originTitile,clearTimeout(titleTime)):(i.setAttribute("href","/images/favicon.ico"),document.title="(*´∇｀*) 被你发现啦~"+originTitile,titleTime=setTimeout((function(){document.title=originTitile}),2e3))}))</script><noscript><link rel="stylesheet" href="/css/noscript.css"></noscript><style>mjx-container[jax="SVG"] {
  direction: ltr;
}

mjx-container[jax="SVG"] > svg {
  overflow: visible;
}

mjx-container[jax="SVG"][display="true"] {
  display: block;
  text-align: center;
  margin: 1em 0;
}

mjx-container[jax="SVG"][justify="left"] {
  text-align: left;
}

mjx-container[jax="SVG"][justify="right"] {
  text-align: right;
}

g[data-mml-node="merror"] > g {
  fill: red;
  stroke: red;
}

g[data-mml-node="merror"] > rect[data-background] {
  fill: yellow;
  stroke: none;
}

g[data-mml-node="mtable"] > line[data-line] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > rect[data-frame] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > .mjx-dashed {
  stroke-dasharray: 140;
}

g[data-mml-node="mtable"] > .mjx-dotted {
  stroke-linecap: round;
  stroke-dasharray: 0,140;
}

g[data-mml-node="mtable"] > svg {
  overflow: visible;
}

[jax="SVG"] mjx-tool {
  display: inline-block;
  position: relative;
  width: 0;
  height: 0;
}

[jax="SVG"] mjx-tool > mjx-tip {
  position: absolute;
  top: 0;
  left: 0;
}

mjx-tool > mjx-tip {
  display: inline-block;
  padding: .2em;
  border: 1px solid #888;
  font-size: 70%;
  background-color: #F8F8F8;
  color: black;
  box-shadow: 2px 2px 5px #AAAAAA;
}

g[data-mml-node="maction"][data-toggle] {
  cursor: pointer;
}

mjx-status {
  display: block;
  position: fixed;
  left: 1em;
  bottom: 1em;
  min-width: 25%;
  padding: .2em .4em;
  border: 1px solid #888;
  font-size: 90%;
  background-color: #F8F8F8;
  color: black;
}

foreignObject[data-mjx-xml] {
  font-family: initial;
  line-height: normal;
  overflow: visible;
}

.MathJax path {
  stroke-width: 3;
}

mjx-container[display="true"] {
  overflow: auto hidden;
}

mjx-container[display="true"] + br {
  display: none;
}
</style><link rel="alternate" href="/atom.xml" title="Sidney God" type="application/atom+xml">
</head><body itemscope itemtype="http://schema.org/WebPage" class="use-motion"><div class="headband"></div><main class="main"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="Toggle navigation bar" role="button"><span class="toggle-line"></span> <span class="toggle-line"></span> <span class="toggle-line"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><i class="logo-line"></i><h1 class="site-title">Sidney God</h1><i class="logo-line"></i></a><p class="site-subtitle" itemprop="description">Keep quiet time for time</p></div><div class="site-nav-right"><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags<span class="badge">19</span></a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories<span class="badge">6</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives<span class="badge">27</span></a></li><li class="menu-item menu-item-resources"><a href="/resources/" rel="section"><i class="fa fa-book fa-fw"></i>Resources</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"><input autocomplete="off" autocapitalize="off" maxlength="80" placeholder="Searching..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close" role="button"><i class="fa fa-times-circle"></i></span></div><div class="search-result-container no-result"><div class="search-result-icon"><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></div><div class="toggle sidebar-toggle" role="button"><span class="toggle-line"></span> <span class="toggle-line"></span> <span class="toggle-line"></span></div><aside class="sidebar"><div class="sidebar-inner sidebar-overview-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc">Catalogue</li><li class="sidebar-nav-overview">Overview</li></ul><div class="sidebar-panel-container"><div class="post-toc-wrap sidebar-panel"></div><div class="site-overview-wrap sidebar-panel"><div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" alt="Sidney Ding" src="/images/avatar.png"><p class="site-author-name" itemprop="name">Sidney Ding</p><div class="site-description" itemprop="description">You laugh at me for being different, but I laugh at you for being the same.</div></div><div class="site-state-wrap site-overview-item animated"><nav class="site-state"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">27</span> <span class="site-state-item-name">posts</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/"><span class="site-state-item-count">6</span> <span class="site-state-item-name">categories</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/"><span class="site-state-item-count">19</span> <span class="site-state-item-name">tags</span></a></div></nav></div><div class="links-of-author site-overview-item animated"><span class="links-of-author-item"><a href="https://github.com/SidneyGod" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;SidneyGod" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a> </span><span class="links-of-author-item"><a href="mailto:sidneyding183@gmail.com" title="E-Mail → mailto:sidneyding183@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a></span></div><div class="cc-license site-overview-item animated" itemprop="license"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en" class="cc-opacity" rel="noopener" target="_blank"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a></div><div class="links-of-blogroll site-overview-item animated"><div class="links-of-blogroll-title"><i class="fa fa-globe fa-fw"></i> Links</div><ul class="links-of-blogroll-list"><li class="links-of-blogroll-item"><a href="https://google.com/" title="https:&#x2F;&#x2F;google.com" rel="noopener" target="_blank">Google</a></li><li class="links-of-blogroll-item"><a href="https://bing.com/" title="https:&#x2F;&#x2F;bing.com" rel="noopener" target="_blank">Bing</a></li></ul></div></div></div><div class="back-to-top animated" role="button" aria-label="Back to top"><i class="fa fa-arrow-up"></i> <span>0%</span></div></div></aside><div class="sidebar-dimmer"></div></header><div class="reading-progress-bar"></div><a role="button" class="book-mark-link book-mark-link-fixed"></a> <a href="https://github.com/SidneyGod" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><div class="main-inner index posts-expand"><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content"><link itemprop="mainEntityOfPage" href="https://sidneyding.cn/posts/3f345216/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.png"><meta itemprop="name" content="Sidney Ding"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Sidney God"><meta itemprop="description" content="You laugh at me for being different, but I laugh at you for being the same."></span><span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="undefined | Sidney God"><meta itemprop="description" content=""></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/posts/3f345216/" class="post-title-link" itemprop="url">[Make MyOS] Start Again</a></h2><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">Posted on</span> <time title="Created: 2025-06-25 23:41:11 / Modified: 23:47:22" itemprop="dateCreated datePublished" datetime="2025-06-25T23:41:11+08:00">2025-06-25</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">In</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/OS/" itemprop="url" rel="index"><span itemprop="name">OS</span></a> </span>, <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/OS/Make-OS/" itemprop="url" rel="index"><span itemprop="name">Make OS</span></a> </span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i> </span><span class="post-meta-item-text">Changyan: </span><a title="[Make MyOS] Start Again" href="/posts/3f345216/#SOHUCS" itemprop="discussionUrl"><span id="sourceId::1c87d0bd5f5406bf6317aa10619d8f0c" class="cy_cmt_count" itemprop="commentCount"></span> </a></span><span class="post-meta-break"></span> <span class="post-meta-item" title="Symbols count in article"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">Symbols count in article: </span><span>5.8k</span> </span><span class="post-meta-item" title="Reading time"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span class="post-meta-item-text">Reading time &asymp;</span> <span>5 mins.</span></span></div></div></header><div class="post-body" itemprop="articleBody"><p>主要是受打击了..md..太多不会了，又重新拾起来了，这次为了方便也不搞什么虚拟机了，所有环境完全在Win10上，主要是笔记本有点破，再搞个虚拟机有点吃不消了..所以参考了下各种教程，最终使用vscode + gdb + qemu的组合..或许qemu会换成Bochs..</p><h1 id="1-环境搭建"><a href="#1-环境搭建" class="headerlink" title="1 环境搭建"></a>1 环境搭建</h1><h2 id="1-1-gcc工具链"><a href="#1-1-gcc工具链" class="headerlink" title="1.1 gcc工具链"></a>1.1 gcc工具链</h2><p>可以去这个github：<a target="_blank" rel="noopener" href="https://github.com/blessingwater/GCC_x86_64-elf-tools-windows">https://github.com/blessingwater/GCC_x86_64-elf-tools-windows</a> 下载，解压之后添加环境变量即可</p><table><thead><tr><th>解压</th><th>设置环境变量</th><th>命令行验证</th></tr></thead><tbody><tr><td><img data-src="/assets/07_Make-MyOS-Again/image-20250621205003547.png" alt="image-20250621205003547"></td><td><img data-src="/assets/07_Make-MyOS-Again/image-20250621205106657.png" alt="image-20250621205106657"></td><td><img data-src="/assets/07_Make-MyOS-Again/image-20250621205328909.png" alt="image-20250621205328909"></td></tr></tbody></table><p>TODO 有时间折腾一下交叉编译工具链：<a target="_blank" rel="noopener" href="https://wiki.osdev.org/GCC_Cross-Compiler">https://wiki.osdev.org/GCC_Cross-Compiler</a></p><h2 id="1-2-CMake"><a href="#1-2-CMake" class="headerlink" title="1.2 CMake"></a>1.2 CMake</h2><p>去 <a target="_blank" rel="noopener" href="https://cmake.org/download/">https://cmake.org/download/</a> 下载Windwos版本安装即可，添加到系统环境变量，能执行<code>cmake --version</code>就可以了</p><h2 id="1-3-安装GCC"><a href="#1-3-安装GCC" class="headerlink" title="1.3 安装GCC"></a>1.3 安装GCC</h2><p>主要是为了要make命令，去github下载、解压即可：<a target="_blank" rel="noopener" href="https://github.com/niXman/mingw-builds-binaries/releases">https://github.com/niXman/mingw-builds-binaries/releases</a></p><p>解压后在bin目录有个可执行文件<code>mingw32-make.exe</code>，这个就是我们需要的<code>make</code>命令，改成<code>make.exe</code>加环境变量就好了</p><p><img data-src="/assets/07_Make-MyOS-Again/image-20250625214843502.png" alt="image-20250625214843502"></p><h2 id="1-4-Qemu"><a href="#1-4-Qemu" class="headerlink" title="1.4 Qemu"></a>1.4 Qemu</h2><p>去 <a target="_blank" rel="noopener" href="https://qemu.eu/w64/">https://qemu.eu/w64/</a> 下载最新的安装即可，记得添加的系统环境变量</p><p>TODO 自己下载源码编译：<a target="_blank" rel="noopener" href="https://www.qemu.org/download/">https://www.qemu.org/download/</a></p><h2 id="1-4-Other"><a href="#1-4-Other" class="headerlink" title="1.4 Other"></a>1.4 Other</h2><p>VS Code，Git啥的就不说了</p><h1 id="2-操作系统启动"><a href="#2-操作系统启动" class="headerlink" title="2 操作系统启动"></a>2 操作系统启动</h1><p>一篇老文档：<a target="_blank" rel="noopener" href="https://manybutfinite.com/post/how-computers-boot-up/">How Computers Boot Up | Many But Finite</a></p><p>细节部分可以下载Intel手册：<a target="_blank" rel="noopener" href="https://www.intel.cn/content/www/cn/zh/developer/articles/technical/intel-sdm.html">Manuals for Intel® 64 and IA-32 Architectures</a></p><p><img data-src="/assets/07_Make-MyOS-Again/image-20250622184950150.png" alt="image-20250622184950150"></p><p>x86_64系统上电后的启动流程（参考卷3：PROCESSOR MANAGEMENT AND INITIALIZATION）大致如下：</p><h2 id="2-1-上电与硬件复位"><a href="#2-1-上电与硬件复位" class="headerlink" title="2.1 上电与硬件复位"></a>2.1 上电与硬件复位</h2><p>电源供应稳定后，主板上的硬件复位电路会发出一个复位信号；</p><p>CPU强制进入一个已知的初始状态：将所有寄存器重置为预设值，消除系统断电或异常导致的随机状态，确保可预测的启动环境，同时大部分功能单元也会被禁用（如缓存、超线程、多核）；</p><p>控制寄存器CR0状态设置为<code>60000010H</code>，此时处理器进入<strong>实地址模式</strong>。下图是部分寄存器的初始值<img data-src="/assets/07_Make-MyOS-Again/image-20250622153336796.png" alt="image-20250622153336796"></p><p>注意几个重要的寄存器值：指令指针寄存器<code>EIP=0000FFF0H</code>，代码段寄存器CS的Selector为<code>F000H</code>，通用寄存器EDX表示处理器型号（0000B）、系列（1111B）、处理器类型（00B）。</p><h2 id="2-2-处理器内置自检（BIST，Build-In-Self-Test）"><a href="#2-2-处理器内置自检（BIST，Build-In-Self-Test）" class="headerlink" title="2.2 处理器内置自检（BIST，Build-In Self Test）"></a>2.2 处理器内置自检（BIST，Build-In Self Test）</h2><p>这是<strong>可选项</strong>。硬件可要求在开机时执行BIST，若处理器通过了BIST，则将EAX寄存器置0H；非零值表示检测到处理器故障。如果未请求BIST，硬件复位后EAX内容亦为0H。</p><p>一般就是逻辑电路测试、内存测试、时序测试</p><h2 id="2-3-执行第一条指令"><a href="#2-3-执行第一条指令" class="headerlink" title="2.3 执行第一条指令"></a>2.3 执行第一条指令</h2><p>上面提到了<strong>实地址模式</strong>，是CPU的一种工作模式，该模式下A20地址线默认被禁用，CPU只能通过20位地址线<strong>直接访问物理内存</strong>，即最大寻址空间为FFFFFH，1MB（$$2^{20}&#x3D;1048576 B$$）。</p><p>CPU从复位状态释放后，根据预定义的初始设置（Intel和AMD规定固定物理地址<code>FFFFFFF0H</code>），从<strong>固件</strong>（BIOS或UEFI）的ROM芯片中读取第一条指令。</p><p>在实模式下，<code>物理地址 = CS.Selector &lt;&lt; 4 + IP</code>，这里CS偏移4位刚好是20位。所以第一条指令物理地址为：<code>F000H &lt;&lt; 4 + FFF0H = F0000H + FFF0H = FFFF0H</code>，计算出来的物理地址并不是实际执行的<code>FFFFFFF0H</code>。问题核心在于<strong>硬件对地址空间的特殊映射</strong>，<strong>硬件强制高位地址线（A20~A31或更高）&#x3D; 1</strong>。</p><p>为什么要选择<code>FFFFFFF0H</code>作为第一条指令？一个兼容，另一个就是灵活。开机第一件事是读取固件（BIOS&#x2F;UEFI），其实<code>FFFFFFF0H</code>的位置就是固件ROM的末尾，并且是一条跳转指令，<strong>跳转到固件启动代码位置</strong>。每家计算机生产厂商生产的机器外设不同，所以其固件程序大小不尽相同，有的可能是1K，有的可能是2K，如果把固件程序放在0x0000处，那么会造成在机器A上用户写的程序是从<code>0x0400</code>开始，机器B上用户写的程序就是<code>0x0800</code>开始，非常不统一。如果把这程序放在1M内存的顶部，再规定计算机第一条指令位置是<code>FFFFFFF0H</code>，然后就跳到各家固件开始处，那么用户写的程序都可以从<code>0x0000</code>开始了。</p><h2 id="2-4-固件阶段（BIOS-x2F-UEFI）"><a href="#2-4-固件阶段（BIOS-x2F-UEFI）" class="headerlink" title="2.4 固件阶段（BIOS&#x2F;UEFI）"></a>2.4 固件阶段（BIOS&#x2F;UEFI）</h2><p>开机自检(POST，Power-On Self-Test)：执行加电自检，检测关键硬件（CPU、内存、显卡、存储控制器）是否正常工作。如有故障，会通过蜂鸣码或LED灯报告。</p><p>硬件初始化：初始化芯片组、内存控制器、配置RAM（执行内存检测如MemTest，建立内存映射）、初始化基本显示输出（VGA&#x2F;文本模式）、初始化基本输入（键盘控制器）、枚举PCI&#x2F;PCIe设备、初始化存储控制器（SATA, NVMe）等。</p><p>固件运行时服务设置：建立供后续阶段（OS Loader）调用的服务接口。</p><p>启动设备选择：根据用户配置（Boot Order）或默认顺序，查找可启动设备（硬盘、SSD、USB、网络PXE等）。</p><p>加载并移交控制权：从选定的启动设备上找到并加载<strong>第一阶段引导加载程序</strong>（通常是磁盘上的 MBR 或 EFI 分区中的 <code>.efi</code> 文件）到内存，并将 CPU 控制权交给它。</p><p>BIOS：工作在16位实模式。启动设备查找基于磁盘的<strong>主引导记录</strong>。将MBR的512字节内容加载到物理地址 <code>0x7C00</code>。控制权交给<code>0x7C00</code>处的MBR代码。分区和文件系统认知有限（依赖MBR和VBR）、仅支持16位代码、寻址空间小、安全性差。</p><p>UEFI：大部分代码运行在<strong>32位保护模式</strong>或<strong>64位长模式</strong>（取决于固件实现）。使用<strong>GUID分区表</strong>。直接在EFI 系统分区上查找并加载<strong>EFI应用程序</strong>（通常是<code>\EFI\BOOT\BOOTX64.EFI</code> 或操作系统特定的加载器如 <code>\EFI\Microsoft\Boot\bootmgfw.efi</code>）。使用UEFI提供的<strong>Boot Services</strong>和<strong>Runtime Services</strong>进行硬件访问、内存分配、文件系统操作等。支持大容量磁盘、独立于文件系统的启动加载、模块化设计、安全启动、图形化界面、更快启动速度。</p><h2 id="2-5-引导加载程序阶段"><a href="#2-5-引导加载程序阶段" class="headerlink" title="2.5 引导加载程序阶段"></a>2.5 引导加载程序阶段</h2><p>这个阶段的任务是<strong>找到并加载操作系统内核</strong>，并为其执行做好环境准备（特别是模式切换）。</p><p>BIOS：</p><ul><li>MBR（Stage 1）：位于磁盘第一个扇区（512字节）。主要职责是查找活动分区，将该分区的卷引导记录加载到内存（通常是<code>0x7C00</code>），并跳转执行。</li><li>VBR（Stage 1.5&#x2F;Stage 2）：位于活动分区起始扇区。包含更复杂的代码，能理解特定文件系统（如FAT32, NTFS, ext4）。它的职责是在文件系统中查找并加载第二阶段引导加载程序到内存并执行。</li><li>第二阶段引导加载程序（Stage 2）：提供用户界面（可选菜单）、加载配置文件、加载操作系统内核映像和初始内存盘到内存。它负责进行从16位实模式到32位保护模式再到64位长模式的切换。最终，准备好内核需要的参数（如命令行、内存布局信息），并跳转到内核的入口点。</li></ul><p>UEFI：</p><ul><li>UEFI Boot Manager：根据NVRAM中的启动项配置，直接加载指定的OS Loader。这个加载器本身就是一个UEFI应用程序。</li><li>OS Loader（EFI App）：由UEFI直接加载到内存并执行。它运行在UEFI提供的环境（保护模式&#x2F;长模式）下。主要职责是：使用 UEFI Boot Services 访问文件系统，<strong>加载操作系统内核映像</strong>和<strong>初始内存盘</strong>；解析启动配置数据；为内核准备启动信息；通知UEFI固件，操作系统即将接管，UEFI会回收其占用的内存并将硬件控制权完全移交给OS Loader&#x2F;内核；跳转到内核的入口点，此时CPU通常已由UEFI或OS Loader置于<strong>64 位长模式</strong></li></ul><h2 id="2-6-操作系统内核初始化"><a href="#2-6-操作系统内核初始化" class="headerlink" title="2.6 操作系统内核初始化"></a>2.6 操作系统内核初始化</h2><p>CPU 控制权正式移交到<strong>操作系统内核</strong>的入口点（如Linux的<code>startup_64()</code>，Windows的<code>KiSystemStartup()</code>）。</p><p><strong>早期内核初始化</strong>：设置内核自己的页表、建立终端描述符表、初始化内存管理子系统、解析bootloader传来的参数……</p><p><strong>中后期内核初始化</strong>：解压并挂载初始内存盘、执行更全面的硬件探测和驱动程序初始化、挂载根文件系统、初始化进程管理和调度器、启动用户空间第一个进程</p><h2 id="2-7-用户空间初始化"><a href="#2-7-用户空间初始化" class="headerlink" title="2.7 用户空间初始化"></a>2.7 用户空间初始化</h2><p>由第一个用户空间进程负责：读取系统配置文件、启动系统服务……</p><h1 id="3-Hello-MyOS"><a href="#3-Hello-MyOS" class="headerlink" title="3 Hello MyOS"></a>3 Hello MyOS</h1><p>固件的东西不在本次考虑范围内了，系统制作仅从bootloader开始。Bootloader引导程序由两部构成：boot引导程序负责开机启动和加载loader引导程序；loader引导程序用于完成配置硬件工作环境、引导加载内核。</p><p>当BIOS自检结束后会根据启动选项设置去选择启动设备，即检测软盘的第0磁头第0磁道第1扇区，是否以<code>0x55aa</code>作为结尾。如果是，那么BIOS就认为这个扇区是一个引导扇区（Boot Sector），进而把这个扇区的数据复制到物理内存地址<strong>0x7c00</strong>处，随后将处理器的执行权移交给这段程序（跳转至<code>0x7c00</code>地址处执行）。</p><p>一个扇区的总容量仅有512B，去掉两字节<code>0x55aa</code>，就只剩下510字节，容量太小了只能作为一级引导程序来加载二级引导程序Loader。</p><p>写个Hello World试试手，文件树如下：</p><p><img data-src="/assets/07_Make-MyOS-Again/image-20250625221920519.png" alt="image-20250625221920519"></p><p>其中<code>image</code>是生成的用于加载的镜像，<code>out</code>是生成的中间文件以及elf等，<code>ref</code>放一些参考文件，<code>script</code>放一下好用的脚本，<code>src</code>就是系统的源码了</p><p>因为不是nasm来编译，而是<code>x86_64_elf_gcc</code>来编译，所以汇编语法略有变化，叫GAS汇编</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"># 指定以下代码生成16位的机器指令，确保可以在实模式下运行</span><br><span class="line">.code16</span><br><span class="line"></span><br><span class="line"># 声明本地以下符号是全局的，在其他源文件中可以访问</span><br><span class="line">.global _start</span><br><span class="line"></span><br><span class="line"># 代码段地址开始</span><br><span class="line">.section .text</span><br><span class="line"></span><br><span class="line">_start:</span><br><span class="line">    xor %ax, %ax  # ax = 0</span><br><span class="line">    mov %ax, %ds</span><br><span class="line">    mov %ax, %es</span><br><span class="line">    mov %ax, %ss</span><br><span class="line"></span><br><span class="line">    # 设置栈指针sp指向0x7c00 栈向低地址增长 0x7c00 -&gt; 0x0000</span><br><span class="line">    mov $_start, %sp</span><br><span class="line">    </span><br><span class="line">    # 设置显示模式为 80x25 16色文本模式</span><br><span class="line">    mov $0x0003, %ax</span><br><span class="line">    int $0x10</span><br><span class="line"></span><br><span class="line">    # clear screen</span><br><span class="line">    mov $0x0600, %ax</span><br><span class="line">    mov $0x0700, %bx</span><br><span class="line">    xor %cx, %cx</span><br><span class="line">    mov $0x184f, %dx</span><br><span class="line">    int $0x10</span><br><span class="line"></span><br><span class="line">    # set focus</span><br><span class="line">    mov $0x0200, %ax</span><br><span class="line">    xor %bx, %bx</span><br><span class="line">    xor %dx, %dx</span><br><span class="line">    int $0x10</span><br><span class="line"></span><br><span class="line">    # display msg on screen</span><br><span class="line">    mov $0x1301, %ax</span><br><span class="line">    mov $0x0007, %bx</span><br><span class="line">    mov $StartBootMsg, %bp  # 放入字符串</span><br><span class="line">    mov $StartBootMsgLen, %cx  # 字符串长度</span><br><span class="line">    xor %dx, %dx</span><br><span class="line">    int $0x10</span><br><span class="line"></span><br><span class="line">    # reset floppy</span><br><span class="line">    xor %ah, %ah</span><br><span class="line">    xor %dl, %dl</span><br><span class="line">    int $0x13    # 重置磁盘</span><br><span class="line"></span><br><span class="line">halt:</span><br><span class="line">    cli       # 禁用中断</span><br><span class="line">    hlt       # 暂停CPU</span><br><span class="line">    jmp halt  # 无限循环 双重保险</span><br><span class="line"></span><br><span class="line"># 定义一个字符串:</span><br><span class="line">#   .string &quot;...&quot; 定义未自动加0的字符串</span><br><span class="line">#   .asciz &quot;...&quot;  定义以0结尾的字符串</span><br><span class="line">StartBootMsg: .string &quot;Sidney DING, Start Boot......&quot;</span><br><span class="line"># 定义常量表达式，用于保存静态长度. 当前位置计数器减去msg的起始地址，得到字符串长度</span><br><span class="line">StartBootMsgLen = . - StartBootMsg</span><br><span class="line"></span><br><span class="line"># 伪指令 跳到 510 字节处，填充 0x55aa 可改成 .byte 0x55, 0xaa</span><br><span class="line">.org 0x01fe</span><br><span class="line">.word 0xaa55</span><br></pre></td></tr></table></figure><p>基本主要就是向屏幕输出了一串字符串，BIOS中断参考<code>ref/BIOS-interrupts.pdf</code>即可，然后此时的内存布局应当如下</p><table><thead><tr><th align="left">地址范围</th><th align="left">内容</th><th align="left">大小</th></tr></thead><tbody><tr><td align="left">0x00000-0x003FF</td><td align="left">中断向量表</td><td align="left">1KB</td></tr><tr><td align="left">0x00400-0x004FF</td><td align="left">BIOS 数据区</td><td align="left">256B</td></tr><tr><td align="left">0x00500-0x07BFF</td><td align="left">空闲内存</td><td align="left">~30KB</td></tr><tr><td align="left"><strong>0x07C00-0x07DFF</strong></td><td align="left"><strong>引导程序</strong></td><td align="left"><strong>512B</strong></td></tr><tr><td align="left">0x07E00-0x9FFFF</td><td align="left">可用内存</td><td align="left">~608KB</td></tr></tbody></table><ol><li>为什么是<code>0x7c00</code>？</li></ol><p>很久很久以前，这个值是<code>0x200</code>，关于这个<code>0x200</code>大概有三个原因：一是8086中断向量使用<code>0x0 - 0x3FF</code>，二是86-DOS从<code>0x400</code>加载，三是86-DOS不使用<code>0x200 - 0x3FF</code>之间的中断向量。这些原因意味着需要保留<code>0x200 - 0x3FF</code>，而且无论86-DOS或用户应用程序想在哪里加载，都不能妨碍操作系统。因此Tim Paterson（86-DOS开发者）选择<code>0x200</code>作为MBR加载地址。</p><p><code>0x7C00</code>由IBM PC 5150 BIOS开发团队（David Bradley 博士）决定的。因为当时认为DOS1.0最少需要32KB，为了让操作系统有一个连续的内存空间，尽量把启动扇区的位置放到内存的尾部，启动扇区是512字节，除此之外启动扇区的堆栈&#x2F;数据区还需空间，又预留了512字节。因此，<code>0x7c00 = 32K - 1024B</code></p><ol start="2"><li>为什么是<code>0x55aa</code>？</li></ol><p>首先，1字节不够可靠（可能随机出现），2字节组合概率：1&#x2F;65536（足够安全）。这俩数字是完美的0、1交替序列<code>01010101 10101010</code>，早期软盘的物理表现：产生稳定的250KHz方波（对模拟电路友好）</p><blockquote><p>“我们需要一个不可能随机出现的模式。55 AA 的交替位模式在损坏时仍保留可识别特征，且电气特性上产生独特的电压波动，这对软盘驱动器识别扇区结束至关重要。”<br>—— David Bradley, IBM PC BIOS 首席设计师</p></blockquote></div><footer class="post-footer"><div class="post-eof"></div></footer></article></div><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content"><link itemprop="mainEntityOfPage" href="https://sidneyding.cn/posts/1c3367f4/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.png"><meta itemprop="name" content="Sidney Ding"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Sidney God"><meta itemprop="description" content="You laugh at me for being different, but I laugh at you for being the same."></span><span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="undefined | Sidney God"><meta itemprop="description" content=""></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/posts/1c3367f4/" class="post-title-link" itemprop="url">Compile system app with AndroidStudio</a></h2><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">Posted on</span> <time title="Created: 2022-10-16 11:51:07" itemprop="dateCreated datePublished" datetime="2022-10-16T11:51:07+08:00">2022-10-16</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">Edited on</span> <time title="Modified: 2025-06-25 23:36:28" itemprop="dateModified" datetime="2025-06-25T23:36:28+08:00">2025-06-25</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">In</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Other/" itemprop="url" rel="index"><span itemprop="name">Other</span></a> </span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i> </span><span class="post-meta-item-text">Changyan: </span><a title="Compile system app with AndroidStudio" href="/posts/1c3367f4/#SOHUCS" itemprop="discussionUrl"><span id="sourceId::7c4e462e90b9ced1a3d4e6adc3db5e7d" class="cy_cmt_count" itemprop="commentCount"></span> </a></span><span class="post-meta-break"></span> <span class="post-meta-item" title="Symbols count in article"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">Symbols count in article: </span><span>11k</span> </span><span class="post-meta-item" title="Reading time"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span class="post-meta-item-text">Reading time &asymp;</span> <span>10 mins.</span></span></div></div></header><div class="post-body" itemprop="articleBody"><p>作为OS研发，在framework加点api，写个apk验证想法是常有的事，什么系统api，隐藏api更是想用就用，怎么能被<code>@hide</code>限制？所以一般的写的apk都是集成在系统源码里面，比如Settings，加上系统签名，这样确实没有<code>@hide</code>限制了，但是这样基本都是基于记事本开发，没有IDE的提示来得舒服，但是用Android Studio打开，由于原生sdk的限制，调用隐藏的api或咱们自己加的api会报红，这代码写起来就不爽。所以咱就是要整个两者兼得的方法，核心是两点，一是系统的jar包，也就是sdk；二是platform签名，没有签名认证，是安装不了的</p><p>关于sdk，咱们手上有源码是可以自己编译的，直接<code>lunch sdk-eng</code>，整编就好了，出来个啥，不大清楚，没用过，这里不用这个法子，此处选择用哪个模块导入哪个模块的jar包；系统签名相信就按着步骤来生成就好了</p><div class="post-button"><a class="btn" href="/posts/1c3367f4/#more" rel="contents">Read more &raquo;</a></div></div><footer class="post-footer"><div class="post-eof"></div></footer></article></div><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content"><link itemprop="mainEntityOfPage" href="https://sidneyding.cn/posts/e304028/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.png"><meta itemprop="name" content="Sidney Ding"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Sidney God"><meta itemprop="description" content="You laugh at me for being different, but I laugh at you for being the same."></span><span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="undefined | Sidney God"><meta itemprop="description" content=""></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/posts/e304028/" class="post-title-link" itemprop="url">[Make MyOS] Starting kernel</a></h2><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">Posted on</span> <time title="Created: 2022-07-24 22:53:35" itemprop="dateCreated datePublished" datetime="2022-07-24T22:53:35+08:00">2022-07-24</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">Edited on</span> <time title="Modified: 2025-06-25 23:38:58" itemprop="dateModified" datetime="2025-06-25T23:38:58+08:00">2025-06-25</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">In</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/OS/" itemprop="url" rel="index"><span itemprop="name">OS</span></a> </span>, <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/OS/Make-OS/" itemprop="url" rel="index"><span itemprop="name">Make OS</span></a> </span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i> </span><span class="post-meta-item-text">Changyan: </span><a title="[Make MyOS] Starting kernel" href="/posts/e304028/#SOHUCS" itemprop="discussionUrl"><span id="sourceId::5ade0cac900c70a9a3b69c96d879aa80" class="cy_cmt_count" itemprop="commentCount"></span> </a></span><span class="post-meta-break"></span> <span class="post-meta-item" title="Symbols count in article"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">Symbols count in article: </span><span>9k</span> </span><span class="post-meta-item" title="Reading time"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span class="post-meta-item-text">Reading time &asymp;</span> <span>8 mins.</span></span></div></div></header><div class="post-body" itemprop="articleBody"><p>上一节loader程序装载完kernel后，执行了<code>jmp SelectorCode64:OffsetOfKernelFile</code>命令跳转到kernel部分了，意味着Loader将处理的控制权交给了Kernel</p><blockquote><p><strong>处理器把控制权交给kernel后，kernel最先执行的是内核执行头程序。内核执行头程序是一段精心设计的汇编代码，而且必须借助特殊的编译链接方法才能得到最先执行。</strong></p><p>内核头程序负责为操作系统创建段结构和页表结构，设置某些结构的默认处理函数、配置关键寄存器等工作。在完成上述工作后，依然要借助远跳指令才能进入系统内核主程序。</p><p>如何将内核执行头程序编译生成到整个内核程序文件的起始处？手动编写内核程序的链接脚本，在内核程序的链接过程中，链接器会按照链接脚本描述的地址空间布局，把编译好的各个程序片段填充到内核程序文件中。</p></blockquote><p>看完有点懵，都是内核程序为啥要咱手动指定谁先谁后？大概是因为内核头是汇编写的，内核是c写的..要让head先执行就得在lds中指定第一条指令是啥..编译部分参考哈: <a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/504742628">ld - 链接脚本学习笔记与实践过程</a></p><div class="post-button"><a class="btn" href="/posts/e304028/#more" rel="contents">Read more &raquo;</a></div></div><footer class="post-footer"><div class="post-eof"></div></footer></article></div><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content"><link itemprop="mainEntityOfPage" href="https://sidneyding.cn/posts/ebc737d8/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.png"><meta itemprop="name" content="Sidney Ding"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Sidney God"><meta itemprop="description" content="You laugh at me for being different, but I laugh at you for being the same."></span><span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="undefined | Sidney God"><meta itemprop="description" content=""></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/posts/ebc737d8/" class="post-title-link" itemprop="url">Optimize hexo</a></h2><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">Posted on</span> <time title="Created: 2022-07-04 23:26:03" itemprop="dateCreated datePublished" datetime="2022-07-04T23:26:03+08:00">2022-07-04</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">Edited on</span> <time title="Modified: 2022-07-24 23:01:38" itemprop="dateModified" datetime="2022-07-24T23:01:38+08:00">2022-07-24</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">In</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Other/" itemprop="url" rel="index"><span itemprop="name">Other</span></a> </span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i> </span><span class="post-meta-item-text">Changyan: </span><a title="Optimize hexo" href="/posts/ebc737d8/#SOHUCS" itemprop="discussionUrl"><span id="sourceId::3014801b47b4cdf6593e4eba52fea685" class="cy_cmt_count" itemprop="commentCount"></span> </a></span><span class="post-meta-break"></span> <span class="post-meta-item" title="Symbols count in article"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">Symbols count in article: </span><span>5.4k</span> </span><span class="post-meta-item" title="Reading time"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span class="post-meta-item-text">Reading time &asymp;</span> <span>5 mins.</span></span></div></div></header><div class="post-body" itemprop="articleBody"><p>之前gitee图床挂了，然后gitee想用pages也必须用身份证，折腾一整最后放弃了gitee，直接用github好了(还是github靠谱)，本想着研究一下hugo，但是新东西费时间啊，就继续使用hexo+next了，算是升了个级，并且添加了github CI，解决环境，部署问题，一个字，爽！</p><p>首先搭建hexo博客步骤还是和 <a target="_blank" rel="noopener" href="https://sidneygod.github.io/posts/c969bad9/">Use hexo + github to build a blog | Sidney God</a> 一样，按照步骤做就好了，注意这里不要去改node_modules源码了(好像除了markdown和mathjax冲突，也没啥需要改的，kmarked不适用新版本hexo，别折腾了..)，环境部署麻烦</p><div class="post-button"><a class="btn" href="/posts/ebc737d8/#more" rel="contents">Read more &raquo;</a></div></div><footer class="post-footer"><div class="post-eof"></div></footer></article></div><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content"><link itemprop="mainEntityOfPage" href="https://sidneyding.cn/posts/ffccb7c5/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.png"><meta itemprop="name" content="Sidney Ding"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Sidney God"><meta itemprop="description" content="You laugh at me for being different, but I laugh at you for being the same."></span><span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="undefined | Sidney God"><meta itemprop="description" content=""></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/posts/ffccb7c5/" class="post-title-link" itemprop="url">[Make MyOS] Find kernel</a></h2><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">Posted on</span> <time title="Created: 2022-01-16 21:54:41" itemprop="dateCreated datePublished" datetime="2022-01-16T21:54:41+08:00">2022-01-16</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">Edited on</span> <time title="Modified: 2022-07-19 23:10:22" itemprop="dateModified" datetime="2022-07-19T23:10:22+08:00">2022-07-19</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">In</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/OS/" itemprop="url" rel="index"><span itemprop="name">OS</span></a> </span>, <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/OS/Make-OS/" itemprop="url" rel="index"><span itemprop="name">Make OS</span></a> </span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i> </span><span class="post-meta-item-text">Changyan: </span><a title="[Make MyOS] Find kernel" href="/posts/ffccb7c5/#SOHUCS" itemprop="discussionUrl"><span id="sourceId::e698f94222e8890b1f35fd855238c8a2" class="cy_cmt_count" itemprop="commentCount"></span> </a></span><span class="post-meta-break"></span> <span class="post-meta-item" title="Symbols count in article"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">Symbols count in article: </span><span>38k</span> </span><span class="post-meta-item" title="Reading time"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span class="post-meta-item-text">Reading time &asymp;</span> <span>35 mins.</span></span></div></div></header><div class="post-body" itemprop="articleBody"><p>《64位》比《32位》多了一步loader.bin似乎，《32位》的下一步直接就是导入C语言，开始搞系统了，《64位》还得再来个loader，接着干吧..这一节很重要，承上启下，甚至于内容也是</p><p>这次把书上的源码上传的gitee了: <a target="_blank" rel="noopener" href="https://gitee.com/SidneyGod/make-os/tree/master/00_一个64位操作系统的设计与实现/一个64位操作系统的设计与实现-源代码/第二部分 初级篇/第3章/程序/程序3-4">00_一个64位操作系统的设计与实现/一个64位操作系统的设计与实现-源代码/第二部分 初级篇/第3章/程序/程序3-4 · Sidney/MakeOS - 码云 - 开源中国 (gitee.com)</a></p><p>书上说，Loader的作用很大，大概包括：</p><ul><li><p>检测硬件信息</p><p>主要是通过BIOS中断服务程序来获取和检测硬件信息。BIOS上电自检的大部分信息只能在实模式下获取，内核运行在非实模式下，所以需要在进入内核前将信息检测出来，再作为参数提供给内核程序使用。比如获取ROM，RAM，设备寄存器和内存空洞等资源的物理地址范围交给内存管理单元模块维护；通过VBE功能检测出显示器支持的分辨率，显示模式，刷新率以及显存物理地址以配置合理的显示模式</p></li><li><p>处理器模式切换</p><p>BIOS运行的实模式到32位操作系统用的保护模式，再到64位操作系统用的IA-32e模式(长模式)</p></li><li><p>向内核传递数据</p><p>向内核传递两种数据，控制信息：控制内核执行流程或限制内核某些功能；硬件数据信息：检测出来的硬件数据信息，保存在固定的内存地址中，并将数据其实内存地址和数据长度作为参数传递给内核。</p></li></ul><div class="post-button"><a class="btn" href="/posts/ffccb7c5/#more" rel="contents">Read more &raquo;</a></div></div><footer class="post-footer"><div class="post-eof"></div></footer></article></div><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content"><link itemprop="mainEntityOfPage" href="https://sidneyding.cn/posts/a4707db6/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.png"><meta itemprop="name" content="Sidney Ding"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Sidney God"><meta itemprop="description" content="You laugh at me for being different, but I laugh at you for being the same."></span><span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="undefined | Sidney God"><meta itemprop="description" content=""></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/posts/a4707db6/" class="post-title-link" itemprop="url">[Make MyOS] Basic execution env & Interrupt</a></h2><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">Posted on</span> <time title="Created: 2021-12-21 23:31:33" itemprop="dateCreated datePublished" datetime="2021-12-21T23:31:33+08:00">2021-12-21</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">Edited on</span> <time title="Modified: 2023-08-13 10:41:56" itemprop="dateModified" datetime="2023-08-13T10:41:56+08:00">2023-08-13</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">In</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/OS/" itemprop="url" rel="index"><span itemprop="name">OS</span></a> </span>, <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/OS/Make-OS/" itemprop="url" rel="index"><span itemprop="name">Make OS</span></a> </span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i> </span><span class="post-meta-item-text">Changyan: </span><a title="[Make MyOS] Basic execution env & Interrupt" href="/posts/a4707db6/#SOHUCS" itemprop="discussionUrl"><span id="sourceId::44e905bd07d2094ffe81d8ceb50a3cb8" class="cy_cmt_count" itemprop="commentCount"></span> </a></span><span class="post-meta-break"></span> <span class="post-meta-item" title="Symbols count in article"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">Symbols count in article: </span><span>24k</span> </span><span class="post-meta-item" title="Reading time"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span class="post-meta-item-text">Reading time &asymp;</span> <span>22 mins.</span></span></div></div></header><div class="post-body" itemprop="articleBody"><h1 id="1-执行环境介绍"><a href="#1-执行环境介绍" class="headerlink" title="1 执行环境介绍"></a>1 执行环境介绍</h1><p>在find loader那一节之后，发现后面的代码真的看不懂了，直接抄也没有意义，于是补了一下相关的知识..希望能继续下去</p><h2 id="1-1-CPU工作模式"><a href="#1-1-CPU工作模式" class="headerlink" title="1.1 CPU工作模式"></a>1.1 CPU工作模式</h2><p>参考Intel手册卷3第2.2 MODES OF OPERATION</p><p>32位的支持三种工作模式和一种准工作模式</p><ul><li><p>实地址模式(Real-address mode)，处理器上电(power-up)或复位(reset)后处于该模式。这个模式实际上是为了兼容8086，因为地址线只有20根，限制了寻址只能是1M大小，也就是通过<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align:-.452ex" xmlns="http://www.w3.org/2000/svg" width="26.774ex" height="2.149ex" role="img" focusable="false" viewBox="0 -750 11834 950"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">段</text></g><g data-mml-node="mi" transform="translate(1000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">寄</text></g><g data-mml-node="mi" transform="translate(2000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">存</text></g><g data-mml-node="mi" transform="translate(3000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">器</text></g><g data-mml-node="mo" transform="translate(4277.8,0)"><g data-mml-node="text"><path data-c="3C" d="M694 -11T694 -19T688 -33T678 -40Q671 -40 524 29T234 166L90 235Q83 240 83 250Q83 261 91 266Q664 540 678 540Q681 540 687 534T694 519T687 505Q686 504 417 376L151 250L417 124Q686 -4 687 -5Q694 -11 694 -19Z"></path></g><g data-mml-node="text" transform="translate(778,0)"><path data-c="3C" d="M694 -11T694 -19T688 -33T678 -40Q671 -40 524 29T234 166L90 235Q83 240 83 250Q83 261 91 266Q664 540 678 540Q681 540 687 534T694 519T687 505Q686 504 417 376L151 250L417 124Q686 -4 687 -5Q694 -11 694 -19Z"></path></g></g><g data-mml-node="mn" transform="translate(6111.6,0)"><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path></g><g data-mml-node="mo" transform="translate(6833.8,0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path></g><g data-mml-node="mi" transform="translate(7834,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">偏</text></g><g data-mml-node="mi" transform="translate(8834,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">移</text></g><g data-mml-node="mi" transform="translate(9834,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">地</text></g><g data-mml-node="mi" transform="translate(10834,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">址</text></g></g></g></svg></mjx-container>方式寻址。进入这个模式，也就只使用20根地址线，主要是因为A20M#引脚被屏蔽了</p></li><li><p>保护模式(Protected mode)，这个是80386时期引入的，也就是32位处理器原本的工作模式。在这个模式下不再使用<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align:-.452ex" xmlns="http://www.w3.org/2000/svg" width="26.774ex" height="2.149ex" role="img" focusable="false" viewBox="0 -750 11834 950"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">段</text></g><g data-mml-node="mi" transform="translate(1000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">寄</text></g><g data-mml-node="mi" transform="translate(2000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">存</text></g><g data-mml-node="mi" transform="translate(3000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">器</text></g><g data-mml-node="mo" transform="translate(4277.8,0)"><g data-mml-node="text"><path data-c="3C" d="M694 -11T694 -19T688 -33T678 -40Q671 -40 524 29T234 166L90 235Q83 240 83 250Q83 261 91 266Q664 540 678 540Q681 540 687 534T694 519T687 505Q686 504 417 376L151 250L417 124Q686 -4 687 -5Q694 -11 694 -19Z"></path></g><g data-mml-node="text" transform="translate(778,0)"><path data-c="3C" d="M694 -11T694 -19T688 -33T678 -40Q671 -40 524 29T234 166L90 235Q83 240 83 250Q83 261 91 266Q664 540 678 540Q681 540 687 534T694 519T687 505Q686 504 417 376L151 250L417 124Q686 -4 687 -5Q694 -11 694 -19Z"></path></g></g><g data-mml-node="mn" transform="translate(6111.6,0)"><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path></g><g data-mml-node="mo" transform="translate(6833.8,0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path></g><g data-mml-node="mi" transform="translate(7834,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">偏</text></g><g data-mml-node="mi" transform="translate(8834,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">移</text></g><g data-mml-node="mi" transform="translate(9834,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">地</text></g><g data-mml-node="mi" transform="translate(10834,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">址</text></g></g></g></svg></mjx-container>的方式寻址，而是通过段描述符的方式描述基址和限长，并通过描述符中的属性设置实现对内存段的访问限制和数据保护。</p></li><li><p>虚拟8086模式(Virtual-8086 mode)，是一种准工作模式，目的是为了在保护模式下能够执行8086程序</p><div class="post-button"><a class="btn" href="/posts/a4707db6/#more" rel="contents">Read more &raquo;</a></div></li></ul></div><footer class="post-footer"><div class="post-eof"></div></footer></article></div><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content"><link itemprop="mainEntityOfPage" href="https://sidneyding.cn/posts/1d4ddf18/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.png"><meta itemprop="name" content="Sidney Ding"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Sidney God"><meta itemprop="description" content="You laugh at me for being different, but I laugh at you for being the same."></span><span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="undefined | Sidney God"><meta itemprop="description" content=""></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/posts/1d4ddf18/" class="post-title-link" itemprop="url">[Make MyOS] Find loader</a></h2><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">Posted on</span> <time title="Created: 2021-10-31 23:05:46" itemprop="dateCreated datePublished" datetime="2021-10-31T23:05:46+08:00">2021-10-31</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">Edited on</span> <time title="Modified: 2023-08-13 10:39:20" itemprop="dateModified" datetime="2023-08-13T10:39:20+08:00">2023-08-13</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">In</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/OS/" itemprop="url" rel="index"><span itemprop="name">OS</span></a> </span>, <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/OS/Make-OS/" itemprop="url" rel="index"><span itemprop="name">Make OS</span></a> </span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i> </span><span class="post-meta-item-text">Changyan: </span><a title="[Make MyOS] Find loader" href="/posts/1d4ddf18/#SOHUCS" itemprop="discussionUrl"><span id="sourceId::cef697158484b4d00b38c39383c7c3b4" class="cy_cmt_count" itemprop="commentCount"></span> </a></span><span class="post-meta-break"></span> <span class="post-meta-item" title="Symbols count in article"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">Symbols count in article: </span><span>13k</span> </span><span class="post-meta-item" title="Reading time"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span class="post-meta-item-text">Reading time &asymp;</span> <span>12 mins.</span></span></div></div></header><div class="post-body" itemprop="articleBody"><p>说是第三天，我看了该一个星期了..发现之前看得有点浮躁，最近看了费曼读书法有了新的想法，不怕慢，就怕没看明白，所以听费曼的，每次看卡壳了，就返回去重新看..</p><p>看到这里，突然觉得还是以《64位》为主比较好，《32位》太老了，用的还是nask转换起来有点累，并且《64位》介绍得细啊，所以我悟了，《32位》用来打辅助吧..</p><h1 id="1-软盘与FAT12"><a href="#1-软盘与FAT12" class="headerlink" title="1 软盘与FAT12"></a>1 软盘与FAT12</h1><p>先来看软盘，一个PC里面可以有多个软盘，一个软盘里面包含2个磁头，80个柱面，18个扇区。因为软盘正反面都可以存储数据，所以有俩磁头去读取数据。柱面参考下图(注意编号0~79)，英文是cylinder；扇区参考下图(注意编号1~18)，英文是sector</p><div class="post-button"><a class="btn" href="/posts/1d4ddf18/#more" rel="contents">Read more &raquo;</a></div></div><footer class="post-footer"><div class="post-eof"></div></footer></article></div><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content"><link itemprop="mainEntityOfPage" href="https://sidneyding.cn/posts/c0d78c8f/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.png"><meta itemprop="name" content="Sidney Ding"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Sidney God"><meta itemprop="description" content="You laugh at me for being different, but I laugh at you for being the same."></span><span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="undefined | Sidney God"><meta itemprop="description" content=""></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/posts/c0d78c8f/" class="post-title-link" itemprop="url">[Make MyOS] Make a boot</a></h2><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">Posted on</span> <time title="Created: 2021-09-05 22:48:41" itemprop="dateCreated datePublished" datetime="2021-09-05T22:48:41+08:00">2021-09-05</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">Edited on</span> <time title="Modified: 2023-08-13 10:36:19" itemprop="dateModified" datetime="2023-08-13T10:36:19+08:00">2023-08-13</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">In</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/OS/" itemprop="url" rel="index"><span itemprop="name">OS</span></a> </span>, <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/OS/Make-OS/" itemprop="url" rel="index"><span itemprop="name">Make OS</span></a> </span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i> </span><span class="post-meta-item-text">Changyan: </span><a title="[Make MyOS] Make a boot" href="/posts/c0d78c8f/#SOHUCS" itemprop="discussionUrl"><span id="sourceId::54f0c7801c1daa861b0d0cb1f73c4787" class="cy_cmt_count" itemprop="commentCount"></span> </a></span><span class="post-meta-break"></span> <span class="post-meta-item" title="Symbols count in article"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">Symbols count in article: </span><span>8.4k</span> </span><span class="post-meta-item" title="Reading time"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span class="post-meta-item-text">Reading time &asymp;</span> <span>8 mins.</span></span></div></div></header><div class="post-body" itemprop="articleBody"><p>第二天的内容本该是，学习一些汇编指令和Makefile，在这之前我觉得有必要好好看看CPU结构，自古操作系统和组成原理就分不开啊</p><p>面向总线的计算机组成示意图。中央处理器，从主存储器中逐条进行取指令，分析指令和执行指令。计算机各组件通过总线连在一起，总线是一些平行导线的集合，用来传递地址，数据和控制信号，可以在CPU之外连接CPU，存储器及IO设备；也可以在CPU内部连接CPU的各个组成部分。</p><div class="post-button"><a class="btn" href="/posts/c0d78c8f/#more" rel="contents">Read more &raquo;</a></div></div><footer class="post-footer"><div class="post-eof"></div></footer></article></div><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content"><link itemprop="mainEntityOfPage" href="https://sidneyding.cn/posts/307d30a/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.png"><meta itemprop="name" content="Sidney Ding"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Sidney God"><meta itemprop="description" content="You laugh at me for being different, but I laugh at you for being the same."></span><span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="undefined | Sidney God"><meta itemprop="description" content=""></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/posts/307d30a/" class="post-title-link" itemprop="url">[Make MyOS] Hello MyOS!</a></h2><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">Posted on</span> <time title="Created: 2021-08-21 21:20:47" itemprop="dateCreated datePublished" datetime="2021-08-21T21:20:47+08:00">2021-08-21</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">Edited on</span> <time title="Modified: 2022-07-03 17:09:39" itemprop="dateModified" datetime="2022-07-03T17:09:39+08:00">2022-07-03</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">In</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/OS/" itemprop="url" rel="index"><span itemprop="name">OS</span></a> </span>, <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/OS/Make-OS/" itemprop="url" rel="index"><span itemprop="name">Make OS</span></a> </span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i> </span><span class="post-meta-item-text">Changyan: </span><a title="[Make MyOS] Hello MyOS!" href="/posts/307d30a/#SOHUCS" itemprop="discussionUrl"><span id="sourceId::a25aea6ac3ff3361328941e2949c3697" class="cy_cmt_count" itemprop="commentCount"></span> </a></span><span class="post-meta-break"></span> <span class="post-meta-item" title="Symbols count in article"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">Symbols count in article: </span><span>5.7k</span> </span><span class="post-meta-item" title="Reading time"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span class="post-meta-item-text">Reading time &asymp;</span> <span>5 mins.</span></span></div></div></header><div class="post-body" itemprop="articleBody"><p>这是30天的第一天内容，也不知道自己能坚持到几天，有几天就几天了，活这么久了，半途而废的事情还少吗？</p><p>首先需要准备几个工具</p><h1 id="1-qemu"><a href="#1-qemu" class="headerlink" title="1 qemu"></a>1 qemu</h1><p>不可能真去买个软盘什么的，所以我们需要一个虚拟计算机的东西——QEMU</p><div class="post-button"><a class="btn" href="/posts/307d30a/#more" rel="contents">Read more &raquo;</a></div></div><footer class="post-footer"><div class="post-eof"></div></footer></article></div><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content"><link itemprop="mainEntityOfPage" href="https://sidneyding.cn/posts/32699cc/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.png"><meta itemprop="name" content="Sidney Ding"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Sidney God"><meta itemprop="description" content="You laugh at me for being different, but I laugh at you for being the same."></span><span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="undefined | Sidney God"><meta itemprop="description" content=""></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a href="/posts/32699cc/" class="post-title-link" itemprop="url">[Make MyOS] After power on</a></h2><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">Posted on</span> <time title="Created: 2021-08-21 21:09:12" itemprop="dateCreated datePublished" datetime="2021-08-21T21:09:12+08:00">2021-08-21</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">Edited on</span> <time title="Modified: 2023-08-13 10:32:28" itemprop="dateModified" datetime="2023-08-13T10:32:28+08:00">2023-08-13</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">In</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/OS/" itemprop="url" rel="index"><span itemprop="name">OS</span></a> </span>, <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/OS/Make-OS/" itemprop="url" rel="index"><span itemprop="name">Make OS</span></a> </span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i> </span><span class="post-meta-item-text">Changyan: </span><a title="[Make MyOS] After power on" href="/posts/32699cc/#SOHUCS" itemprop="discussionUrl"><span id="sourceId::d953d09c840dc99729beefd1efb5a453" class="cy_cmt_count" itemprop="commentCount"></span> </a></span><span class="post-meta-break"></span> <span class="post-meta-item" title="Symbols count in article"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">Symbols count in article: </span><span>7.2k</span> </span><span class="post-meta-item" title="Reading time"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span class="post-meta-item-text">Reading time &asymp;</span> <span>7 mins.</span></span></div></div></header><div class="post-body" itemprop="articleBody"><p>学习嘛，当然要有浓厚的兴趣先，所以需要百度学习了一下，按下电源键之后的故事。操作系统这玩意虽说玄乎，但是参考资料还是很多的</p><p>参考书籍是《30天自制操作系统》和《一个64位操作系统的设计与实现》，以30天为主，但是这玩意用的是Windows环境，这显然是不友好的，最终选择环境位Ubuntu18，能换的都换换呗</p><p>Intel手册：<a target="_blank" rel="noopener" href="https://software.intel.com/content/www/us/en/develop/articles/intel-sdm.html">Intel® 64 and IA-32 Architectures Software Developer Manuals</a></p><p>Vol1：用来介绍Intel x86平台的基本架构和执行环境。</p><p>Vol2：介绍x86指令，学汇编的时候可以参考啊</p><p>Vol3：介绍x86系统编程的基础，包括内存管理、保护、任务管理、中断和异常处理、多处理器支持、散热和电源管理功能、调试、性能监控、系统管理模式、虚拟机扩展(VMX)指令、英特尔虚拟化技术(Intel VT)和英特尔软件防护扩展(Intel SGX)。</p><p>Vol4：介绍x86 CPU上的MSR，是CPU内部的一组特殊的寄存器（这个是从原来的Vol3中独立出来的）。</p><div class="post-button"><a class="btn" href="/posts/32699cc/#more" rel="contents">Read more &raquo;</a></div></div><footer class="post-footer"><div class="post-eof"></div></footer></article></div><nav class="pagination"><span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="Next page"></i></a></nav></div></main><footer class="footer"><div class="footer-inner"><div class="copyright">&copy; 2019 – <span itemprop="copyrightYear">2025</span> <span class="with-love"><i class="fa fa-heart"></i> </span><span class="author" itemprop="copyrightHolder">Sidney Ding</span></div><div class="wordcount"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-chart-line"></i> </span><span>Symbols count total: </span><span title="Symbols count total">304k</span> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-coffee"></i> </span><span>Reading time total &asymp;</span> <span title="Reading time total">4:36</span></span></div><div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a></div><div><span><i class="fa-solid fa-bomb"></i> </span><span id="showDays"></span></div><script>let seconds=1e3,minutes=60*seconds,hours=60*minutes,days=24*hours,years=365*days,birthDay=Date.UTC(2019,10,1,0,0,0);setInterval((function(){let e=new Date,s=e.getFullYear(),t=e.getMonth()+1,o=e.getDate(),a=e.getHours(),n=e.getMinutes(),r=e.getSeconds(),h=Date.UTC(s,t,o,a,n,r)-birthDay,u=Math.floor(h/years),d=Math.floor(h/days-365*u),y=Math.floor((h-(365*u+d)*days)/hours),i=Math.floor((h-(365*u+d)*days-y*hours)/minutes),l=Math.floor((h-(365*u+d)*days-y*hours-i*minutes)/seconds);document.getElementById("showDays").innerHTML="This website has been running for "+u+" years, "+d+" days, "+y+" hours, "+i+" minutes, "+l+" seconds"}),1e3)</script></div></footer><script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/next-theme-pjax/0.5.0/pjax.min.js" integrity="sha256-3NkoLDrmHLTYj7csHIZSr0MHAFTXth7Ua/DDt4MRUAg=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.0.6/medium-zoom.min.js" integrity="sha256-EdPgYcPk/IIrw7FYeuJQexva49pVRZNmt3LculEr7zM=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/lozad.js/1.16.0/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script><script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script><script src="/js/bookmark.js"></script><script src="/js/pjax.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.0/search.js" integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin="anonymous"></script><script src="/js/third-party/search/local-search.js"></script><script class="next-config" data-name="pdf" type="application/json">{"object_url":{"url":"https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.2.8/pdfobject.min.js","integrity":"sha256-tu9j5pBilBQrWSDePOOajCUdz6hWsid/lBNzK4KgEPM="},"url":"/lib/pdf/web/viewer"}</script><script src="/js/third-party/tags/pdf.js"></script><script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"neutral","dark":"dark"},"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mermaid/9.1.1/mermaid.min.js","integrity":"sha256-8L3O8tirFUa8Va4NSTAyIbHJeLd6OnlcxgupV9F77e0="}}</script><script src="/js/third-party/tags/mermaid.js"></script><script src="/js/third-party/fancybox.js"></script><script src="/js/third-party/pace.js"></script><script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.1/es5/tex-mml-chtml.js","integrity":"sha256-hlC2uSQYTmPsrzGZTEQEg9PZ1a/+SV6VBCTclohf2og="}}</script><script src="/js/third-party/math/mathjax.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/quicklink/2.2.0/quicklink.umd.js" integrity="sha256-4kQf9z5ntdQrzsBC3YSHnEz02Z9C1UeW/E9OgnvlzSY=" crossorigin="anonymous"></script><script class="next-config" data-name="quicklink" type="application/json">{"enable":false,"home":false,"archive":false,"delay":true,"timeout":3000,"priority":true,"url":"https://sidneyding.cn/"}</script><script src="/js/third-party/quicklink.js"></script><script src="/js/code_unfold.js"></script><script src="/js/love.js"></script><script src="/js/show-text.js"></script><script src="/js/snowflakes.min.js"></script><script src="/js/activate-power-mode.min.js"></script><script>document.addEventListener("DOMContentLoaded",()=>{codeUnfold()}),new Snowflakes({color:"rgba(129, 161, 193, 0.87)"}),POWERMODE.colorful=!0,POWERMODE.shake=!0,document.body.addEventListener("input",POWERMODE)</script><script class="next-config" data-name="changyan" type="application/json">{"enable":true,"appid":"cyw6GhFAo","appkey":"39c16599e32c872d8661763f6b93d932"}</script><script src="/js/third-party/comments/changyan.js"></script></body></html>