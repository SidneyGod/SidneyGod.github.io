<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Relearning C/Cpp: Foundation Type</title>
      <link href="/posts/6a5ea6b7/"/>
      <url>/posts/6a5ea6b7/</url>
      
        <content type="html"><![CDATA[<html><head></head><body><h1 id="1-标识符-关键字"><a href="#1-标识符-关键字" class="headerlink" title="1 标识符 关键字"></a>1 标识符 关键字</h1><p>标识符命名规则：</p><ol><li>变量名只能是字母（A-Z，a-z）和数字（0-9）或者下划线（_）或者美元符号（<strong>$</strong>）组成</li><li>第一个字母不能是数字</li><li>不能使用C/C++关键字来命名变量</li><li>变量名区分大小写</li></ol><figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> $name1, _name2, Name3;</span><br></pre></td></tr></tbody></table></figure><blockquote><p>似乎有的版本不支持<code>$</code>..我试了gcc8.1是可以的</p></blockquote><p>C语言关键字：</p><a id="more"></a><table><thead><tr><th>关键字</th><th>说明</th></tr></thead><tbody><tr><td>auto</td><td>声明自动变量</td></tr><tr><td>short</td><td>声明短整型变量或函数</td></tr><tr><td>int</td><td>声明整型变量或函数</td></tr><tr><td>long</td><td>声明长整型变量或函数</td></tr><tr><td>float</td><td>声明浮点型变量或函数</td></tr><tr><td>double</td><td>声明双精度变量或函数</td></tr><tr><td>char</td><td>声明字符型变量或函数</td></tr><tr><td>struct</td><td>声明结构体变量或函数</td></tr><tr><td>union</td><td>声明共用数据类型</td></tr><tr><td>enum</td><td>声明枚举类型</td></tr><tr><td>typedef</td><td>用以给数据类型取别名</td></tr><tr><td>const</td><td>声明只读变量</td></tr><tr><td>unsigned</td><td>声明无符号类型变量或函数</td></tr><tr><td>signed</td><td>声明有符号类型变量或函数</td></tr><tr><td>extern</td><td>声明变量是在其他文件正声明</td></tr><tr><td>register</td><td>声明寄存器变量</td></tr><tr><td>static</td><td>声明静态变量</td></tr><tr><td>volatile</td><td>说明变量在程序执行中可被隐含地改变</td></tr><tr><td>void</td><td>声明函数无返回值或无参数，声明无类型指针</td></tr><tr><td>if</td><td>条件语句</td></tr><tr><td>else</td><td>条件语句否定分支（与 if 连用）</td></tr><tr><td>switch</td><td>用于开关语句</td></tr><tr><td>case</td><td>开关语句分支</td></tr><tr><td>for</td><td>一种循环语句</td></tr><tr><td>do</td><td>循环语句的循环体</td></tr><tr><td>while</td><td>循环语句的循环条件</td></tr><tr><td>goto</td><td>无条件跳转语句</td></tr><tr><td>continue</td><td>结束当前循环，开始下一轮循环</td></tr><tr><td>break</td><td>跳出当前循环</td></tr><tr><td>default</td><td>开关语句中的“其他”分支</td></tr><tr><td>sizeof</td><td>计算数据类型长度</td></tr><tr><td>return</td><td>子程序返回语句（可以带参数，也可不带参数）循环条件</td></tr></tbody></table><p>C++关键字：</p><img data-src="https://gitee.com/SidneyGod/ImagePlace/raw/master/null/Cpp_Keywords.jpg"><p><a href="https://www.runoob.com/w3cnote/cpp-keyword-intro.html" target="_blank" rel="noopener">https://www.runoob.com/w3cnote/cpp-keyword-intro.html</a></p><h1 id="2-变量声明-定义-初始化"><a href="#2-变量声明-定义-初始化" class="headerlink" title="2 变量声明 定义 初始化"></a>2 变量声明 定义 初始化</h1><p>补充知识，C语言从源文件到可执行文件一般经历四个步骤：预处理，编译，汇编，链接</p><p><strong>声明</strong>：声明是只是向编译器声明一下我用到的变量或者类型，与分配内存毫无关系</p><p><strong>定义</strong>：给变量分配了空间才叫做定义。定义往往是附庸于声明的，通俗地说，也就是只当你先声明了一个变量，才有可能为其分配空间（定义）</p><p><strong>初始化</strong>：定义只是给变量分配了内存空间，但一开始决定这内存空间存放什么值是由初始化决定的</p><figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在C中直接这样写IDE是不会报错的 就是说在预处理阶段是不会有问题的</span></span><br><span class="line"><span class="comment">// 在C++中要指明aa的类型 即 extern int aa;</span></span><br><span class="line"><span class="keyword">extern</span> aa;  <span class="comment">// 声明没有分配空间 即使是extern int aa;也没有分配空间 其实在c中不加类型 默认是int</span></span><br><span class="line"><span class="keyword">int</span> aa;  <span class="comment">// 这里分配了int大小的空间给aa，即定义aa的大小</span></span><br><span class="line">aa = <span class="number">10</span>;  <span class="comment">// 这里初始化aa的值</span></span><br></pre></td></tr></tbody></table></figure><h1 id="3-变量类型-大小-类型转换"><a href="#3-变量类型-大小-类型转换" class="headerlink" title="3 变量类型 大小 类型转换"></a>3 变量类型 大小 类型转换</h1><p><strong>变量类型</strong></p><p>C变量类型：</p><table><thead><tr><th>说  明</th><th>字符型</th><th>短整型</th><th>整型</th><th>长整型</th><th>单精度浮点型</th><th>双精度浮点型</th><th>无类型</th></tr></thead><tbody><tr><td>数据类型</td><td>char</td><td>short</td><td>int</td><td>long</td><td>float</td><td>double</td><td>void</td></tr></tbody></table><p>除了<code>float</code>，<code>double</code>，<code>void</code>都还可以再加个<code>unsigned</code>修饰；(还有就是<code>struct</code>，<code>enum</code>，<code>union</code>复合类型了，只说基础变量类型)</p><p>C++变量类型：除了C语言的，还有<code>bool</code>，<code>wchar_t</code>(宽字符类型)，还有一个和<code>struct</code>差不多的<code>class</code></p><p><strong>变量大小</strong></p><p>ANSI/ISO制订的4条铁定的原则</p><ol><li>sizeof(short int)<=sizeof(int)</li><li>sizeof(int)<=sizeof(long int)</li><li>short int至少应为16位（2字节）</li><li>long int至少应为32位</li></ol><p>常见系统情况</p><p>参考：<a href="https://blog.csdn.net/weixin_30367359/article/details/81211393" target="_blank" rel="noopener">https://blog.csdn.net/weixin_30367359/article/details/81211393</a></p><p><strong>类型转换</strong></p><p>C中<strong>自动类型转换</strong>：编译器默默地、隐式地、偷偷地进行的数据类型转换，这种转换不需要程序员干预，会自动发生</p><p>将一种类型的数据赋值给另外一种类型的变量时就会发生自动类型转换</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">float</span> f = <span class="number">100</span>;  <span class="comment">// 这里100是int型，需要先转换为float型才能赋值给f</span></span><br></pre></td></tr></tbody></table></figure><p>在不同类型的混合运算中，编译器也会自动地转换数据类型，将参与运算的所有数据先转换为同一种类型，然后再进行计算。转换规则如下：</p><img data-src="https://gitee.com/SidneyGod/ImagePlace/raw/master/null/type_conversion.png"><p>也就是说，在赋值运算中，赋值号两边的数据类型不同时，需要把右边表达式的类型转换为左边变量的类型，这可能会导致数据失真，或者精度降低；所以说，<strong>自动类型转换并不一定是安全的</strong>。对于不安全的类型转换，编译器一般会给出警告。</p><p>C中<strong>强制类型转换</strong>：在代码中明确地提出要进行类型转换</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 强转规则 (type_name) expression</span></span><br><span class="line">(<span class="keyword">float</span>) <span class="number">100</span>;  <span class="comment">// 将100转为float类型</span></span><br><span class="line"></span><br><span class="line">(<span class="keyword">double</span>) <span class="number">10</span> / <span class="number">4</span>;  <span class="comment">// 2.500000</span></span><br><span class="line">(<span class="keyword">double</span>) (<span class="number">10</span> / <span class="number">4</span>);  <span class="comment">// 2.000000</span></span><br><span class="line"><span class="comment">// 因为()优先级比/高 这一点需要注意</span></span><br></pre></td></tr></tbody></table></figure><p>如何理解<strong>类型转换只是临时性的</strong></p><p>无论是自动类型转换还是强制类型转换，都只是为了本次运算而进行的临时性转换，转换的结果也会保存到临时的内存空间，不会改变数据本来的类型或者值</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">double</span> d = <span class="number">5.5</span>;</span><br><span class="line"><span class="keyword">int</span> i = <span class="number">5</span>;</span><br><span class="line"><span class="keyword">int</span> id = (<span class="keyword">int</span>) d;</span><br><span class="line"><span class="keyword">double</span> result = d / i;</span><br><span class="line"></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d, %lf, %lf\n"</span>, id, d, result);  <span class="comment">// 5, 5.500000, 1.100000</span></span><br><span class="line"><span class="comment">// 虽然第3行对d进行强转了，但是并没有改变d的值</span></span><br></pre></td></tr></tbody></table></figure><p>C++中类型转换，首先C语言能用的，C++都能用，不过强制类型转换，C++有自己的一套</p><p><strong>static_cast</strong>：<code>static_cast<type_id> (expression)</code></p><p>用于类层次结构中基类和派生类之间指针或引用的转换</p><p>用于基本数据类型之间的转换，如把int转换成char</p><p>把空指针转换成目标类型的空指针</p><p>把任何类型的表达式转换为void类型</p><p><strong>注意：static_cast不能转换掉expression的<code>const</code>、<code>volitale</code>或者<code>__unaligned</code>属性</strong></p><p><strong>const_cast</strong>：<code>const_cast<type_id> (expression)</code></p><p>用来修改类型的const或volatile属性。除了const或volatile修饰之外，type_id和expression的类型是一样的</p><p>常量指针被转化成非常量指针，并且仍然指向原来的对象</p><p>常量引用被转换成非常量引用，并且仍然指向原来的对象；常量对象被转换成非常量对象</p><p><strong>const_cast不是用于去除变量的常量性，而是去除指向常数对象的指针或引用的常量性，其去除常量性的对象必须为指针或引用</strong></p><figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> a = <span class="number">101</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span>* p = &a;</span><br><span class="line"></span><br><span class="line"><span class="comment">// *p = 22;  // 只读 不允许修改</span></span><br><span class="line"><span class="comment">// int b = const_cast<int>(a);  // const_cast强制转换对象必须为指针或引用</span></span><br><span class="line"><span class="keyword">int</span>* c = <span class="keyword">const_cast</span><<span class="keyword">int</span> *>(p);  <span class="comment">// 去掉const属性</span></span><br><span class="line">*c = <span class="number">22</span>;  <span class="comment">// 没毛病 *p值就能改了</span></span><br></pre></td></tr></tbody></table></figure><p><strong>reinterpret_cast</strong>：<code>reinterpret_cast<type_id> (expression)</code></p><p>改变指针或引用的类型、将指针或引用转换为一个足够长度的整型、将整型转换为指针或引用类型</p><p>type_id必须是一个指针、引用、算术类型、函数指针或者成员指针</p><p><strong>在使用reinterpret_cast强制转换过程仅仅只是比特位的拷贝，因此在使用过程中需要特别谨慎</strong></p><figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 万物皆可转..</span></span><br><span class="line"><span class="keyword">int</span> *i = <span class="keyword">new</span> <span class="keyword">int</span>;</span><br><span class="line"><span class="keyword">double</span> *d = <span class="keyword">reinterpret_cast</span><<span class="keyword">double</span> *>(i);</span><br></pre></td></tr></tbody></table></figure><p><strong>dynamic_cast</strong>：<code>dynamic_cast<type_id> (expression)</code></p><p><strong>其他三种都是编译时完成的，dynamic_cast是运行时处理的，运行时要进行类型检查</strong></p><p><strong>不能用于内置的基本数据类型的强制转换</strong></p><p><strong>dynamic_cast转换如果成功的话返回的是指向类的指针或引用，转换失败的话则会返回NULL</strong></p><p><strong>使用dynamic_cast进行转换的，基类中一定要有虚函数，否则编译不通过</strong>(需要检测有虚函数的原因：类中存在虚函数，就说明它有想要让基类指针或引用指向派生类对象的情况，此时转换才有意义。这是由于运行时类型检查需要运行时类型信息，而这个信息存储在类的虚函数表中，只有定义了虚函数的类才有虚函数表)</p><p><strong>在类的转换时，在类层次间进行上行转换时，dynamic_cast和static_cast的效果是一样的。在进行下行转换时，dynamic_cast具有类型检查的功能，比static_cast更安全</strong></p><p><strong>向下转换的成功与否还与将要转换的类型有关，即要转换的指针指向的对象的实际类型与转换以后的对象类型一定要相同，否则转换失败</strong></p><p>嗯..略..</p><h1 id="4-变量作用域"><a href="#4-变量作用域" class="headerlink" title="4 变量作用域"></a>4 变量作用域</h1><p>能不能简单理解为一个<code>{}</code>就是一个域，总有没套在<code>{}</code>里面的，那肯定比在<code>{}</code>里活得久啊</p><p>变量作用域，一是看其能覆盖到哪，二是看其能活多久</p><p>首先，强龙压不过地头蛇，其次，你得让人作用域见过你</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> a = <span class="number">10</span>;  <span class="comment">// 没有被{}包裹 全局变量 活得久</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, a);  <span class="comment">// 这个肯定没问题 声明在上面见过 作用域比a小</span></span><br><span class="line">    <span class="comment">//printf("%d\n", b);  // 找不到b的声明</span></span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">int</span> a = <span class="number">11</span>;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, a);  <span class="comment">// 11 这就叫强龙压不过地头蛇 </span></span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br><span class="line"><span class="keyword">int</span> b = <span class="number">20</span>;</span><br></pre></td></tr></tbody></table></figure><p>这又牵扯到了声明</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>{</span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">extern</span> bb;  <span class="comment">// 这里声明一下 让编译器去找</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, bb);  <span class="comment">// 在这个作用域就可以用了</span></span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//printf("%d\n", bb);  // 这个就不行 在这个作用域中没有声明过 找不到</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br><span class="line"><span class="keyword">int</span> bb = <span class="number">20</span>;</span><br></pre></td></tr></tbody></table></figure><p>再说说全局变量和局部变量</p><ul><li>在函数或一个代码块内部定义的变量，称为局部变量</li><li>在函数参数的定义中定义的变量，称为形式参数</li><li>在所有函数外部定义的变量，称为全局变量</li></ul><p>为什么说extern修饰的变量是全局变量？其实我觉得和extern没关系，毕竟extern只是声明，不分配空间</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>{</span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">extern</span> a, b;</span><br><span class="line">        <span class="comment">// printf("%d\n", a);  // 既声明也在下面定义了 但是编译的时候还是会报错 undefined</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, b);  <span class="comment">// 全局的就没问题了 也就是说extern是在全局变量中找 而不是声明为全局</span></span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">int</span> a = <span class="number">10</span>;</span><br><span class="line">}</span><br><span class="line"><span class="keyword">int</span> b = <span class="number">20</span>;</span><br></pre></td></tr></tbody></table></figure><p>可以看到，C语言的作用域还是蛮简单的，C++还有个域操作符<code>::</code>，其实也很简单</p><figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> names {  <span class="comment">// 这就声明一个命名空间</span></span><br><span class="line">    <span class="keyword">int</span> aa = <span class="number">10</span>;</span><br><span class="line">}</span><br><span class="line"><span class="keyword">int</span> aa = <span class="number">20</span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">int</span> aa = <span class="number">30</span>;</span><br><span class="line">    <span class="comment">// 10 - 20 - 30  有内味了 names下的aa，没名字下的aa，没名字就叫全局</span></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> << names::aa << <span class="string">" - "</span> << ::aa << <span class="string">" - "</span> << aa << <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 再说一点class的知识</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AA</span> {</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">()</span></span>;  <span class="comment">// 这叫声明一个函数</span></span><br><span class="line">};</span><br><span class="line"><span class="keyword">void</span> AA::print() {}  <span class="comment">// 这叫定义一个函数 你不说明是aa的print，那编译器哪知道是不是</span></span><br></pre></td></tr></tbody></table></figure><h1 id="5-变量存储位置"><a href="#5-变量存储位置" class="headerlink" title="5 变量存储位置"></a>5 变量存储位置</h1><p>一个C/C++程序的内存占用情况</p><p>栈区：由编译器自动分配释放，存放函数的参数值，局部变量的值等</p><p>堆区：一般由程序员分配释放，若程序员不释放，程序结束时可能由操作系统回收。注意它与数据结构中的堆是两回事，分配方式类似于链表</p><p>全局区/静态区：全局变量和静态变量的存储是放在一块的。初始化的全局变量和静态变量在一块区域，未初始化的全局变量和静态变量又放在相邻的另一块区域中。程序结束后由系统释放</p><p>常量区：字符串常量和其他类型常量存放位置。程序结束后由系统释放</p><p>代码区：存放函数体的二进制代码</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> a = <span class="number">0</span>; <span class="comment">// 全局初始化区</span></span><br><span class="line"><span class="keyword">char</span> *p1; <span class="comment">// 全局未初始化区</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">int</span> b; <span class="comment">// 栈 </span></span><br><span class="line">    <span class="keyword">char</span> s[] = <span class="string">"abc"</span>; <span class="comment">// s在栈 "abc\0"在常量区</span></span><br><span class="line">    <span class="keyword">char</span> *p2; <span class="comment">// 栈 </span></span><br><span class="line">    <span class="keyword">char</span> *p3 = <span class="string">"123456"</span>; <span class="comment">// 123456\0 在常量区，p3在栈上。 </span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> c = <span class="number">0</span>; <span class="comment">// 全局（静态）初始化区 </span></span><br><span class="line">    p1 = (<span class="keyword">char</span> *) <span class="built_in">malloc</span>(<span class="number">10</span>);</span><br><span class="line">    p2 = (<span class="keyword">char</span> *) <span class="built_in">malloc</span>(<span class="number">20</span>); <span class="comment">// 分配得来得10和20字节的区域就在堆区</span></span><br><span class="line">    <span class="built_in">strcpy</span>(p1, <span class="string">"123456"</span>); <span class="comment">// 123456\0放在常量区，编译器可能会做优化，指向p3指向的"123456"</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>上面的划分的区对应到操作系统(深入理解计算机系统)的各种段：</p><p>bss段：Block Started by Symbol，通常是指用来存放程序中未初始化的全局变量的一块内存区域，不给该段的数据分配空间，只是记录数据所需空间的大小，bss段属于静态内存分配</p><p>data段：通常是指用来存放程序中已初始化的全局变量的一块内存区域，数据分配空间，数据保存在目标文件中，data段属于静态内存分配</p><p>rodata段：read only data segment，存放常量数据(但不是所有，有些马上数与指令编译在一起直接放在代码段)，用const修饰的全局变量是放入常量区的，可是使用const修饰的局部变量仅仅是设置为只读起到防止改动的效果，没有放入常量区，有些系统中rodata段是多个进程共享的，目的是为了提高空间的利用率</p><p>text段：通常是指用来存放程序执行代码的一块内存区域。这部分区域的大小在程序运行前就已经确定，并且内存区域通常属于只读(某些架构也允许代码段为可写，即允许修改程序)。在text段中，也有可能包含一些只读的常数变量(<code>int a = 10;</code>中的10)等</p><p>heap：用于存放进程运行中被动态分配的内存段，它的大小并不固定，可动态扩张或缩减。当进程调用malloc等函数分配内存时，新分配的内存就被动态添加到堆上（堆被扩张）；当利用free等函数释放内存时，被释放的内存从堆中被剔除（堆被缩减）</p><p>stack：用户存放程序临时创建的局部变量。也就是括弧<code>{}</code>中定义的变量（但不包括static声明的变量，static意味着在data段中存放变量）。除此以外，在函数被调用时，其参数也会被压入发起调用的进程栈中，并且待到调用结束后，函数的返回值也会被存放回栈中。由于栈的先进先出(FIFO)特点，所以栈特别方便用来保存/恢复调用现场。</p><blockquote><p><strong>一个程序本质上都是由 bss段、data段、text段三个组成的</strong>。这样的概念，不知道最初来源于哪里的规定，但在当前的计算机程序设计中是很重要的一个基本概念。一般在初始化时bss段部分将会清零。bss段属于静态内存分配，即程序一开始就将其清零了。比如，在C语言之类的程序编译完成之后，已初始化的全局变量保存在<code>.data</code>段中，未初始化的全局变量保存在<code>.bss</code>段中。</p><p>text和data段都在可执行文件中（在嵌入式系统里一般是固化在镜像文件中），由系统从可执行文件中加载；而bss段不在可执行文件中，由系统初始化。</p></blockquote><p>应该放上一段汇编的，奈何看不太明白，mark几条命令</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 汇编代码 8086 或者 AT&T</span></span><br><span class="line">gcc -S -masm=intel main.c -o main.s</span><br><span class="line">gcc -S -masm=att main.c -o main.s</span><br><span class="line"></span><br><span class="line"><span class="comment"># 反汇编</span></span><br><span class="line">objdump -d test.exe</span><br><span class="line"></span><br><span class="line"><span class="comment"># 列出目标文件的符号清单</span></span><br><span class="line">nm test.exe</span><br></pre></td></tr></tbody></table></figure><p><strong>静态变量(static)</strong></p><p>在C/C++中，static 关键字不仅可以用来修饰变量，还可以用来修饰函数。在使用static关键字修饰变量时，我们称此变量为静态变量。静态变量的存储方式与全局变量一样，都是静态存储方式，但是全局变量不是静态变量</p><p>全局变量的作用域是整个源程序，当一个源程序由多个源文件组成时，全局变量在各个源文件中都是有效的；全局变量之前加上关键字static来实现，使全局变量被定义成为一个静态全局变量，此时该变量只能在本文件中使用，起到了对其他源文件进行<strong>隐藏与隔离</strong>的作用</p><p>如果希望函数中局部变量的值在<strong>函数调用结束之后不会消失</strong>，而仍然保留其原值，即它所占用的存储单元不释放，在下一次调用该函数时，其局部变量的值仍然存在，也就是上一次函数调用结束时的值，此时，应该将该局部变量用关键字static声明为<strong>静态局部变量</strong>，当将局部变量声明为静态局部变量的时候，也就改变了局部变量的存储位置，即从原来的栈中存放改为静态存储区存放。这让它看起来很像全局变量，其实静态局部变量与全局变量的主要区别就在于可见性，静态局部变量只在其被声明的代码块中是可见的</p><p>在静态数据区，内存中所有的字节默认值都是0x00。静态变量与全局变量也一样，它们都存储在静态数据区中，因此其变量的值默认也为0(对自动变量不赋初值，其值是不定的，所以说有的不初始化的静态变量，有可能被优化到data段)</p><p>static对函数的修饰与对全局变量的修饰相似，只能被本文件中的函数调用，而不能被同一程序其它文件中的函数调用，所以satic函数又被称为内部函数</p><p><strong>寄存器变量(register)</strong></p><p><code>'register' storage class specifier is deprecated and incompatible with C++17</code></p><p>使用修饰符register声明的变量属于寄存器存储类型。该类型与自动存储类型相似，具有自动存储时期、代码块作用域和内连接。声明为register仅仅是一个请求，因此该变量仍然可能是普通的自动变量。无论哪种情况，用<strong>register修饰的变量都无法获取地址</strong>(在C++中，register变量在内存中有副本，可以获取到副本的地址)。如果没有被初始化，它的值是未定的。register可以加速变量值访问速度，如果不存在竞争条件，并且该变量会被频繁的访问使用，可以使用register。</p><p><strong>volatile</strong></p><p>因为访问寄存器要比访问内存单元快的多，所以编译器一般都会作减少存取内存的优化，但有可能会读脏数据。遇到volatile声明的变量，编译器对访问该变量的代码就不再进行优化，从而可以提供对特殊地址的稳定访问；如果不使用volatile，则编译器将对所声明的语句进行优化。当一个变量存在竞争条件时，如果没有上锁，为了维护数据的统一性，则必须显式的使用volatile进行声明。在对变量声明时，默认的是使用volatile声明，但是如果没有显式的使用该修饰付，那么编译器可能会优化成register变量。</p><p>使用volatile的场景：中断服务程序中修改的供其它程序检测的变量需要；多任务环境下各任务间共享的标志；存储器映射的硬件寄存器，因为每次对它的读写都可能有不同意义</p><p><strong>const</strong></p><p>内存被初始化后，<strong>程序</strong>(硬件可以，所以const可以和volatile一起用)便不能对其进行修改。const修饰的全局变量的链接性为内部的(就像加了static)。若希望某个常量的链接性为外部的，则可以<strong>使用关键字extern覆盖默认的内部链接性</strong>，这种情况下所有使用该常量的文件都要使用extern来引用声明它，<strong>只能在其中一个文件初始化该变量，且之后该变量不可修改</strong></p><p><strong>常量：固定值</strong>，在程序执行期间不会改变。这些固定的值，又叫做<strong>字面量</strong>。常量可以是任何的基本数据类型，比如整数常量、浮点常量、字符常量，或字符串字面值，也有枚举常量。一般说到常量，就不得不提<code>#define</code>和<code>const</code>。define是宏定义，程序在预处理阶段将用define定义的内容进行了替换。因此程序运行时，常量表中并没有用define定义的常量，系统不为它分配内存(就存储来看，我觉得不能算常量)。const定义的常量，在程序运行时在常量表中，系统为它分配内存。define定义的常量，预处理时只是直接进行了替换。所以编译时不能进行数据类型检验。const定义的常量，在编译时进行严格的类型检验，可以避免出错。define定义表达式时要注意<strong>边缘效应</strong>(就是要记得加括号，仅仅是替换)</p><p>说常量是只读的，只是个笑话，实质上内存永远都可以被用户随意修改，只是编译器给用户的代码注入了一些自己的保护代码，通过软件手段将这段内存软保护起来。这种保护在汇编级别可以轻松突破，其保护也就无效了</p><h1 id="6-类型推导"><a href="#6-类型推导" class="headerlink" title="6 类型推导"></a>6 类型推导</h1><p>在C++11之前的版本（C++98和C++03）中，定义变量或者声明变量之前都必须指明它的类型，比如 int、char 等；但是在一些比较灵活的语言中，比如 C#、JavaScript、PHP、Python 等，程序员在定义变量时可以不指明具体的类型，而是让编译器（或者解释器）自己去推导，这就让代码的编写更加方便，阅读更加费事(我觉得就不应该出现这玩意，编译器能推导出来是啥类型，我可不行啊)</p><p><strong>auto</strong></p><p>在之前的C++版本中，auto关键字用来指明变量的存储类型，它和static关键字是相对的。auto表示变量是自动存储的，这也是编译器的默认规则，所以写不写都一样，一般我们也不写，这使得auto关键字的存在变得非常鸡肋。C++11赋予auto关键字新的含义，使用它来做自动类型推导</p><figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 这全篇auto写下来，代码还能看？</span></span><br><span class="line"><span class="keyword">auto</span> n = <span class="number">10</span>;</span><br><span class="line"><span class="keyword">auto</span> f = <span class="number">12.8</span>;</span><br><span class="line"><span class="keyword">auto</span> p = &n;</span><br><span class="line"><span class="keyword">auto</span> url = <span class="string">"123456"</span>;</span><br></pre></td></tr></tbody></table></figure><p>注意：auto 仅仅是一个占位符，在编译器期间它会被真正的类型所替代。或者说，C++ 中的变量必须是有明确类型的，只是这个类型是由编译器自己推导出来的。</p><p>不能在函数的参数中使用；不能作用于类的非静态成员变量；不能定义数组；不能作用于模板参数</p><p><strong>decltype</strong></p><p>declare type，和auto的功能一样，都用来在编译时期进行自动类型推导，这个关键字的出现肯定为了弥补auto不足之处，用法：</p><figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// varname 表示变量名，value 表示赋给变量的值，exp 表示一个表达式</span></span><br><span class="line"><span class="keyword">auto</span> varname = value;</span><br><span class="line"><span class="keyword">decltype</span>(<span class="built_in">exp</span>) varname[ = value];</span><br></pre></td></tr></tbody></table></figure><p>decltype能够根据变量、字面量、带有运算符的表达式推导出变量的类型</p><p>推到规则：</p><ul><li>如果exp是一个不被括号<code>()</code>包围的表达式，或者是一个类成员访问表达式，或者是一个单独的变量，那么<code>decltype(exp)</code>的类型就和exp一致，这是最普遍最常见的情况</li><li>如果exp是函数调用，那么<code>decltype(exp)</code>的类型就和函数返回值的类型一致</li><li>如果exp是一个左值，或者被括号<code>()</code>包围，那么<code>decltype(exp)</code>的类型就是exp的引用；假设exp的类型为<code>T</code>，那么<code>decltype(exp)</code>的类型就是<code>T&</code></li></ul><p>两者之间的区别：</p><p>auto要求变量必须初始化，也就是在定义变量的同时必须给它赋值；而decltype不要求，初始化与否都不影响变量的类型。这很容易理解，因为auto是根据变量的初始值来推导出变量类型的，如果不初始化，变量的类型也就无法推导了。</p><p>auto将变量的类型和初始值绑定在一起，而decltype将变量的类型和初始值分开；虽然auto的书写更加简洁，但decltype的使用更加灵活</p><p>如果表达式的类型不是指针或者引用，auto会把cv(const volatile)限定符直接抛弃，推导成non-const或者non-volatile类型；如果表达式的类型是指针或者引用，auto将保留cv限定符</p><p><strong>decltype会保留cv限定符</strong></p><h1 id="7-typedef"><a href="#7-typedef" class="headerlink" title="7 typedef"></a>7 typedef</h1><p><a href="https://blog.csdn.net/Andrewniu/article/details/80566324" target="_blank" rel="noopener">https://blog.csdn.net/Andrewniu/article/details/80566324</a></p><p>C语言允许用户使用 typedef 关键字来定义自己习惯的数据类型名称，来替代系统默认的基本类型名称、数组类型名称、指针类型名称与用户自定义的结构型名称、共用型名称、枚举型名称等。</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> true 1</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> false 0</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">int</span> <span class="keyword">bool</span>;</span><br><span class="line"><span class="comment">// 在C语言中也可以愉快地使用bool了</span></span><br><span class="line"><span class="keyword">bool</span> aFlag = <span class="literal">true</span>;</span><br></pre></td></tr></tbody></table></figure><p><strong>为基本数据类型定义新的类型名</strong></p><p>为了跨平台，定义一种类型与平台无关</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> _SIZE_T_DEFINED</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span>  _WIN64</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">unsigned</span> __int64    <span class="keyword">size_t</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line"><span class="keyword">typedef</span> _W64 <span class="keyword">unsigned</span> <span class="keyword">int</span>   <span class="keyword">size_t</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> _SIZE_T_DEFINED</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></tbody></table></figure><p><strong>为自定义数据类型（结构体、共用体和枚举类型）定义简洁的类型名称</strong></p><p>先看C语言的情况</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">tagMyNode</span>{</span></span><br><span class="line">    <span class="keyword">int</span> data;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">tagMyNode</span> *<span class="title">next</span>;</span></span><br><span class="line">} MyNode;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">tagMyNode</span> *<span class="title">mTagNode</span>;</span>  <span class="comment">// 老长了</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main2</span><span class="params">()</span> </span>{</span><br><span class="line">    MyNode.data = <span class="number">8</span>;</span><br><span class="line">    mTagNode->data = <span class="number">10</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/***********用了typedef之后***********/</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">tagMyNode</span>{</span></span><br><span class="line">    <span class="keyword">int</span> data;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">tagMyNode</span> *<span class="title">next</span>;</span></span><br><span class="line">} MyNode;</span><br><span class="line"></span><br><span class="line">MyNode *mTagNode;  <span class="comment">// 事实上等价于 typedef struct tagMyNode MyNode;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="comment">// MyNode.data = 10;</span></span><br><span class="line">    mTagNode->data = <span class="number">10</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/**********再来个有趣的**********/</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">tagMyNode</span>{</span></span><br><span class="line">    <span class="keyword">int</span> data;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">tagMyNode</span> *<span class="title">next</span>;</span></span><br><span class="line">} MyNode, Node;</span><br><span class="line"></span><br><span class="line">MyNode *mTagNode;  <span class="comment">// typedef struct tagMyNode MyNode;</span></span><br><span class="line">Node *mNode;  <span class="comment">// typedef struct tagMyNode Node;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>{</span><br><span class="line">    mTagNode->data = <span class="number">10</span>;</span><br><span class="line">    mNode->data = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>再看看C++有没有什么不同</p><figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">tagMyNode</span>{</span></span><br><span class="line">    <span class="keyword">int</span> data;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">tagMyNode</span> *<span class="title">next</span>;</span></span><br><span class="line">} MyNode;</span><br><span class="line"></span><br><span class="line">tagMyNode *mTagNode;  <span class="comment">// 这里其实是把struct当class用了</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">tagMyNode</span> *<span class="title">mTagNode2</span>;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main1</span><span class="params">()</span> </span>{</span><br><span class="line">    MyNode.data = <span class="number">10</span>;</span><br><span class="line">    <span class="comment">// tagMyNode->data = 10;  // 没有初始化的类不能操作 但可以 mTagNode = new tagMyNode;</span></span><br><span class="line">    mTagNode2->data = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/**********使用typedef*************/</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">tagMyNode</span>{</span></span><br><span class="line">    <span class="keyword">int</span> data;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">tagMyNode</span> *<span class="title">next</span>;</span></span><br><span class="line">} MyNode;</span><br><span class="line"></span><br><span class="line">tagMyNode *mTagNode;  <span class="comment">// 事实上这里是 class tagMyNode;</span></span><br><span class="line">MyNode *mTagNode2;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main1</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="comment">// tagMyNode->data = 10;</span></span><br><span class="line">    mTagNode2->data = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><strong>为数组定义简介类型</strong></p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">int</span> INT_ARR_LEN_10[<span class="number">10</span>];</span><br><span class="line">INT_ARR_LEN_10 arr;</span><br></pre></td></tr></tbody></table></figure><p><strong>为指针定义简洁的名称</strong></p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">char</span>* PCHAR;</span><br><span class="line">PCHAR pc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> PCHAR pChar;  <span class="comment">// 等价于const char* pChar;吗？</span></span><br><span class="line"><span class="comment">// 其实是不等价的，typedef不是字符串替换，这里const应当是修饰指针的，即指针常量(网上通俗叫法)</span></span><br><span class="line"><span class="comment">// 所以等价于char* const，而不是const char*，有点懵？</span></span><br></pre></td></tr></tbody></table></figure><blockquote><p>先补充一下，对于<code>int *const p = &a;</code>，网上通常的叫法是指针常量，而在C++ Primer第五版中叫做常量指针，虽然叫法不一样，但是大家的意思是一样的</p></blockquote><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">char</span> c = <span class="string">'a'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">char</span> *p1 = <span class="string">"abc"</span>;  <span class="comment">// 指向常量的变量指针 从右向左看</span></span><br><span class="line"><span class="keyword">char</span> <span class="keyword">const</span> *p2 = <span class="string">"abc"</span>;  <span class="comment">// 指向常量的变量指针</span></span><br><span class="line"><span class="keyword">char</span> *<span class="keyword">const</span> p3 = <span class="string">"abc"</span>;  <span class="comment">// 指向变量的常量指针</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">char</span> <span class="keyword">const</span> *p4 = <span class="string">"abc"</span>;  <span class="comment">// 其实这里的第二个const是多余的</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">char</span> *<span class="keyword">const</span> p5 = <span class="string">"abc"</span>;  <span class="comment">// 指向常量的常量指针</span></span><br><span class="line"></span><br><span class="line">p1 = &c;  <span class="comment">// p1的值可以变</span></span><br><span class="line"><span class="comment">// *p1 = c;  // p1指向的值不能变</span></span><br><span class="line"></span><br><span class="line">p2 = &c;  <span class="comment">// 同上</span></span><br><span class="line"><span class="comment">// *p1 = c;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// p3 = &c;  // p3的值不可以变 p3是指针(地址) 是常量</span></span><br><span class="line">*p3 = c;  <span class="comment">// *p3的值可以变</span></span><br><span class="line"></span><br><span class="line">p4 = &c;  <span class="comment">// 同p1</span></span><br><span class="line"><span class="comment">// *p4 = c;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// p5 = &c;  // 指针(地址)常量 不可变</span></span><br><span class="line"><span class="comment">// *p5 = c;  // 指向常量 不可变</span></span><br></pre></td></tr></tbody></table></figure><p>按照C++ Primer的说法，<strong>从右向左看</strong>似乎是能看通的，没啥大问题。不过这么想，const优先和左边结合，左边没有再和右边结合，反正const就是不允许变的意思。</p><p>这里的指针换成C++的引用也是同样适用的</p></body></html>]]></content>
      
      
      <categories>
          
          <category> C/Cpp </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>JNI</title>
      <link href="/posts/e3b64abb/"/>
      <url>/posts/e3b64abb/</url>
      
        <content type="html"><![CDATA[<html><head></head><body><h1 id="1-JNI"><a href="#1-JNI" class="headerlink" title="1 JNI"></a>1 JNI</h1><p>JNI(Java Native Interface)，提供了若干API实现了Java和其他语言(主要是C/C++)的通信。简单来说就是Java想要调用C/C++的接口必须遵循JNI的规范</p><p>牵涉到一个很重要的头文件<code>jni.h</code>，这个头文件的位置：<code>\jdk1.8.0_211\include\jni.h</code>，如果是Linux，或许是<code>/usr/lib/jvm/java-8-openjdk-amd64/include/jni.h</code>。这个头文件定义了数据类型，JNIInterface(定义了很多函数指针，就是一些接口)</p><h2 id="1-1-hello-world"><a href="#1-1-hello-world" class="headerlink" title="1.1 hello world"></a>1.1 hello world</h2><ol><li><p>创建一个JniHello.java, 并声明一个native函数<code>sayHello()</code></p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JniHello</span> </span>{</span><br><span class="line">    <span class="comment">// define a native function</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">native</span> String <span class="title">hello</span><span class="params">(String str)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></li><li><p>生产C/C++头文件</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 先编译 生成class文件</span></span><br><span class="line">javac JniHello.java</span><br><span class="line"><span class="comment"># 生成头文件</span></span><br><span class="line">javah JniHello</span><br></pre></td></tr></tbody></table></figure><a id="more"></a><p><img alt data-src="https://gitee.com/SidneyGod/ImagePlace/raw/master/image-20200301142434381.png"></p></li><li><p>编写对应的C/C++函数，实现JniHello.h中声明的方法</p><figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// JniHello.cpp 这里c和cpp文件是有区别的</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"JniHello.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string"><iostream></span></span></span><br><span class="line"></span><br><span class="line">JNIEXPORT jstring JNICALL Java_JniHello_hello</span><br><span class="line">  (JNIEnv *env, jclass clazz, jstring contentStr)</span><br><span class="line">{</span><br><span class="line">    <span class="comment">// 必须是指针 可到jni.h去查</span></span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span>* jstr = env->GetStringUTFChars(contentStr, JNI_FALSE);</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> << <span class="string">"Welcome to C/C++ world! java: "</span> << jstr << <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建字符串并返回</span></span><br><span class="line">    <span class="keyword">char</span> cStr[] = <span class="string">"I am from C/Cpp"</span>;</span><br><span class="line">    <span class="keyword">return</span> env->NewStringUTF(cStr);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></li><li><p>生成目标文件</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 一定要带上这两个目录 且看好是/而不是\，毕竟win容易出这个错</span></span><br><span class="line">gcc \</span><br><span class="line">  -I D:/Develop/JDK/jdk1.8.0_211/include \</span><br><span class="line">  -I D:/Develop/JDK/jdk1.8.0_211/include/win32 \</span><br><span class="line">  -c -fPIC JniHello.cpp</span><br><span class="line"><span class="comment"># 如果出现 fatal error: jni.h: No such file or directory 肯定是因为没带目录</span></span><br></pre></td></tr></tbody></table></figure><p><img alt data-src="https://gitee.com/SidneyGod/ImagePlace/raw/master/image-20200301144652883.png"></p></li><li><p>生成C/C++共享库</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 库文件名格式(name可以随便改): <name> + .dll</span></span><br><span class="line">g++ -shared JniHello.o -o JniHello.dll</span><br><span class="line"><span class="comment"># 为什么是g++而不是gcc，因为会报错..其实貌似是因为gcc不识别c++?</span></span><br><span class="line"><span class="comment"># 因为是windows所以是<name> + .dll，如果是Linux就是lib + <name> + .so了</span></span><br></pre></td></tr></tbody></table></figure><p>总之执行完后，目录下会多出一个<code>JniHello.dll</code>文件</p></li><li><p>Java文件中加载共享库并调用函数</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JniHello</span> </span>{</span><br><span class="line">    <span class="keyword">static</span> {</span><br><span class="line">        <span class="comment">// JniHello + .dll</span></span><br><span class="line">        System.loadLibrary(<span class="string">"JniHello"</span>);</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// define a native function</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">native</span> String <span class="title">hello</span><span class="params">(String str)</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">        <span class="comment">// call hello</span></span><br><span class="line">        String str = hello(<span class="string">"I am from Java!"</span>);</span><br><span class="line">        System.out.println(str);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></li><li><p>编译运行Java文件</p><p><img alt data-src="https://gitee.com/SidneyGod/ImagePlace/raw/master/image-20200301150441786.png"></p></li></ol><p>以上就是在Windows下，纯手撸java调c的过程了，前提是要配置好gcc或其他C/C++编译器</p><h2 id="1-2-JNI原理"><a href="#1-2-JNI原理" class="headerlink" title="1.2 JNI原理"></a>1.2 JNI原理</h2><p>计算机系统中，每种语言都有一个执行环境(Runtime)用于解释执行语言中的语句，不同种的语言一般是不能存在同一种环境的。人鬼殊途</p><h3 id="1-2-1-JavaVM"><a href="#1-2-1-JavaVM" class="headerlink" title="1.2.1 JavaVM"></a>1.2.1 JavaVM</h3><p>Java执行环境是JVM，其实是主机环境中的一个进程，每个JVM在本地环境都有一个JavaVM结构体，该结构体在创建JVM时返回</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">JNI_CreateJavaVM(JavaVM **pvm, <span class="keyword">void</span> **penv, <span class="keyword">void</span> *args);</span><br></pre></td></tr></tbody></table></figure><p>JavaVM是JVM在JNI层的代表，JNI全局仅仅有一个JavaVM结构体，其中封装了一些函数指针(函数表结构)，JavaVM中封装的这些函数指针主要是针对JVM操作接口。另外，在C和CPP中JavaVM中定义有所不同</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * JNI Invocation Interface.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> __cplusplus</span></span><br><span class="line"><span class="keyword">typedef</span> JavaVM_ JavaVM;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">const</span> <span class="class"><span class="keyword">struct</span> <span class="title">JNIInvokeInterface_</span> *<span class="title">JavaVM</span>;</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></tbody></table></figure><p>在CPP中对JavaVM进行了一次封装，少一个参数，所以推荐使用CPP</p><h3 id="1-2-2-JNIEnv"><a href="#1-2-2-JNIEnv" class="headerlink" title="1.2.2 JNIEnv"></a>1.2.2 JNIEnv</h3><p>在<code>jni.h</code>中还声明一样东西</p><figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * JNI Native Method Interface.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> __cplusplus</span></span><br><span class="line"><span class="keyword">typedef</span> JNIEnv_ JNIEnv;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">const</span> <span class="class"><span class="keyword">struct</span> <span class="title">JNINativeInterface_</span> *<span class="title">JNIEnv</span>;</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></tbody></table></figure><p>JNIEnv是当前Java线程执行环境，一个JVM对应一个JavaVM结构体，而一个JVM可以创建多个Java线程，每一个Java线程对应一个JNIEnv结构，他们保存在线程本地存储TLS中。因此，不同线程的JNIEnv是不同的，不能共用。JNIEnv也是一个函数表，在本地代码中通过JNIEnv的函数表来操作Java数据或调用Java方法。</p><p>从这里也可看出来，c和cpp在使用env时的区别了</p><h1 id="2-Android-JNI"><a href="#2-Android-JNI" class="headerlink" title="2 Android JNI"></a>2 Android JNI</h1><p>Android中使用JNI需要NDK(Native Develop Kit)，先体验一把</p><h2 id="2-1-Java-call-C-CPP"><a href="#2-1-Java-call-C-CPP" class="headerlink" title="2.1 Java call C/CPP"></a>2.1 Java call C/CPP</h2><h3 id="2-1-1-传统方式"><a href="#2-1-1-传统方式" class="headerlink" title="2.1.1 传统方式"></a>2.1.1 传统方式</h3><ol><li><p>创建 HelloWorld.java 并点击一下 <strong>Build</strong></p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> io.github.sidneygod.jni_1;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloWorld</span> </span>{</span><br><span class="line">    <span class="keyword">static</span> {</span><br><span class="line">        System.loadLibrary(<span class="string">"HelloWorld"</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">native</span> String <span class="title">sayHello</span><span class="params">(String str)</span></span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></li><li><p>生成c/cpp头文件</p><p>可以直接找到对应的<code>HelloWorld.class</code>文件，然后使用<code>javah -jni HelloWorld</code></p><p>也可以这样，在IDE的Terminal中，进入<code>app/src/main/java/</code>，输入对应的指令</p><p><code>javah -jni io.github.sidneygod.jni_1.HelloWorld</code></p><p><img alt data-src="https://gitee.com/SidneyGod/ImagePlace/raw/master/image-20200301160545773.png"></p></li><li><p>在main下创建jni目录，编写对应的c/cpp文件</p><p>这里不在赘述c/cpp文件，记得把刚刚的头文件也给拷过来，比较烦人的是，不能用cout..所以改成了ndk的log</p><p><img alt data-src="https://gitee.com/SidneyGod/ImagePlace/raw/master/image-20200301172026651.png"></p></li><li><p>编写<code>Android.mk</code>文件</p><p>在jni目录创建<code>Android.mk</code>文件</p><figure class="highlight makefile"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">LOCAL_PATH := <span class="variable">$(<span class="built_in">call</span> my-<span class="built_in">dir</span>)</span></span><br><span class="line"><span class="keyword">include</span> <span class="variable">$(CLEAR_VARS)</span></span><br><span class="line">LOCAL_MODULE := HelloWorld</span><br><span class="line">LOCAL_SRC_FILES := io_github_sidneygod_jni_1_HelloWorld.cpp</span><br><span class="line"><span class="comment"># 为了能打印log</span></span><br><span class="line">LOCAL_LDLIBS := -lm -llog</span><br><span class="line"><span class="keyword">include</span> <span class="variable">$(BUILD_SHARED_LIBRARY)</span></span><br></pre></td></tr></tbody></table></figure></li><li><p>修改app下的build.gradle</p><figure class="highlight groovy"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">apply <span class="string">plugin:</span> <span class="string">'com.android.application'</span></span><br><span class="line"></span><br><span class="line">android {</span><br><span class="line">    ...</span><br><span class="line">    defaultConfig {</span><br><span class="line">        ...</span><br><span class="line">        ndk {</span><br><span class="line">            <span class="comment">// 这个moduleName和mk文件的LOCAL_MODULE一致</span></span><br><span class="line">            moduleName <span class="string">"HelloWorld"</span></span><br><span class="line">            <span class="comment">// 打印日志需要的</span></span><br><span class="line">            ldLibs <span class="string">"log"</span>, <span class="string">"z"</span>, <span class="string">"m"</span></span><br><span class="line">            <span class="comment">// 指定生成对应版本的库文件 不加这句话默认生成全部</span></span><br><span class="line">            abiFilters <span class="string">"arm64-v8a"</span>, <span class="string">"armeabi-v7a"</span>, <span class="string">"x86_64"</span>, <span class="string">"x86"</span></span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    buildTypes {</span><br><span class="line">        ...</span><br><span class="line">        externalNativeBuild {</span><br><span class="line">            ndkBuild {</span><br><span class="line">                path <span class="string">'src/main/jni/Android.mk'</span></span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>改完了需要sync一下</p></li><li><p>编译运行</p><p><img alt data-src="https://gitee.com/SidneyGod/ImagePlace/raw/master/image-20200301172240368.png"></p><p>和预想中的一毛一样..生成的库文件就在<code>build/intermediates/ndkBuild/debug/obj/local/x86/libHelloWorld.so</code></p></li></ol><h3 id="2-1-2-CMake工具"><a href="#2-1-2-CMake工具" class="headerlink" title="2.1.2 CMake工具"></a>2.1.2 CMake工具</h3><p>直接新建一个Native C++项目</p><p><img alt data-src="https://gitee.com/SidneyGod/ImagePlace/raw/master/image-20200301172757769.png"></p><p>然后会自动生成一个demo，直接运行就可以了..</p><p><img alt data-src="https://gitee.com/SidneyGod/ImagePlace/raw/master/image-20200301173118469.png"></p><p>可以看到多了个CMakeLists.txt, 看一下<code>build.gradle</code>文件</p><figure class="highlight groovy"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">apply <span class="string">plugin:</span> <span class="string">'com.android.application'</span></span><br><span class="line"></span><br><span class="line">android {</span><br><span class="line">    compileSdkVersion <span class="number">29</span></span><br><span class="line">    buildToolsVersion <span class="string">"29.0.3"</span></span><br><span class="line">    defaultConfig {</span><br><span class="line">        ...</span><br><span class="line">        externalNativeBuild {</span><br><span class="line">            cmake {</span><br><span class="line">                cppFlags <span class="string">""</span></span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    ...</span><br><span class="line">    externalNativeBuild {</span><br><span class="line">        cmake {</span><br><span class="line">            path <span class="string">"src/main/cpp/CMakeLists.txt"</span></span><br><span class="line">            version <span class="string">"3.10.2"</span></span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>出现了两次externalNativeBuild</p><p>第一次: 填写CMake参数, 详情参考<a href="https://developer.android.google.cn/ndk/guides/cmake.html" target="_blank" rel="noopener">CMake|Android NDK</a></p><p>第二次: 指明CMakeLists.txt路径</p><p>看看这个CMakeLists.txt到底是什么鬼</p><figure class="highlight cmake"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION <span class="number">3.4</span>.<span class="number">1</span>)</span><br><span class="line">...</span><br><span class="line"><span class="keyword">add_library</span>(</span><br><span class="line">             native-lib</span><br><span class="line">             SHARED</span><br><span class="line">             native-lib.cpp )</span><br><span class="line">...</span><br><span class="line"><span class="keyword">find_library</span>(</span><br><span class="line">              log-lib</span><br><span class="line">              log )</span><br><span class="line">...</span><br><span class="line"><span class="keyword">target_link_libraries</span>(</span><br><span class="line">                       native-lib</span><br><span class="line">                       <span class="variable">${log-lib}</span> )</span><br></pre></td></tr></tbody></table></figure><ul><li>cmake_minimum_required(): 指定CMake最小版本</li><li>add_library: 创建一个静态或者动态库<ul><li>native-lib: 是库的名字</li><li>SHARED: 是库的类别 动态还是静态</li><li>native-lib.cpp: 库原文件路径</li></ul></li><li>find_library(): 找到一个预编译的库, 将之作为变量存起来<ul><li>log-lib: 设置路径变量名称</li><li>log: 制定NDK库的名字</li></ul></li><li>target_link_libraries(): 指定CMake链接到的目标库<ul><li>native-lib: 指定的目标库</li><li>${log-lib}: 将目标库链接到NDK中的日志库</li></ul></li></ul><p><a href="http://cmake.org/documentation" target="_blank" rel="noopener">CMake文档-英文</a> <a href="https://www.zybuluo.com/khan-lau/note/254724" target="_blank" rel="noopener">CMake手册-中文</a></p><p>注意: 与Instant Run不兼容</p><h2 id="2-2-C-Cpp-call-Java"><a href="#2-2-C-Cpp-call-Java" class="headerlink" title="2.2 C/Cpp call Java"></a>2.2 C/Cpp call Java</h2><h3 id="2-2-1-函数签名"><a href="#2-2-1-函数签名" class="headerlink" title="2.2.1 函数签名"></a>2.2.1 函数签名</h3><p>首先看一眼<code>jni.h</code>中对JNINativeMethod的定义</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> {</span></span><br><span class="line">    <span class="keyword">char</span> *name;</span><br><span class="line">    <span class="keyword">char</span> *signature;</span><br><span class="line">    <span class="keyword">void</span> *fnPtr;</span><br><span class="line">} JNINativeMethod;</span><br></pre></td></tr></tbody></table></figure><p>函数名, 函数指针都好理解, 多出来一个函数签名, 这是因为Java允许方法重载, 光靠名字是分别不出来是哪个方法的</p><p>查看一个类中函数的签名</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 一定要写对class文件的目录</span></span><br><span class="line">javap -s JniHello.class</span><br></pre></td></tr></tbody></table></figure><p>然后就可以看到一坨..</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Compiled from "JniHello.java"</span><br><span class="line">public class JniHello {</span><br><span class="line">  public JniHello();</span><br><span class="line">    descriptor: ()V</span><br><span class="line"></span><br><span class="line">  public static native java.lang.String hello(java.lang.String);</span><br><span class="line">    descriptor: (Ljava/lang/String;)Ljava/lang/String;</span><br><span class="line"></span><br><span class="line">  public static void main(java.lang.String[]);</span><br><span class="line">    descriptor: ([Ljava/lang/String;)V</span><br><span class="line"></span><br><span class="line">  static {};</span><br><span class="line">    descriptor: ()V</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>第一个<code>()V</code>：默认构造函数的签名</p><p>第二个<code>(Ljava/lang/String;)Ljava/lang/String;</code>：是那个native函数的签名</p><p>第三个<code>([Ljava/lang/String;)V</code>：是main函数的签名</p><p>第四个<code>()V</code>：是哪个静态代码块的</p><p>JNI规范定义的函数签名信息(<font color="red">注意这个”;” 不加是识别不出来的..</font>)</p><p><code>(参数1类型标识;参数2类型标识;...;)返回值类型标识;</code></p><ul><li>当类型是引用类型时: L+包名+类名, Ljava/lang/String</li><li>当类型是基本类型时: 除了boolean是Z, long是J, 其他全是基本类型首字母大写, V就是void</li><li>数组<ul><li>一般数组: [签名</li><li>int[]: [i</li><li>String[]: [LJava/lang/Object</li></ul></li></ul><h3 id="2-2-2-实例"><a href="#2-2-2-实例" class="headerlink" title="2.2.2 实例"></a>2.2.2 实例</h3><p>把那个啥上面传统方式的改一下</p><p>先在HelloWorld.java中加两个函数</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloWorld</span> </span>{</span><br><span class="line">    <span class="keyword">static</span> {</span><br><span class="line">        System.loadLibrary(<span class="string">"HelloWorld"</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">native</span> String <span class="title">sayHello</span><span class="params">(String str)</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 新增native函数</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">native</span> <span class="keyword">void</span> <span class="title">nHello</span><span class="params">(String str)</span></span>;</span><br><span class="line">    <span class="comment">// native要调用的函数</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">hello</span><span class="params">(String str)</span> </span>{</span><br><span class="line">        Log.d(<span class="string">"SidneyGod"</span>, <span class="string">"hello: "</span> + str);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Java!"</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>再去完善cpp文件新增的函数nHello</p><figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">JNIEXPORT <span class="keyword">void</span> JNICALL Java_io_github_sidneygod_jni_11_HelloWorld_nHello</span><br><span class="line">  (JNIEnv *env, jclass clazz, jstring contentStr)</span><br><span class="line">{</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span>* jStr = env->GetStringUTFChars(contentStr, JNI_FALSE);</span><br><span class="line">    LOGE(<span class="string">"Welcome to C/CPP! jStr: %s"</span>, jStr);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取HelloWorld的class 包名 + 类名</span></span><br><span class="line">    jclass helloWorld = env->FindClass(<span class="string">"io/github/sidneygod/jni_1/HelloWorld"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取HelloWorld的静态方法hello 类, 方法名, 方法签名</span></span><br><span class="line">    jmethodID hello = env->GetStaticMethodID(</span><br><span class="line">                          helloWorld,</span><br><span class="line">                          <span class="string">"hello"</span>,</span><br><span class="line">                          <span class="string">"(Ljava/lang/String;)Ljava/lang/String;"</span>);</span><br><span class="line">    <span class="comment">// 创建字符串</span></span><br><span class="line">    jstring cStr = env->NewStringUTF(<span class="string">"Hello, I am from JNI."</span>);</span><br><span class="line">    <span class="comment">// 调用Java静态方法 类, 方法, 方法参数...</span></span><br><span class="line">    jstring ret = (jstring) env->CallStaticObjectMethod(helloWorld, hello, cStr);</span><br><span class="line">    <span class="comment">// 打印返回值</span></span><br><span class="line">    LOGE(<span class="string">"Return Value: %s"</span>, env->GetStringUTFChars(ret, JNI_FALSE));</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>其他基本上没什么变化，在click2中调用nHello()，就会触发调用HelloWorld的hello()函数</p><p><img alt data-src="https://gitee.com/SidneyGod/ImagePlace/raw/master/image-20200301182529753.png"></p></body></html>]]></content>
      
      
      <categories>
          
          <category> Android </category>
          
      </categories>
      
      
        <tags>
            
            <tag> jni </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Build OpenGrok To Read the Fuck Source Code</title>
      <link href="/posts/ad7ab3b5/"/>
      <url>/posts/ad7ab3b5/</url>
      
        <content type="html"><![CDATA[<html><head></head><body><h1 id="0-缘起"><a href="#0-缘起" class="headerlink" title="0 缘起"></a>0 缘起</h1><p>之前看代码都是非常少的, 所以基本就用IDE啦, 还能调试, 后来接触Android, 源码量太大了, 导入IDE去看太慢了..然后开始搜神器, 就有了Source Insight, Understand..说不出来哪不好, 反正就是不爽, 最后觉得还是OpenGrok好用..那就动手搭建一个吧, 官方文档: <a href="https://github.com/oracle/opengrok/wiki/How-to-setup-OpenGrok" target="_blank" rel="noopener">https://github.com/oracle/opengrok/wiki/How-to-setup-OpenGrok</a></p><h1 id="1-搭环境"><a href="#1-搭环境" class="headerlink" title="1 搭环境"></a>1 搭环境</h1><p>首先, 我在Win10和CentOS7.6上都试验成功了, 但是个人建议看有关Linux的代码还是用Linux比较好, 在后面下源码的时候会说为啥, 但是鉴于Windows用得比较多(我就是..), 所以整理了两份文档, 废话不多说, 开始..</p><a id="more"></a><h2 id="1-1-Windows"><a href="#1-1-Windows" class="headerlink" title="1.1 Windows"></a>1.1 Windows</h2><p>首先在Windows环境下搭建..</p><h3 id="1-1-1-prepare"><a href="#1-1-1-prepare" class="headerlink" title="1.1.1 prepare"></a>1.1.1 prepare</h3><p>需要准备以下几样东西:</p><ol><li><strong>JDK(版本要大于8)</strong></li></ol><p>下载地址: <a href="https://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html" target="_blank" rel="noopener">https://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html</a></p><p>安装好后记得配置一下环境变量, 不再赘述</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">JAVA_HOME : D:\Develop\JDK\jdk1.8.0_211</span><br><span class="line">JRE_HOME : D:\Develop\JDK\jre1.8.0_211</span><br><span class="line">CLASSPATH : .;%JAVA_HOME%\lib\dt.jar;%JAVA_HOME%\lib\tools.jar;</span><br><span class="line"></span><br><span class="line">%JAVA_HOME%\bin</span><br><span class="line">%JRE_HOME%\bin</span><br></pre></td></tr></tbody></table></figure><ol start="2"><li><strong>Tomcat(版本大于8)</strong></li></ol><p>关于容器的选择, 并不一定要Tomcat, 其它的也可以, 比如jetty, 我用的是Tomcat8, <a href="http://mirrors.tuna.tsinghua.edu.cn/apache/tomcat/tomcat-8/v8.5.50/bin/apache-tomcat-8.5.50-windows-x64.zip" target="_blank" rel="noopener">点此下载</a></p><p>下载好后, 解压即可, 个人比较喜欢用压缩版的而不是安装版的, 然后记得配置一下环境变量</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">CATALINA_HOME : D:\Develop\apache-tomcat\apache-tomcat-8.5.50</span><br><span class="line"></span><br><span class="line">%CATALINA_HOME%\bin</span><br><span class="line">%CATALINA_HOME%\lib</span><br></pre></td></tr></tbody></table></figure><ol start="3"><li><strong>Universal-ctags</strong></li></ol><p>这个是必须的, OpenGork依赖这个东西, 由于是Windows, 直接下载release版本就好了, 下载地址: <a href="https://github.com/universal-ctags/ctags-win32/releases" target="_blank" rel="noopener">https://github.com/universal-ctags/ctags-win32/releases</a> 选择对应的版本, 我这里选的是64bit</p><p><img alt="Universal-ctags" data-src="https://raw.githubusercontent.com/SidneyGod/ImagePlace/master/20200101120519.jpg"></p><p>解压到相应的文件夹下</p><ol start="4"><li><strong>OpenGrok</strong></li></ol><p>和Universal-ctags一样, 直接下release版本就好了, 不要下源码, 下载地址: <a href="https://github.com/oracle/opengrok/releases" target="_blank" rel="noopener">https://github.com/oracle/opengrok/releases</a> </p><p><img alt="OpenGrok" data-src="https://raw.githubusercontent.com/SidneyGod/ImagePlace/master/20200101122204.png"></p><p>没得选, 不用选..</p><ol start="5"><li>下载源码</li></ol><p>我主要是为了看Android源码, 这个如何下载放到后面说..现在假设已经下载好了</p><h3 id="1-1-2-indexing"><a href="#1-1-2-indexing" class="headerlink" title="1.1.2 indexing"></a>1.1.2 indexing</h3><p>在使用OpenGrok之前是需要建立索引的, 这一点和Source Insight一样, 是一个漫长的等待时间..</p><ol><li>运行Tomcat</li></ol><p>进入到Tomcat的bin目录, 我这里是<code>D:\Develop\apache-tomcat\apache-tomcat-8.5.50\bin</code>, 双击<code>startup.bat</code>启动Tomcat, 一般Windows启动成功都是有个命令窗口的, 类似这样</p><p><img alt="start-tomcat" data-src="https://raw.githubusercontent.com/SidneyGod/ImagePlace/master/20200101130320.png"></p><ol start="2"><li>拷贝<code>source.war</code></li></ol><p>将OpenGrok目录下的<code>lib/source.war</code>拷贝至Tomcat的webapps目录下, 我这边分别是<code>D:\Develop\apache-tomcat\opengrok-1.3.6\lib\source.war</code>和<code>D:\Develop\apache-tomcat\apache-tomcat-8.5.50\webapps</code>, 如果正常的话, <code>source.war</code>会自动解压成一个文件夹..</p><p><img alt="source" data-src="https://raw.githubusercontent.com/SidneyGod/ImagePlace/master/20200101131123.png"></p><p>我这里将tomcat原有的其他不相干的文件夹全删了..因为用不上..</p><ol start="3"><li>创建软链接</li></ol><p>首先在OpenGrok文件夹下, 建两个文件夹<code>index</code>和<code>source</code>, 分别用于存储索引文件和项目源码的软链接(这似乎是Linux概念, 问题不大, 且这么表述)</p><p>首先到source文件夹下(<code>D:\Develop\apache-tomcat\opengrok-1.3.6\source</code>), 然后如图所示</p><p><img alt="cmd" data-src="https://raw.githubusercontent.com/SidneyGod/ImagePlace/master/20200101131909.png"></p><p>就能出现出现cmd窗口了, 且在当前路径, 然后再执行下面这个命令给源码创建一个软链接</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 链接名 和 源码绝对路径</span></span><br><span class="line">mklink /J android10-release E:\FuckSource\android10-release</span><br></pre></td></tr></tbody></table></figure><p>执行完之后, 该目录下就会多出个文件夹了, 看起来和复制过来的一样, 其实只是个链接</p><ol start="4"><li>建立索引</li></ol><p>第一次使用OpenGrok需要建立索引, 这个时间很长的, 要有心理准备..其实做起来很简单, 在cmd窗口执行一条命令即可, 在此之前先修改一下OpenGrok的配置, 到Tomcat的webapps文件下, 进入source文件夹, 接着按着这个路径找<code>WEB-INF\web.xml</code>, 我这边的路径是<code>D:\Develop\apache-tomcat\apache-tomcat-8.5.50\webapps\source\WEB-INF\web.xml</code>, 打开这个文件</p><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"><?xml version="1.0" encoding="UTF-8"?></span></span><br><span class="line"><span class="tag"><<span class="name">web-app</span> <span class="attr">xmlns</span>=<span class="string">"http://xmlns.jcp.org/xml/ns/javaee"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://xmlns.jcp.org/xml/ns/javaee</span></span></span><br><span class="line"><span class="tag"><span class="string">         http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">version</span>=<span class="string">"3.1"</span>></span></span><br><span class="line"></span><br><span class="line">    <span class="tag"><<span class="name">display-name</span>></span>OpenGrok<span class="tag"></<span class="name">display-name</span>></span></span><br><span class="line">    <span class="tag"><<span class="name">description</span>></span>A wicked fast source browser<span class="tag"></<span class="name">description</span>></span></span><br><span class="line">    <span class="tag"><<span class="name">context-param</span>></span></span><br><span class="line">        <span class="tag"><<span class="name">description</span>></span>Full path to the configuration file where OpenGrok can read its configuration<span class="tag"></<span class="name">description</span>></span></span><br><span class="line">        <span class="tag"><<span class="name">param-name</span>></span>CONFIGURATION<span class="tag"></<span class="name">param-name</span>></span></span><br><span class="line">        <span class="comment"><!-- 修改成你要存放配置文件的地方 --></span></span><br><span class="line">        <span class="tag"><<span class="name">param-value</span>></span>D:/Develop/apache-tomcat/opengrok-1.3.6/index/configuration.xml<span class="tag"></<span class="name">param-value</span>></span></span><br><span class="line">    <span class="tag"></<span class="name">context-param</span>></span></span><br></pre></td></tr></tbody></table></figure><p>这些做完后, 再执行下面这条命令</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">java -Xmx524m -jar <span class="string">"D:\\Develop\\apache-tomcat\\opengrok-1.3.6\\lib\\opengrok.jar"</span> -W <span class="string">"D:\\Develop\\apache-tomcat\\opengrok-1.3.6\\index\\configuration.xml"</span> -P -S -v -s <span class="string">"D:\\Develop\\apache-tomcat\\opengrok-1.3.6\\source"</span> -d <span class="string">"D:\\Develop\\apache-tomcat\\opengrok-1.3.6\\index"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 分析一下</span></span><br><span class="line"><span class="comment"># -jar 跟的是 OpenGrok下的lib/opengrok.jar</span></span><br><span class="line"><span class="comment"># -W 跟的是 配置文件位置</span></span><br><span class="line"><span class="comment"># -P -S -v 照着加就是了</span></span><br><span class="line"><span class="comment"># -s 跟的是 源码位置</span></span><br><span class="line"><span class="comment"># -d 跟的是 索引位置</span></span><br><span class="line"><span class="comment"># 还有更多配置选项可以使用 java -jar /path/to/opengrok.jar 查看</span></span><br></pre></td></tr></tbody></table></figure><p>经过漫长的等待, 索引建立完成了, 就可以打开浏览器, 通过 <a href="http://127.0.0.1:8080/source" target="_blank" rel="noopener">http://127.0.0.1:8080/source</a> 进行访问了, 如果以后代码有更新, 可以再用这条命令进行增量建立索引</p><p><img alt="open grok" data-src="https://raw.githubusercontent.com/SidneyGod/ImagePlace/master/20200101134613.png"></p><p>如果你打开的和我不一样, 是白底的不用慌张, 因为我魔改了一下css文件, 样式表在<code>D:\Develop\apache-tomcat\apache-tomcat-8.5.50\webapps\source\default\style.min.css</code>, 想自定义的格式可以配合浏览器的检查元素, 魔改一波..</p><h2 id="1-2-Linux"><a href="#1-2-Linux" class="headerlink" title="1.2 Linux"></a>1.2 Linux</h2><p>和Windows的搭建方法很类似, 既然都用Linux了, 那废话不多说了, 敬你是个高手, 我直接搬文档了</p><h3 id="1-2-1-Requirements"><a href="#1-2-1-Requirements" class="headerlink" title="1.2.1 Requirements"></a>1.2.1 Requirements</h3><ol><li><p><a href="http://www.oracle.com/technetwork/java/" target="_blank" rel="noopener">JDK</a> 1.8 or higher</p></li><li><p>OpenGrok ‘’’binaries’’’ from <a href="https://github.com/OpenGrok/OpenGrok/releases" target="_blank" rel="noopener">https://github.com/OpenGrok/OpenGrok/releases</a> (<strong>.tar.gz file</strong> with binaries, not the source code tarball !)</p></li><li><p><a href="https://github.com/universal-ctags" target="_blank" rel="noopener">https://github.com/universal-ctags</a> for analysis (avoid Exuberant ctags, they are not maintained anymore)</p></li></ol><p>这个有必要解释一下, 先把本地的ctags卸了, 具体见命令行</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1 卸载</span></span><br><span class="line"><span class="comment">## Ubuntu</span></span><br><span class="line">sudo apt-get remove ctags</span><br><span class="line">sudo apt-get autoremove</span><br><span class="line">sudo apt-get install autoconf</span><br><span class="line">sudo apt-get install automake</span><br><span class="line"><span class="comment">## CentOS</span></span><br><span class="line">yum list installed | grep ctags</span><br><span class="line">yum -y remove ctags  <span class="comment"># 因为我的环境本就没有 所以不知道具体啥名</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2 安装辅助工具</span></span><br><span class="line"><span class="comment">## Ubuntu</span></span><br><span class="line">sudo apt-get install autoconf</span><br><span class="line">sudo apt-get install automake</span><br><span class="line"><span class="comment">## CentOS</span></span><br><span class="line">yum install autoconf automake</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3 安装universal-ctags</span></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/universal-ctags/ctags.git</span><br><span class="line"><span class="built_in">cd</span> ctags</span><br><span class="line">./autogen.sh </span><br><span class="line">./configure</span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></tbody></table></figure><ol start="4"><li><p>A servlet container like <a href="https://glassfish.dev.java.net/" target="_blank" rel="noopener">GlassFish</a> or <strong><a href="http://tomcat.apache.org" target="_blank" rel="noopener">Tomcat</a> 8.0</strong> or later also running with Java at least 1.8 配一个容器</p></li><li><p>下载源码..如有需要, 看第二章</p></li></ol><h3 id="1-2-2-Creating-the-index"><a href="#1-2-2-Creating-the-index" class="headerlink" title="1.2.2 Creating the index"></a>1.2.2 Creating the index</h3><p>总结一下目前情况: Tomcat配置好了, 并且正在运行中; OpenGrok解压好了; universal-ctags安装好了</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1 安装辅助工具</span></span><br><span class="line"><span class="built_in">cd</span> /root/MyApp/opengrok-1.3.6/tools/</span><br><span class="line">python3 -m pip install opengrok-tools.tar.gz  <span class="comment"># 必须是python3</span></span><br><span class="line"><span class="comment"># 2 创建两个文件夹</span></span><br><span class="line">mkdir /root/MyApp/opengrok-1.3.6/index  <span class="comment"># 存储索引</span></span><br><span class="line">mkdir /root/MyApp/opengrok-1.3.6/<span class="built_in">source</span>  <span class="comment"># 存储源码软链接</span></span><br><span class="line"><span class="comment"># 3 创建源码软链接</span></span><br><span class="line"><span class="built_in">cd</span> /root/MyApp/opengrok-1.3.6/<span class="built_in">source</span></span><br><span class="line">ln -s /root/FuckSource/android10-release/ android10-release</span><br><span class="line"><span class="comment"># 4 将OpenGrok下lib下的source.war拷贝到Tomcat下webapps下</span></span><br><span class="line">cp /root/MyApp/opengrok-1.3.6/lib/source.war /usr/<span class="built_in">local</span>/apps/apache-tomcat-8.5.45/webapps/  <span class="comment"># 拷贝后会自动解压出一个 source文件夹</span></span><br><span class="line"><span class="comment"># 5 修改配置文件</span></span><br><span class="line">vim /usr/<span class="built_in">local</span>/apps/apache-tomcat-8.5.45/webapps/<span class="built_in">source</span>/WEB-INF/web.xml</span><br><span class="line">    <span class="comment"># 找到这个</span></span><br><span class="line">    <context-param></span><br><span class="line">        <description>Full path to the configuration file <span class="built_in">where</span> OpenGrok can <span class="built_in">read</span> its configuration</description></span><br><span class="line">        <param-name>CONFIGURATION</param-name></span><br><span class="line">        <span class="comment"># 把这个目录修改一下 这是存放配置的 很重要</span></span><br><span class="line">        <param-value>/root/MyApp/opengrok-1.3.6/index/configuration.xml</param-value></span><br><span class="line">    </context-param></span><br><span class="line"><span class="comment"># 6 执行建立索引命令</span></span><br><span class="line">opengrok-indexer \</span><br><span class="line">    -J=-Djava.util.logging.config.file=/root/MyApp/opengrok-1.3.8/doc/logging.properties \</span><br><span class="line">    -a <span class="string">"/root/MyApp/opengrok-1.3.8/lib/opengrok.jar"</span> -- \</span><br><span class="line">    -c <span class="string">"/usr/local/bin/ctags"</span> \</span><br><span class="line">    -s <span class="string">"/root/MyApp/opengrok-1.3.8/source/"</span> \</span><br><span class="line">    -d <span class="string">"/root/MyApp/opengrok-1.3.8/index/"</span> -H -P -S -G -v \</span><br><span class="line">    -W <span class="string">"/root/MyApp/opengrok-1.3.8/index/configuration.xml"</span> \</span><br><span class="line">    -U http://localhost:80/<span class="built_in">source</span></span><br><span class="line"> <span class="comment">## 第一次执行这个命令 时间很长</span></span><br><span class="line"> <span class="comment">## -a 接 opengrok.jar位置</span></span><br><span class="line"> <span class="comment">## -c 接 ctags位置 [可忽略]</span></span><br><span class="line"> <span class="comment">## -s 接 存源码软链接位置</span></span><br><span class="line"> <span class="comment">## -s 接 存索引位置</span></span><br><span class="line"> <span class="comment">## -W 接 存配置文件位置</span></span><br><span class="line"> <span class="comment">## -H -P -S -G -v 就照抄吧</span></span><br><span class="line"> <span class="comment">## 还有更多配置选项</span></span><br><span class="line"> <span class="comment">## 使用 opengrok-indexer -a /root/MyApp/opengrok-1.3.8/lib/opengrok.jar -- -h 查看</span></span><br><span class="line"><span class="comment"># 7 如果以后源码有更新, 可以再次使用该命令进行增量建立索引</span></span><br></pre></td></tr></tbody></table></figure><p>等命令执行完毕后, 就可以访问了, 我这边是没问题的 <a href="http://101.132.124.174/source" target="_blank" rel="noopener">http://101.132.124.174/source</a></p><h1 id="2-下源码"><a href="#2-下源码" class="headerlink" title="2 下源码"></a>2 下源码</h1><p>下Android源码, Android官网上就有, 不过要翻墙, 所以一般用清华源: <a href="https://mirrors.tuna.tsinghua.edu.cn/help/AOSP/" target="_blank" rel="noopener">https://mirrors.tuna.tsinghua.edu.cn/help/AOSP/</a> 如果要下载完整的源码, 这里写的非常清楚, 但是条件就是Linux, 如果这符合你的需求, 你就可以按照这个方法做了, 下面是我另有所图</p><p>情况1, 我用的是Windows, repo不好用; 情况2, 磁盘容量小, 只想下载自己需要的源码</p><p>首先github上是有aosp镜像仓库的: <a href="https://github.com/aosp-mirror" target="_blank" rel="noopener">https://github.com/aosp-mirror</a></p><p>知道有这么个镜像不是为了下源码, 当然, 也可以, 不过我觉得清华源应该会快一点, 其实我只是为了看有哪些分支, 打开manifest仓库: <a href="https://github.com/aosp-mirror/platform_manifest" target="_blank" rel="noopener">https://github.com/aosp-mirror/platform_manifest</a></p><p><img alt="manifest" data-src="https://raw.githubusercontent.com/SidneyGod/ImagePlace/master/20200101150409.png"></p><p>比如我就选<code>android10-release</code>这个分支了, 那就在本地创建一个文件夹android10-release, 打开git终端</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># clone我们想要的分支的manifest文件 不想要全部的 其实也无所谓 只要default.xml就够了 其他可以删了</span></span><br><span class="line">git <span class="built_in">clone</span> -b android10-release --single-branch https://aosp.tuna.tsinghua.edu.cn/platform/manifest.git</span><br></pre></td></tr></tbody></table></figure><p>这一步完成之后, 就会看到一个manifest文件夹, 打开这个文件夹里面的<code>default.xml</code>文件, 大概是这个样子的</p><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"><?xml version="1.0" encoding="UTF-8"?></span></span><br><span class="line"><span class="tag"><<span class="name">manifest</span>></span></span><br><span class="line">  <span class="tag"><<span class="name">remote</span>  <span class="attr">name</span>=<span class="string">"aosp"</span></span></span><br><span class="line"><span class="tag">           <span class="attr">fetch</span>=<span class="string">".."</span></span></span><br><span class="line"><span class="tag">           <span class="attr">review</span>=<span class="string">"https://android-review.googlesource.com/"</span> /></span></span><br><span class="line">  <span class="comment"><!-- 这个default应该就是默认配置 revision就是默认分支, 表示下面的所有的project的分支如果没有指定, 就是这个分支 --></span></span><br><span class="line">  <span class="tag"><<span class="name">default</span> <span class="attr">revision</span>=<span class="string">"android10-release"</span></span></span><br><span class="line"><span class="tag">           <span class="attr">remote</span>=<span class="string">"aosp"</span></span></span><br><span class="line"><span class="tag">           <span class="attr">sync-j</span>=<span class="string">"4"</span> /></span></span><br><span class="line">  <span class="comment"><!-- 每个project就是一个git, 就是一个目录, 但是显然, 如果仅仅是阅读源码, 并不需要android所有的project, 因为看不过来 --></span></span><br><span class="line">  <span class="tag"><<span class="name">project</span> <span class="attr">path</span>=<span class="string">"build/make"</span> <span class="attr">name</span>=<span class="string">"platform/build"</span> <span class="attr">groups</span>=<span class="string">"pdk"</span> ></span></span><br><span class="line">    <span class="tag"><<span class="name">copyfile</span> <span class="attr">src</span>=<span class="string">"core/root.mk"</span> <span class="attr">dest</span>=<span class="string">"Makefile"</span> /></span></span><br><span class="line">    <span class="tag"><<span class="name">linkfile</span> <span class="attr">src</span>=<span class="string">"CleanSpec.mk"</span> <span class="attr">dest</span>=<span class="string">"build/CleanSpec.mk"</span> /></span></span><br><span class="line">    ...略</span><br><span class="line">  <span class="tag"></<span class="name">project</span>></span></span><br><span class="line">  <span class="tag"><<span class="name">project</span> <span class="attr">path</span>=<span class="string">"build/blueprint"</span> <span class="attr">name</span>=<span class="string">"platform/build/blueprint"</span> <span class="attr">groups</span>=<span class="string">"pdk,tradefed"</span> /></span></span><br><span class="line">  <span class="tag"><<span class="name">project</span> <span class="attr">path</span>=<span class="string">"build/kati"</span> <span class="attr">name</span>=<span class="string">"platform/build/kati"</span> <span class="attr">groups</span>=<span class="string">"pdk,tradefed"</span> /></span></span><br><span class="line">  <span class="tag"><<span class="name">project</span> <span class="attr">path</span>=<span class="string">"build/soong"</span> <span class="attr">name</span>=<span class="string">"platform/build/soong"</span> <span class="attr">groups</span>=<span class="string">"pdk,tradefed"</span> ></span></span><br><span class="line">  略.略.略..</span><br></pre></td></tr></tbody></table></figure><p>这些只是Android的源码, 并不包含kernel的源码, 不信你找找kernel的project</p><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"><!-- 编译相关 配置相关 测试相关 源码呢? --></span></span><br><span class="line"><span class="tag"><<span class="name">project</span> <span class="attr">path</span>=<span class="string">"kernel/build"</span> <span class="attr">name</span>=<span class="string">"kernel/build"</span> /></span></span><br><span class="line"><span class="tag"><<span class="name">project</span> <span class="attr">path</span>=<span class="string">"kernel/configs"</span> <span class="attr">name</span>=<span class="string">"kernel/configs"</span> <span class="attr">groups</span>=<span class="string">"vts,pdk"</span> /></span></span><br><span class="line"><span class="tag"><<span class="name">project</span> <span class="attr">path</span>=<span class="string">"kernel/tests"</span> <span class="attr">name</span>=<span class="string">"kernel/tests"</span> <span class="attr">groups</span>=<span class="string">"vts,pdk"</span> /></span></span><br></pre></td></tr></tbody></table></figure><p>其实kernel的源码单独放了, 由于Linux的原因, 各大厂商的内核源码应该是开源的, 于是你想看的</p><p>小米内核: <a href="https://github.com/MiCode/Xiaomi_Kernel_OpenSource" target="_blank" rel="noopener">https://github.com/MiCode/Xiaomi_Kernel_OpenSource</a></p><p>华为: <a href="https://consumer.huawei.com/en/opensource/detail/" target="_blank" rel="noopener">https://consumer.huawei.com/en/opensource/detail/</a></p><p>一加: <a href="https://github.com/OnePlusOSS" target="_blank" rel="noopener">https://github.com/OnePlusOSS</a></p><p>当然了, 是不是真的完全开了, 不得而知..不过Google的common内核应该全开了, 其它的应该都是从这个演化的吧, 只是我的猜测</p><p>再通过github看分支: <a href="https://github.com/aosp-mirror/kernel_common" target="_blank" rel="noopener">https://github.com/aosp-mirror/kernel_common</a></p><p><img alt="kernel_common" data-src="https://raw.githubusercontent.com/SidneyGod/ImagePlace/master/20200101152242.png"></p><p>我选的是<code>android-4.19-q-release</code>分支, 我参考了一下kernel的manifest, 然后融合一下, 得出了下main这个变体</p><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag"><<span class="name">project</span> <span class="attr">path</span>=<span class="string">"kernel/common"</span> <span class="attr">name</span>=<span class="string">"kernel/common"</span> <span class="attr">revision</span>=<span class="string">"q-common-android-4.19"</span> /></span></span><br></pre></td></tr></tbody></table></figure><p>把这一句加到<code>default.xml</code>文件中, 我的大概长这样</p><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">服了..这hexo有bug吧..再不行 放弃..</span><br><span class="line"><span class="meta"><?xml version="1.0" encoding="UTF-8"?></span></span><br><span class="line"><span class="tag"><<span class="name">manifest</span>></span></span><br><span class="line"></span><br><span class="line">  <span class="tag"><<span class="name">remote</span>  <span class="attr">name</span>=<span class="string">"aosp"</span></span></span><br><span class="line"><span class="tag">           <span class="attr">fetch</span>=<span class="string">".."</span></span></span><br><span class="line"><span class="tag">           <span class="attr">review</span>=<span class="string">"https://android-review.googlesource.com/"</span> /></span></span><br><span class="line">  <span class="tag"><<span class="name">default</span> <span class="attr">revision</span>=<span class="string">"android10-release"</span></span></span><br><span class="line"><span class="tag">           <span class="attr">remote</span>=<span class="string">"aosp"</span></span></span><br><span class="line"><span class="tag">           <span class="attr">sync-j</span>=<span class="string">"4"</span> /></span></span><br><span class="line"></span><br><span class="line">  <span class="tag"><<span class="name">project</span> <span class="attr">path</span>=<span class="string">"art"</span> <span class="attr">name</span>=<span class="string">"platform/art"</span> <span class="attr">groups</span>=<span class="string">"pdk"</span> /></span></span><br><span class="line">  <span class="tag"><<span class="name">project</span> <span class="attr">path</span>=<span class="string">"bionic"</span> <span class="attr">name</span>=<span class="string">"platform/bionic"</span> <span class="attr">groups</span>=<span class="string">"pdk"</span> /></span></span><br><span class="line">  <span class="tag"><<span class="name">project</span> <span class="attr">path</span>=<span class="string">"bootable/recovery"</span> <span class="attr">name</span>=<span class="string">"platform/bootable/recovery"</span> <span class="attr">groups</span>=<span class="string">"pdk"</span> /></span></span><br><span class="line">  <span class="tag"><<span class="name">project</span> <span class="attr">path</span>=<span class="string">"device/common"</span> <span class="attr">name</span>=<span class="string">"device/common"</span> <span class="attr">groups</span>=<span class="string">"pdk-cw-fs,pdk"</span> /></span></span><br><span class="line">  <span class="tag"><<span class="name">project</span> <span class="attr">path</span>=<span class="string">"device/generic/arm64"</span> <span class="attr">name</span>=<span class="string">"device/generic/arm64"</span> <span class="attr">groups</span>=<span class="string">"pdk"</span> /></span></span><br><span class="line">  <span class="tag"><<span class="name">project</span> <span class="attr">path</span>=<span class="string">"device/generic/armv7-a-neon"</span> <span class="attr">name</span>=<span class="string">"device/generic/armv7-a-neon"</span> <span class="attr">groups</span>=<span class="string">"pdk"</span> /></span></span><br><span class="line">  <span class="comment"><!--</span></span><br><span class="line"><span class="comment">  <project path="device/generic/car" name="device/generic/car" groups="pdk" /></span></span><br><span class="line"><span class="comment">  --></span></span><br><span class="line">  <span class="tag"><<span class="name">project</span> <span class="attr">path</span>=<span class="string">"device/generic/common"</span> <span class="attr">name</span>=<span class="string">"device/generic/common"</span> <span class="attr">groups</span>=<span class="string">"pdk"</span> /></span></span><br><span class="line">  <span class="tag"><<span class="name">project</span> <span class="attr">path</span>=<span class="string">"device/generic/goldfish"</span> <span class="attr">name</span>=<span class="string">"device/generic/goldfish"</span> <span class="attr">groups</span>=<span class="string">"pdk"</span> /></span></span><br><span class="line">  <span class="tag"><<span class="name">project</span> <span class="attr">path</span>=<span class="string">"device/generic/goldfish-opengl"</span> <span class="attr">name</span>=<span class="string">"device/generic/goldfish-opengl"</span> <span class="attr">groups</span>=<span class="string">"pdk"</span> /></span></span><br><span class="line">  <span class="tag"><<span class="name">project</span> <span class="attr">path</span>=<span class="string">"device/generic/opengl-transport"</span> <span class="attr">name</span>=<span class="string">"device/generic/opengl-transport"</span> <span class="attr">groups</span>=<span class="string">"pdk"</span> /></span></span><br><span class="line">  <span class="tag"><<span class="name">project</span> <span class="attr">path</span>=<span class="string">"device/generic/qemu"</span> <span class="attr">name</span>=<span class="string">"device/generic/qemu"</span> <span class="attr">groups</span>=<span class="string">"pdk"</span> /></span></span><br><span class="line">  <span class="tag"><<span class="name">project</span> <span class="attr">path</span>=<span class="string">"device/generic/trusty"</span> <span class="attr">name</span>=<span class="string">"device/generic/trusty"</span> <span class="attr">groups</span>=<span class="string">"pdk"</span> /></span></span><br><span class="line">  <span class="tag"><<span class="name">project</span> <span class="attr">path</span>=<span class="string">"device/generic/uml"</span> <span class="attr">name</span>=<span class="string">"device/generic/uml"</span> <span class="attr">groups</span>=<span class="string">"device,pdk"</span> /></span></span><br><span class="line">  <span class="tag"><<span class="name">project</span> <span class="attr">path</span>=<span class="string">"device/generic/x86"</span> <span class="attr">name</span>=<span class="string">"device/generic/x86"</span> <span class="attr">groups</span>=<span class="string">"pdk"</span> /></span></span><br><span class="line">  <span class="tag"><<span class="name">project</span> <span class="attr">path</span>=<span class="string">"device/generic/x86_64"</span> <span class="attr">name</span>=<span class="string">"device/generic/x86_64"</span> <span class="attr">groups</span>=<span class="string">"pdk"</span> /></span></span><br><span class="line">  <span class="tag"><<span class="name">project</span> <span class="attr">path</span>=<span class="string">"device/google/contexthub"</span> <span class="attr">name</span>=<span class="string">"device/google/contexthub"</span> <span class="attr">groups</span>=<span class="string">"device,marlin,pdk"</span> /></span></span><br><span class="line">  <span class="tag"><<span class="name">project</span> <span class="attr">path</span>=<span class="string">"device/google/cuttlefish"</span> <span class="attr">name</span>=<span class="string">"device/google/cuttlefish"</span> <span class="attr">groups</span>=<span class="string">"device,pdk"</span> /></span></span><br><span class="line">  <span class="tag"><<span class="name">project</span> <span class="attr">path</span>=<span class="string">"device/google/cuttlefish_common"</span> <span class="attr">name</span>=<span class="string">"device/google/cuttlefish_common"</span> <span class="attr">groups</span>=<span class="string">"device,pdk"</span> /></span></span><br><span class="line">  <span class="tag"><<span class="name">project</span> <span class="attr">path</span>=<span class="string">"device/google/cuttlefish_kernel"</span> <span class="attr">name</span>=<span class="string">"device/google/cuttlefish_kernel"</span> <span class="attr">groups</span>=<span class="string">"device,pdk"</span> <span class="attr">clone-depth</span>=<span class="string">"1"</span> /></span></span><br><span class="line">  <span class="tag"><<span class="name">project</span> <span class="attr">path</span>=<span class="string">"device/google/cuttlefish_vmm"</span> <span class="attr">name</span>=<span class="string">"device/google/cuttlefish_vmm"</span> <span class="attr">groups</span>=<span class="string">"device,pdk"</span> <span class="attr">clone-depth</span>=<span class="string">"1"</span> /></span></span><br><span class="line">  <span class="tag"><<span class="name">project</span> <span class="attr">path</span>=<span class="string">"device/google/vrservices"</span> <span class="attr">name</span>=<span class="string">"device/google/vrservices"</span> <span class="attr">groups</span>=<span class="string">"pdk"</span> <span class="attr">clone-depth</span>=<span class="string">"1"</span> /></span></span><br><span class="line">  <span class="tag"><<span class="name">project</span> <span class="attr">path</span>=<span class="string">"frameworks/av"</span> <span class="attr">name</span>=<span class="string">"platform/frameworks/av"</span> <span class="attr">groups</span>=<span class="string">"pdk"</span> /></span></span><br><span class="line">  ...</span><br><span class="line">  <span class="tag"><<span class="name">project</span> <span class="attr">path</span>=<span class="string">"frameworks/opt/calendar"</span> <span class="attr">name</span>=<span class="string">"platform/frameworks/opt/calendar"</span> <span class="attr">groups</span>=<span class="string">"pdk-cw-fs,pdk-fs"</span> /></span></span><br><span class="line"> </span><br><span class="line">  <span class="tag"><<span class="name">project</span> <span class="attr">path</span>=<span class="string">"frameworks/opt/chips"</span> <span class="attr">name</span>=<span class="string">"platform/frameworks/opt/chips"</span> <span class="attr">groups</span>=<span class="string">"pdk-cw-fs,pdk-fs"</span> /></span></span><br><span class="line">  ...</span><br><span class="line">  <span class="tag"><<span class="name">project</span> <span class="attr">path</span>=<span class="string">"frameworks/rs"</span> <span class="attr">name</span>=<span class="string">"platform/frameworks/rs"</span> <span class="attr">groups</span>=<span class="string">"pdk"</span> /></span></span><br><span class="line">  <span class="tag"><<span class="name">project</span> <span class="attr">path</span>=<span class="string">"frameworks/wilhelm"</span> <span class="attr">name</span>=<span class="string">"platform/frameworks/wilhelm"</span> <span class="attr">groups</span>=<span class="string">"pdk-cw-fs,pdk-fs"</span> /></span></span><br><span class="line">  </span><br><span class="line">  <span class="tag"><<span class="name">project</span> <span class="attr">path</span>=<span class="string">"hardware/google/apf"</span> <span class="attr">name</span>=<span class="string">"platform/hardware/google/apf"</span> <span class="attr">groups</span>=<span class="string">"pdk"</span> /></span></span><br><span class="line">  ...</span><br><span class="line">  <span class="tag"><<span class="name">project</span> <span class="attr">path</span>=<span class="string">"hardware/qcom/media"</span> <span class="attr">name</span>=<span class="string">"platform/hardware/qcom/media"</span> <span class="attr">groups</span>=<span class="string">"qcom,pdk-qcom"</span> /></span></span><br><span class="line">  </span><br><span class="line">  <span class="tag"><<span class="name">project</span> <span class="attr">path</span>=<span class="string">"hardware/qcom/neuralnetworks/hvxservice"</span> <span class="attr">name</span>=<span class="string">"platform/hardware/qcom/neuralnetworks/hvxservice"</span> <span class="attr">groups</span>=<span class="string">"wahoo"</span> /></span></span><br><span class="line">  <span class="tag"><<span class="name">project</span> <span class="attr">path</span>=<span class="string">"hardware/qcom/power"</span> <span class="attr">name</span>=<span class="string">"platform/hardware/qcom/power"</span> <span class="attr">groups</span>=<span class="string">"qcom,pdk-qcom"</span> /></span></span><br><span class="line">  </span><br><span class="line">  <span class="tag"><<span class="name">project</span> <span class="attr">path</span>=<span class="string">"hardware/qcom/wlan"</span> <span class="attr">name</span>=<span class="string">"platform/hardware/qcom/wlan"</span> <span class="attr">groups</span>=<span class="string">"qcom_wlan,pdk-qcom"</span> /></span></span><br><span class="line">  <span class="tag"><<span class="name">project</span> <span class="attr">path</span>=<span class="string">"hardware/ril"</span> <span class="attr">name</span>=<span class="string">"platform/hardware/ril"</span> <span class="attr">groups</span>=<span class="string">"pdk"</span> /></span></span><br><span class="line">  <span class="tag"><<span class="name">project</span> <span class="attr">path</span>=<span class="string">"hardware/ti/am57x"</span> <span class="attr">name</span>=<span class="string">"platform/hardware/ti/am57x"</span> <span class="attr">groups</span>=<span class="string">"pdk"</span> /></span></span><br><span class="line"></span><br><span class="line">  添加kernel的代码</span><br><span class="line">  <span class="tag"><<span class="name">project</span> <span class="attr">path</span>=<span class="string">"kernel/common"</span> <span class="attr">name</span>=<span class="string">"kernel/common"</span> <span class="attr">revision</span>=<span class="string">"android-4.19-q-release"</span>/></span></span><br><span class="line"></span><br><span class="line">  <span class="tag"><<span class="name">project</span> <span class="attr">path</span>=<span class="string">"libcore"</span> <span class="attr">name</span>=<span class="string">"platform/libcore"</span> <span class="attr">groups</span>=<span class="string">"pdk"</span> /></span></span><br><span class="line">  <span class="tag"><<span class="name">project</span> <span class="attr">path</span>=<span class="string">"libnativehelper"</span> <span class="attr">name</span>=<span class="string">"platform/libnativehelper"</span> <span class="attr">groups</span>=<span class="string">"pdk"</span> /></span></span><br><span class="line"></span><br><span class="line">  <span class="tag"><<span class="name">project</span> <span class="attr">path</span>=<span class="string">"packages/apps/OneTimeInitializer"</span> <span class="attr">name</span>=<span class="string">"platform/packages/apps/OneTimeInitializer"</span> <span class="attr">groups</span>=<span class="string">"pdk-fs"</span> /></span></span><br><span class="line">  为配合下面python脚本这里path最好修改为 packages/apps/PackageInstaller</span><br><span class="line">  <span class="tag"><<span class="name">project</span> <span class="attr">path</span>=<span class="string">"packages/apps/PermissionController"</span> <span class="attr">name</span>=<span class="string">"platform/packages/apps/PackageInstaller"</span> <span class="attr">groups</span>=<span class="string">"pdk-cw-fs,pdk-fs"</span> /></span></span><br><span class="line">  <span class="tag"><<span class="name">project</span> <span class="attr">path</span>=<span class="string">"packages/apps/PhoneCommon"</span> <span class="attr">name</span>=<span class="string">"platform/packages/apps/PhoneCommon"</span> <span class="attr">groups</span>=<span class="string">"pdk-cw-fs,pdk-fs"</span> /></span></span><br><span class="line">  <span class="tag"><<span class="name">project</span> <span class="attr">path</span>=<span class="string">"system/vold"</span> <span class="attr">name</span>=<span class="string">"platform/system/vold"</span> <span class="attr">groups</span>=<span class="string">"pdk"</span> /></span></span><br><span class="line"></span><br><span class="line">  <span class="tag"><<span class="name">repo-hooks</span> <span class="attr">in-project</span>=<span class="string">"platform/tools/repohooks"</span> <span class="attr">enabled-list</span>=<span class="string">"pre-upload"</span> /></span></span><br><span class="line"></span><br><span class="line"><span class="tag"></<span class="name">manifest</span>></span></span><br></pre></td></tr></tbody></table></figure><p>不需要的全部注释掉, 当需要的时候再打开</p><p>然后再配合下面这个python脚本即可完成clone代码和更新代码 <strong>注意: 这是Win下的</strong></p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> xml.dom.minidom</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 1 设置源码保存路径</span></span><br><span class="line">rootdir = <span class="string">"E:/FuckSource/android10-release"</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 2 设置git安装的路径 注意Win上这样最好 否则空格很麻烦的</span></span><br><span class="line">git = <span class="string">'"D:/Program Files/Git/bin/git.exe"'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3 设置manifest中default.xml路径</span></span><br><span class="line">manifest = <span class="string">"E:/FuckSource/android10-release/manifest/default.xml"</span></span><br><span class="line">dom = xml.dom.minidom.parse(manifest)</span><br><span class="line">root = dom.documentElement</span><br><span class="line">default_revision = root.getElementsByTagName(<span class="string">"default"</span>)[<span class="number">0</span>].getAttribute(<span class="string">"revision"</span>)</span><br><span class="line">default_revision = default_revision[default_revision.rfind(<span class="string">"/"</span>) + <span class="number">1</span>:]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4 设置下载源</span></span><br><span class="line">prefix = git + <span class="string">" clone"</span></span><br><span class="line">source = <span class="string">" https://aosp.tuna.tsinghua.edu.cn/"</span></span><br><span class="line"><span class="comment">#source = " https://android.googlesource.com/"</span></span><br><span class="line">suffix = <span class="string">".git"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 切换目录</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">change_dir</span><span class="params">(d)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(d):</span><br><span class="line">        os.makedirs(d)</span><br><span class="line">    os.chdir(d)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> node <span class="keyword">in</span> root.getElementsByTagName(<span class="string">"project"</span>):</span><br><span class="line">    change_dir(rootdir)</span><br><span class="line">    <span class="comment"># 设置当前project的infix  为了节省空间 只保留最后一次commit --depth=1</span></span><br><span class="line">    current_revision = node.getAttribute(<span class="string">"revision"</span>)</span><br><span class="line">    revision = current_revision <span class="keyword">if</span> current_revision <span class="keyword">else</span> default_revision</span><br><span class="line">    infix = <span class="string">" -b "</span> + revision + <span class="string">" --single-branch --depth=1"</span></span><br><span class="line">    </span><br><span class="line">    path = node.getAttribute(<span class="string">"path"</span>)</span><br><span class="line">    last = path.rfind(<span class="string">"/"</span>)</span><br><span class="line">    <span class="comment"># .git所在目录的上层目录</span></span><br><span class="line">    git_p = rootdir + <span class="string">"/"</span> + path[:last]</span><br><span class="line">    <span class="comment"># .git所在目录</span></span><br><span class="line">    git_d = rootdir + <span class="string">"/"</span> + path</span><br><span class="line">    <span class="keyword">if</span> last != <span class="number">-1</span>:</span><br><span class="line">        change_dir(git_p)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(git_d): <span class="comment"># 没有执行过git clone</span></span><br><span class="line">        cmd = prefix + infix + source + node.getAttribute(<span class="string">"name"</span>) + suffix</span><br><span class="line">        print(cmd)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        os.chdir(git_d)</span><br><span class="line">        cmd = git + <span class="string">" pull --depth=1"</span></span><br><span class="line">        print(cmd, path)</span><br><span class="line">    os.system(cmd)</span><br></pre></td></tr></tbody></table></figure><p>用这个脚本的时候最好修改一个project的path, 因为是根据目录有无来判断是否执行过clone操作的</p><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"><!-- 为配合下面python脚本这里path最好修改为 packages/apps/PackageInstaller --></span></span><br><span class="line"><span class="tag"><<span class="name">project</span> <span class="attr">path</span>=<span class="string">"packages/apps/PermissionController"</span> <span class="attr">name</span>=<span class="string">"platform/packages/apps/PackageInstaller"</span> <span class="attr">groups</span>=<span class="string">"pdk-cw-fs,pdk-fs"</span> /></span></span><br></pre></td></tr></tbody></table></figure><p>当执行完脚本都是git pull时, 表示想要的源码都下载好了, 否则就一直执行脚本, 直至下载完所有源码为止</p><h1 id="3-报错"><a href="#3-报错" class="headerlink" title="3 报错"></a>3 报错</h1><p>完成整个操作可能出现的错误</p><h2 id="3-1-CONFIGURATION-parameter-has-not-been-configured-in-web-xml"><a href="#3-1-CONFIGURATION-parameter-has-not-been-configured-in-web-xml" class="headerlink" title="3.1 CONFIGURATION parameter has not been configured in web.xml"></a>3.1 CONFIGURATION parameter has not been configured in web.xml</h2><p>打开网页报以下错</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">There was an error!</span><br><span class="line">CONFIGURATION parameter has not been configured in web.xml! Please configure your webapp.</span><br><span class="line">Unable to determine source root path. Missing configuration?</span><br><span class="line">java.io.FileNotFoundException: Unable to determine source root path. Missing configuration?</span><br><span class="line">at org.opensolaris.opengrok.web.PageConfig.checkSourceRootExistence(PageConfig.java:1562)</span><br><span class="line">at org.apache.jsp.index_jsp._jspService(index_jsp.java:222)</span><br><span class="line">at org.apache.jasper.runtime.HttpJspBase.service(HttpJspBase.java:70)</span><br><span class="line">at javax.servlet.http.HttpServlet.service(HttpServlet.java:742)</span><br><span class="line">at org.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:443)</span><br><span class="line">at org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:385)</span><br><span class="line">at org.apache.jasper.servlet.JspServlet.service(JspServlet.java:329)</span><br><span class="line">at javax.servlet.http.HttpServlet.service(HttpServlet.java:742)</span><br></pre></td></tr></tbody></table></figure><p>检查一下Tomcat的web.xml文件指定的OpenGrok的配置文件<code>D:/Develop/apache-tomcat/opengrok-1.3.6/index/configuration.xml</code>是否存在, 是否是执行建立索引后生成的</p><h2 id="3-2-Failed-to-get-xref-file"><a href="#3-2-Failed-to-get-xref-file" class="headerlink" title="3.2 Failed to get xref file"></a>3.2 Failed to get xref file</h2><p>我把源码给删了，然后再同步一下源码，建立一次索引，再打开opengrok，页面没代码，就出现这个，这里有个链接或许能解决，<a href="https://github.com/oracle/opengrok/issues/2774" target="_blank" rel="noopener">https://github.com/oracle/opengrok/issues/2774</a></p><p>我没尝试过，我直接重装了Tomcat和OpenGrok..</p><h2 id="3-3-Caused-by-java-net-ConnectException-Connection-refused-Connection-refused"><a href="#3-3-Caused-by-java-net-ConnectException-Connection-refused-Connection-refused" class="headerlink" title="3.3 Caused by: java.net.ConnectException: Connection refused (Connection refused)"></a>3.3 Caused by: java.net.ConnectException: Connection refused (Connection refused)</h2><p>再建立索引的时候报这个错，可能Tomcat挂了，或者OpenGrok挂了？不清楚，重启Tomcat就好了</p></body></html>]]></content>
      
      
      <categories>
          
          <category> Other </category>
          
      </categories>
      
      
        <tags>
            
            <tag> OpenGrok </tag>
            
            <tag> code </tag>
            
            <tag> Android </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Configure CentOS</title>
      <link href="/posts/94e02420/"/>
      <url>/posts/94e02420/</url>
      
        <content type="html"><![CDATA[<p>CentOS常用软件的安装与配置</p><h1 id="1-卸载软件"><a href="#1-卸载软件" class="headerlink" title="1 卸载软件"></a>1 卸载软件</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 先列出要卸载的项</span></span><br><span class="line">yum list installed | grep gcc</span><br><span class="line"><span class="comment"># 再逐个卸载</span></span><br><span class="line">yum -y remove libgcc.x86_64</span><br></pre></td></tr></table></figure><h1 id="2-GCC"><a href="#2-GCC" class="headerlink" title="2 GCC"></a>2 GCC</h1><p>升级或安装gcc流程</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">wget https://mirrors.ustc.edu.cn/gnu/gcc/gcc-7.3.0/gcc-7.3.0.tar.gz</span><br><span class="line">tar -xf gcc-7.3.0.tar.gz </span><br><span class="line"><span class="built_in">cd</span> gcc-7.3.0</span><br><span class="line">./contrib/download_prerequisites</span><br><span class="line">mkdir gcc-build-7.3.0 </span><br><span class="line"><span class="built_in">cd</span> gcc-build-7.3.0</span><br><span class="line">../configure --<span class="built_in">enable</span>-checking=release --<span class="built_in">enable</span>-languages=c,c++ --<span class="built_in">disable</span>-multilib</span><br><span class="line"><span class="comment"># 时间可能很长 耐心等待就好</span></span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure><a id="more"></a><h1 id="3-Java"><a href="#3-Java" class="headerlink" title="3 Java"></a>3 Java</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 先去下载jdk的压缩包 再解压</span></span><br><span class="line">tar -zxvf jdk.tar.gz</span><br><span class="line">vim /etc/profile</span><br><span class="line">    <span class="comment">#java</span></span><br><span class="line">    <span class="built_in">export</span> JAVA_HOME=/usr/java/jdk1.8.0_181</span><br><span class="line">    <span class="built_in">export</span> CLASSPATH=.:<span class="variable">$JAVA_HOME</span>/lib/dt.jar:<span class="variable">$JAVA_HOME</span>/lib</span><br><span class="line">    <span class="built_in">export</span> PATH=<span class="variable">$JAVA_HOME</span>/bin:<span class="variable">$PATH</span></span><br><span class="line"><span class="built_in">source</span> /etc/profile</span><br></pre></td></tr></table></figure><h1 id="4-Tomcat"><a href="#4-Tomcat" class="headerlink" title="4 Tomcat"></a>4 Tomcat</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 前提是安装好Java</span></span><br><span class="line">tar -zxvf tomcat.tar.gz</span><br><span class="line">chmod 777 startup.sh</span><br><span class="line"><span class="comment"># only save ROOT 将webapps下所有东西都删了 就留个ROOT就好了</span></span><br></pre></td></tr></table></figure><h1 id="5-MySQL"><a href="#5-MySQL" class="headerlink" title="5 MySQL"></a>5 MySQL</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># download mysql8 source</span></span><br><span class="line">sudo rpm -Uvh https://dev.mysql.com/get/mysql80-community-release-el7-1.noarch.rpm</span><br><span class="line"><span class="comment"># install mysql8</span></span><br><span class="line">sudo yum --enablerepo=mysql80-community install mysql-community-server</span><br><span class="line"><span class="comment"># start mysql service</span></span><br><span class="line">sudo service mysqld start</span><br><span class="line"><span class="comment"># check mysql service status</span></span><br><span class="line">service mysqld status</span><br><span class="line"><span class="comment"># get temp pwd of root</span></span><br><span class="line">grep <span class="string">"A temporary password"</span> /var/<span class="built_in">log</span>/mysqld.log</span><br><span class="line"><span class="comment"># enter mysql cmd</span></span><br><span class="line">mysql -uroot -p</span><br><span class="line"><span class="comment"># a policy of pwd validation</span></span><br><span class="line">SHOW VARIABLES LIKE <span class="string">'validate_password.%'</span>;</span><br><span class="line"><span class="built_in">set</span> global validate_password.policy=0;</span><br><span class="line"><span class="comment"># change pwd</span></span><br><span class="line">ALTER USER <span class="string">'root'</span>@<span class="string">'localhost'</span> IDENTIFIED BY <span class="string">'YourPwd123'</span>;</span><br><span class="line">use mysql;</span><br><span class="line">SELECT host, user, authentication_string, plugin FROM user;</span><br><span class="line">CREATE USER <span class="string">'root'</span>@<span class="string">'%'</span> IDENTIFIED BY <span class="string">'YouPwd123'</span>;</span><br><span class="line">GRANT ALL ON *.* TO <span class="string">'root'</span>@<span class="string">'%'</span>;</span><br></pre></td></tr></table></figure><h1 id="6-Python"><a href="#6-Python" class="headerlink" title="6 Python"></a>6 Python</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装一些依赖</span></span><br><span class="line">yum install zlib-devel bzip2-devel openssl-devel ncurses-devel sqlite-devel readline-devel tk-devel gcc make</span><br><span class="line">yum install libffi-devel -y</span><br><span class="line"><span class="comment"># 下载python源码</span></span><br><span class="line">wget https://www.python.org/ftp/python/3.7.4/Python-3.7.4.tgz</span><br><span class="line">tar -xf Python-3.7.4.tgz</span><br><span class="line">./configure</span><br><span class="line"><span class="comment"># 安装</span></span><br><span class="line">sudo make &amp;&amp; make install</span><br><span class="line"><span class="comment"># 看下是否安装成功</span></span><br><span class="line">python3 -V</span><br><span class="line">rm -f /usr/bin/python</span><br><span class="line">ln -s /usr/<span class="built_in">local</span>/bin/python3 /usr/bin/python</span><br><span class="line">rm -f /usr/bin/pip</span><br><span class="line">ln -s /usr/<span class="built_in">local</span>/bin/pip3 /usr/bin/pip</span><br><span class="line"><span class="comment"># 修改一下 以免这些东西不能用了 将python改为python2</span></span><br><span class="line">vim /usr/libexec/urlgrabber-ext-down</span><br><span class="line">vim /usr/bin/yum</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用virtualenv</span></span><br><span class="line">pip install virtualenv</span><br><span class="line"><span class="built_in">cd</span> /opt</span><br><span class="line">virtualenv --no-site-packages --python=python3 env_1</span><br><span class="line"><span class="built_in">source</span> env_1/bin/activate</span><br><span class="line">deactivate</span><br></pre></td></tr></table></figure><h1 id="7-Node-js"><a href="#7-Node-js" class="headerlink" title="7 Node.js"></a>7 Node.js</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">install node.js:</span><br><span class="line">wget https://nodejs.org/dist/v12.11.1/node-v12.11.1-linux-x64.tar.xz</span><br><span class="line">xz -d node-v12.11.1-linux-x64.tar.xz</span><br><span class="line">tar -xvf node-v12.11.1-linux-x64.tar.xz</span><br><span class="line"></span><br><span class="line">ln -s ~/node-v12.11.1-linux-x64/bin/node /usr/bin/node</span><br><span class="line">ln -s ~/node-v12.11.1-linux-x64/bin/npm /usr/bin/npm</span><br><span class="line">ln -s ~/node-v12.11.1-linux-x64/bin/npm /usr/bin/npx</span><br></pre></td></tr></table></figure><h1 id="8-Vim"><a href="#8-Vim" class="headerlink" title="8 Vim"></a>8 Vim</h1><p>配置Vim</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">$ vim ~/.vimrc</span><br><span class="line"><span class="string">" 256色模式</span></span><br><span class="line"><span class="string">set t_Co=256</span></span><br><span class="line"><span class="string">set term=xterm-256color</span></span><br><span class="line"><span class="string">"</span> 主题</span><br><span class="line">colorscheme desert</span><br><span class="line"><span class="string">" 注释设置成淡灰色</span></span><br><span class="line"><span class="string">highlight Comment ctermfg=202</span></span><br><span class="line"><span class="string">highlight PreProc ctermfg=82</span></span><br><span class="line"><span class="string">set hlsearch "</span> 高亮搜索的词</span><br><span class="line"><span class="built_in">set</span> incsearch <span class="string">" 输入搜索内容时就显示搜索结果</span></span><br><span class="line"><span class="string">"</span> 显示所有字符</span><br><span class="line"><span class="built_in">set</span> list</span><br><span class="line"><span class="built_in">set</span> listchars=eol:$,tab:~~,trail:.,nbsp:.,precedes:^,extends:^</span><br><span class="line">highlight NonText ctermfg=239</span><br><span class="line">highlight SpecialKey ctermfg=239</span><br><span class="line"><span class="string">" 显示行号</span></span><br><span class="line"><span class="string">set number</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">"</span> 展开tab</span><br><span class="line"><span class="built_in">set</span> expandtab</span><br><span class="line"><span class="string">" tab宽度</span></span><br><span class="line"><span class="string">set tabstop=4</span></span><br><span class="line"><span class="string">set softtabstop=4</span></span><br><span class="line"><span class="string">"</span> 自动缩进</span><br><span class="line"><span class="built_in">set</span> autoindent</span><br><span class="line"><span class="built_in">set</span> shiftwidth=4</span><br><span class="line"><span class="built_in">set</span> smartindent</span><br><span class="line"></span><br><span class="line"><span class="string">" 设置编码</span></span><br><span class="line"><span class="string">set encoding=utf-8</span></span><br><span class="line"><span class="string">set termencoding=utf-8</span></span><br><span class="line"><span class="string">set formatoptions+=mM</span></span><br><span class="line"><span class="string">set fencs=utf-8,gbk</span></span><br><span class="line"><span class="string">set fileencodings=utf-8,gbk</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">set nocompatible "</span> 关闭vi兼容模式</span><br><span class="line">syntax on <span class="string">" 自动语法高亮</span></span><br><span class="line"><span class="string">set cursorline "</span> 突出当前行</span><br><span class="line"><span class="built_in">set</span> ruler <span class="string">" 打开状态栏标尺</span></span><br><span class="line"><span class="string">set ignorecase smartcase "</span> 搜索时忽略大小写，但在有一个或以上大写字母时仍保持对大小写敏感</span><br><span class="line"><span class="built_in">set</span> incsearch <span class="string">" 输入搜索内容时就显示搜索结果</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Other </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CentOS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Building image host via PicGo + Github</title>
      <link href="/posts/47391a30/"/>
      <url>/posts/47391a30/</url>
      
        <content type="html"><![CDATA[<p>嗯，比较懒，贴两个链接留作纪念：</p><p>PicGo + GitHub 搭建个人图床工具：<a href="https://blog.csdn.net/yefcion/article/details/88412025" target="_blank" rel="noopener">https://blog.csdn.net/yefcion/article/details/88412025</a></p><p>PicGo + Gitee + Typora: <a href="https://www.cnblogs.com/qtzd/p/12554902.html" target="_blank" rel="noopener">https://www.cnblogs.com/qtzd/p/12554902.html</a></p><p>PicGo： <a href="https://github.com/Molunerfinn/PicGo" target="_blank" rel="noopener">https://github.com/Molunerfinn/PicGo</a></p><p>滥用VPN会导致DNS污染，从而利用github上传的图床都显示不出来了，需要解决一下，</p><p><a href="https://www.ioiox.com/archives/62.html" target="_blank" rel="noopener">https://www.ioiox.com/archives/62.html</a></p><p>通过 <a href="https://www.ipaddress.com/" target="_blank" rel="noopener">https://www.ipaddress.com/</a> 查询 raw.githubusercontent.com 的真实ip地址</p><p>再将以下内容保存到hosts文件(Win：<code>C:\Windows\System32\drivers\etc\hosts</code>)中</p><p><code>ip地址 raw.githubusercontent.com</code></p>]]></content>
      
      
      <categories>
          
          <category> Other </category>
          
      </categories>
      
      
        <tags>
            
            <tag> blog </tag>
            
            <tag> 图床 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hexo&#39;s grammar</title>
      <link href="/posts/2b335451/"/>
      <url>/posts/2b335451/</url>
      
        <content type="html"><![CDATA[<h1 id="1-Hexo的语法"><a href="#1-Hexo的语法" class="headerlink" title="1 Hexo的语法"></a>1 Hexo的语法</h1><p>参考官网给的：</p><p><a href="https://hexo.io/docs/front-matter" target="_blank" rel="noopener">https://hexo.io/docs/front-matter</a></p><p><a href="https://hexo.io/docs/tag-plugins" target="_blank" rel="noopener">https://hexo.io/docs/tag-plugins</a></p><p>做好笔记，以便之后寻找方便…</p><h2 id="1-1-文章的meta"><a href="#1-1-文章的meta" class="headerlink" title="1.1 文章的meta"></a>1.1 文章的meta</h2><p>就是这么个东西</p><a id="more"></a><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">title:</span> <span class="string">article</span> <span class="string">name</span></span><br><span class="line"><span class="attr">top:</span> <span class="number">1</span></span><br><span class="line"><span class="attr">date:</span> <span class="number">2019</span><span class="bullet">-10</span><span class="bullet">-13</span> <span class="number">09</span><span class="string">:27:08</span></span><br><span class="line"><span class="attr">tags:</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">hexo</span></span><br><span class="line"><span class="bullet">  -</span> <span class="string">blog</span></span><br><span class="line"><span class="attr">categories:</span> <span class="string">Other</span></span><br><span class="line"><span class="meta">---</span></span><br></pre></td></tr></table></figure><p>可以通过yaml语法定义，也可以通过json语法定义，基本没啥好说的，除了tags和categories需要手动添加也就没了，当然了也可以添加自己的meta信息，在article中使用</p><h2 id="1-2-引用"><a href="#1-2-引用" class="headerlink" title="1.2 引用"></a>1.2 引用</h2><p> <a href="https://hexo.io/docs/tag-plugins#Block-Quote" target="_blank" rel="noopener">https://hexo.io/docs/tag-plugins#Block-Quote</a> </p><p>简单一点的引用，直接使用markdown的语法就好了，当然还可以有更强一点的引用，语法如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;% blockquote [author[, source]] [link] [source_link_title] %&#125;</span><br><span class="line">content</span><br><span class="line">&#123;% endblockquote %&#125;</span><br></pre></td></tr></table></figure><p>比如说引用某人书中的一句话, 多个作者的话就比较麻烦，要不用<code>/</code>隔开？</p><blockquote><p>content</p><footer><strong>Sidney / Ding</strong><cite>A book</cite></footer></blockquote><p>还有一种居中引用，不过貌似不能添加作者什么的</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;% cq %&#125;</span><br><span class="line">content</span><br><span class="line">&#123;% endcq %&#125;</span><br></pre></td></tr></table></figure><blockquote class="blockquote-center"><p>content</p></blockquote><h2 id="1-3-代码块"><a href="#1-3-代码块" class="headerlink" title="1.3 代码块"></a>1.3 代码块</h2><p> <a href="https://hexo.io/docs/tag-plugins#Code-Block" target="_blank" rel="noopener">https://hexo.io/docs/tag-plugins#Code-Block</a> </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;% codeblock [title] [lang:language] [url] [link text] %&#125;</span><br><span class="line">code snippet</span><br><span class="line">&#123;% endcodeblock %&#125;</span><br></pre></td></tr></table></figure><p>感受一下</p><figure class="highlight diff"><figcaption><span>diff.txt</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="addition">+ code snippet</span></span><br><span class="line"><span class="deletion">- code</span></span><br></pre></td></tr></table></figure><p>将语言设为diff即可看到变色，有点头疼的是，用typro写这个费事，建议直接开启源码模式</p><h2 id="1-4-插入文章链接"><a href="#1-4-插入文章链接" class="headerlink" title="1.4 插入文章链接"></a>1.4 插入文章链接</h2><p> <a href="https://hexo.io/docs/tag-plugins#Include-Posts" target="_blank" rel="noopener">https://hexo.io/docs/tag-plugins#Include-Posts</a> </p><p>插入之前的article</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% post_link filename [optional text] %&#125;</span><br></pre></td></tr></table></figure><h2 id="1-5-Read-More"><a href="#1-5-Read-More" class="headerlink" title="1.5 Read More"></a>1.5 Read More</h2><p>read more的位置默认是150字符处，但是有时候前面有个代码块就很长了，这是可以在想分割的地方插入一个</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- more --&gt;</span><br></pre></td></tr></table></figure><h2 id="1-6-Include-Assets"><a href="#1-6-Include-Assets" class="headerlink" title="1.6 Include Assets"></a>1.6 Include Assets</h2><p>好像啥都可以哈</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;% asset_path slug %&#125;</span><br><span class="line">&#123;% asset_img slug [title] %&#125;</span><br><span class="line">&#123;% asset_link slug [title] %&#125;</span><br></pre></td></tr></table></figure><h1 id="2-NexT的特性"><a href="#2-NexT的特性" class="headerlink" title="2 NexT的特性"></a>2 NexT的特性</h1><p>参考官网</p><p> <a href="https://theme-next.org/docs/third-party-services/math-equations" target="_blank" rel="noopener">https://theme-next.org/docs/third-party-services/math-equations</a> 数学公式基本和markdown差不多</p><p> <a href="https://theme-next.org/docs/tag-plugins/" target="_blank" rel="noopener">https://theme-next.org/docs/tag-plugins/</a> 比较好用的布局</p><p>以下默认插件都安装好了</p><h2 id="2-1-pdf"><a href="#2-1-pdf" class="headerlink" title="2.1 pdf"></a>2.1 pdf</h2><p>插入pdf</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;% pdf url [height] %&#125;</span><br><span class="line"></span><br><span class="line">[url]    : Relative path to PDF file.</span><br><span class="line">[height] : Optional. Height of the PDF display element, e.g. 800px.</span><br></pre></td></tr></table></figure><h2 id="2-2-tab"><a href="#2-2-tab" class="headerlink" title="2.2 tab"></a>2.2 tab</h2><p> <a href="https://theme-next.org/docs/tag-plugins/tabs" target="_blank" rel="noopener">https://theme-next.org/docs/tag-plugins/tabs</a> </p><p>可能以后会用</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#123;% tabs Unique name, [index] %&#125;</span><br><span class="line">&lt;!-- tab [Tab caption] [@icon] --&gt;</span><br><span class="line">Any content (support inline tags too).</span><br><span class="line">&lt;!-- endtab --&gt;</span><br><span class="line">&#123;% endtabs %&#125;</span><br><span class="line"></span><br><span class="line">Unique name   : Unique name of tabs block tag without comma.</span><br><span class="line">                Will be used in #id&#39;s as prefix for each tab with their index numbers.</span><br><span class="line">                If there are whitespaces in name, for generate #id all whitespaces will replaced by dashes.</span><br><span class="line">                Only for current url of post&#x2F;page must be unique!</span><br><span class="line">[index]       : Index number of active tab.</span><br><span class="line">                If not specified, first tab (1) will be selected.</span><br><span class="line">                If index is -1, no tab will be selected. It&#39;s will be something like spoiler.</span><br><span class="line">                Optional parameter.</span><br><span class="line">[Tab caption] : Caption of current tab.</span><br><span class="line">                If not caption specified, unique name with tab index suffix will be used as caption of tab.</span><br><span class="line">                If not caption specified, but specified icon, caption will empty.</span><br><span class="line">                Optional parameter.</span><br><span class="line">[@icon]       : FontAwesome icon name (without &#39;fa-&#39; at the begining).</span><br><span class="line">                Can be specified with or without space; e.g. &#39;Tab caption @icon&#39; similar to &#39;Tab caption@icon&#39;.</span><br><span class="line">                Optional parameter.</span><br></pre></td></tr></table></figure><h2 id="2-3-note"><a href="#2-3-note" class="headerlink" title="2.3 note"></a>2.3 note</h2><div class="note success">            <p><strong>Success Header</strong></p><p>Successfully!</p>          </div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;% note [class] [no-icon] %&#125;</span><br><span class="line">Any content (support inline tags too.io).</span><br><span class="line">&#123;% endnote %&#125;</span><br><span class="line"></span><br><span class="line">[class]   : default | primary | success | info | warning | danger.</span><br><span class="line">[no-icon] : Disable icon in note.</span><br><span class="line"></span><br><span class="line">All parameters are optional.</span><br></pre></td></tr></table></figure><h2 id="2-4-label"><a href="#2-4-label" class="headerlink" title="2.4 label"></a>2.4 label</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;% label [class]@Text %&#125;</span><br><span class="line"></span><br><span class="line">[class] : default | primary | success | info | warning | danger.</span><br><span class="line">          &#39;@Text&#39; can be specified with or without space</span><br><span class="line">          E.g. &#39;success @text&#39; similar to &#39;success@text&#39;.</span><br><span class="line">          If not specified, default class will be selected.</span><br></pre></td></tr></table></figure><p>Ut enim *<span class="label warning">ad</span>* minim veniam, quis <strong><span class="label danger">nostrud</span></strong> exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p><h1 id="3-插入图片的bug"><a href="#3-插入图片的bug" class="headerlink" title="3 插入图片的bug"></a>3 插入图片的bug</h1><p>不知道这个bug是不是因为<a href="https://github.com/Rozbo/hexo-abbrlink" target="_blank" rel="noopener">hexo-abbrlink</a>插件造成的，反正插入图片死活不成功，也不分析怎么造成的了，修改文件：<code>blog/node_modules/hexo/lib/plugins/processor/post.js</code></p><figure class="highlight diff"><figcaption><span>post.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">function scanAssetDir(post) &#123;</span><br><span class="line">    ...12 lines</span><br><span class="line">    if (err.cause &amp;&amp; err.cause.code <span class="comment">=== 'ENOENT') return [];</span></span><br><span class="line">      throw err;</span><br><span class="line">    &#125;).filter(item =&gt; !common.isTmpFile(item) &amp;&amp; !common.isHiddenFile(item)).map(item =&gt; &#123;</span><br><span class="line">      const id = join(assetDir, item).substring(baseDirLength).replace(/\\/g, '/');</span><br><span class="line"></span><br><span class="line"><span class="addition">+      // SidneyGod fix bug</span></span><br><span class="line"><span class="addition">+      item = id.replace("source/_posts", ".");</span></span><br><span class="line"><span class="addition">+      console.info&amp;&amp;console.info("SidneyGod---" + item);</span></span><br><span class="line">      const asset = PostAsset.findById(id);</span><br><span class="line">      if (asset) return undefined;</span><br><span class="line">      return PostAsset.save(&#123;</span><br></pre></td></tr></table></figure><p>加上那三句后，因为我是启用了asset folder的</p><figure class="highlight yaml"><figcaption><span>_config.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">post_asset_folder:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><p>所以在引用图片的时候，写链接需要这样<code>./articleName/imageName</code>，注意这个<code>./</code>不能少，因为表示相对路径，并且要确保，你的图片真的在<code>articleName</code>目录下</p>]]></content>
      
      
      <categories>
          
          <category> Other </category>
          
      </categories>
      
      
        <tags>
            
            <tag> blog </tag>
            
            <tag> hexo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Use hexo + github to build a blog</title>
      <link href="/posts/c969bad9/"/>
      <url>/posts/c969bad9/</url>
      
        <content type="html"><![CDATA[<html><head></head><body><h1 id="1-Getting-Started"><a href="#1-Getting-Started" class="headerlink" title="1 Getting Started"></a>1 Getting Started</h1><p>首先跟着hexo官方文档走一遍：<a href="https://hexo.io/docs/" target="_blank" rel="noopener">https://hexo.io/docs/</a></p><ol><li><p>安装git：<a href="https://hexo.io/docs/#Install-Git" target="_blank" rel="noopener">https://hexo.io/docs/#Install-Git</a></p></li><li><p>安装Node.js：<a href="https://hexo.io/docs/#Install-Node-js" target="_blank" rel="noopener">https://hexo.io/docs/#Install-Node-js</a></p></li><li><p>安装hexo</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Win下 找个目录右键 Git Bash Here</span></span><br><span class="line">npm install -g hexo-cli</span><br></pre></td></tr></tbody></table></figure><a id="more"></a></li><li><p>初始化blog</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建blog目录</span></span><br><span class="line">mkdir blog</span><br><span class="line"><span class="comment"># 进入blog目录</span></span><br><span class="line"><span class="built_in">cd</span> blog</span><br><span class="line"><span class="comment"># 初始化</span></span><br><span class="line">hexo init</span><br></pre></td></tr></tbody></table></figure><p>初始化好后，目录下有这么些东西</p><p><code>_config.yml</code>：blog的配置文件，yaml语言</p><p><code>package.json</code>：存储的是一些blog安装信息，比如一些dependencies</p><p><code>scaffolds</code>：存储新建页面的模板</p><p><code>source</code>：blog的主要文件，hexo会渲染这里面的文件，隐藏文件，文件或文件夹名以<code>_</code>开头不会进行渲染，<code>_post</code>文件夹除外</p><p><code>themes</code>：主题文件夹，最需折腾的一个地方</p><p>其实到这里再运行一下<code>hexo g && hexo s</code>就可以在本地欣赏你的blog了，默认地址是：<a href="https://localhost:4000" target="_blank" rel="noopener">https://localhost:4000</a>，但是问题是，样式有点丑，折腾theme吧</p></li><li><p>修改theme</p><p>这里我采用的是既然大家都在用，那我也来用用的NexT主题，是的我们要换一个官方文档了：<a href="https://theme-next.org/docs/" target="_blank" rel="noopener">https://theme-next.org/docs/</a></p><p>安装theme：<a href="https://theme-next.org/docs/getting-started/installation" target="_blank" rel="noopener">https://theme-next.org/docs/getting-started/installation</a></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 可能忘了说了 git安装好了 你要配置一下哈</span></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/theme-next/hexo-theme-next themes/next</span><br></pre></td></tr></tbody></table></figure><p>好了，准备工作做好了，开始配置吧</p></li></ol><h1 id="2-Configuration"><a href="#2-Configuration" class="headerlink" title="2 Configuration"></a>2 Configuration</h1><h2 id="2-1-hexo"><a href="#2-1-hexo" class="headerlink" title="2.1 hexo"></a>2.1 hexo</h2><p>打开hexo的配置文件我们来欣赏一下配置文件</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 确定当前在blog目录下哈 很少需要切换目录的</span></span><br><span class="line">vim _config.yml</span><br></pre></td></tr></tbody></table></figure><p>欣赏优雅的配置文件，还好这文件不算太长，我就一句一句加注释吧，参考官网：<a href="https://hexo.io/docs/configuration" target="_blank" rel="noopener">https://hexo.io/docs/configuration</a></p><figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Hexo Configuration</span></span><br><span class="line"><span class="comment">## Docs: https://hexo.io/docs/configuration.html</span></span><br><span class="line"><span class="comment">## Source: https://github.com/hexojs/hexo/</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Site</span></span><br><span class="line"><span class="attr">title:</span> <span class="string">Sidney</span> <span class="string">God</span>  <span class="comment"># 网站标题</span></span><br><span class="line"><span class="attr">subtitle:</span> <span class="string">Keep</span> <span class="string">quiet</span> <span class="string">time</span> <span class="string">for</span> <span class="string">time</span>  <span class="comment"># 网站副标题</span></span><br><span class="line"><span class="attr">description:</span> <span class="string">You</span> <span class="string">laugh</span> <span class="string">at</span> <span class="string">me</span> <span class="string">for</span> <span class="string">being</span> <span class="string">different,</span> <span class="string">but</span> <span class="string">I</span> <span class="string">laugh</span> <span class="string">at</span> <span class="string">you</span> <span class="string">for</span> <span class="string">being</span> <span class="string">the</span> <span class="string">same.</span>  <span class="comment"># 网站描述</span></span><br><span class="line"><span class="attr">keywords:</span> <span class="string">Sidney,</span> <span class="string">Ding,</span> <span class="string">Sidney</span> <span class="string">Ding</span>  <span class="comment"># 关键词</span></span><br><span class="line"><span class="attr">author:</span> <span class="string">Sidney</span> <span class="string">Ding</span>  <span class="comment"># 您的名字</span></span><br><span class="line"><span class="attr">language:</span> <span class="string">en</span>  <span class="comment"># 网站使用的语言 中文是zh-Hans</span></span><br><span class="line"><span class="attr">timezone:</span> <span class="string">Asia/Shanghai</span>  <span class="comment"># 设置时区</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># URL</span></span><br><span class="line"><span class="comment">## If your site is put in a subdirectory, set url as 'http://yoursite.com/child' and root as '/child/'</span></span><br><span class="line"><span class="attr">url:</span> <span class="attr">https://sidneygod.coding.me</span>  <span class="comment"># 网址 可以不写</span></span><br><span class="line"><span class="attr">root:</span> <span class="string">/</span>  <span class="comment"># 网站根目录</span></span><br><span class="line"><span class="attr">permalink:</span> <span class="string">posts/:abbrlink/</span>  <span class="comment"># 文章的永久链接格式 先用默认值 我的做了修改 后来说</span></span><br><span class="line"><span class="attr">permalink_defaults:</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Directory 下面是默认目录 不要动 没意义</span></span><br><span class="line"><span class="attr">source_dir:</span> <span class="string">source</span></span><br><span class="line"><span class="attr">public_dir:</span> <span class="string">public</span></span><br><span class="line"><span class="attr">tag_dir:</span> <span class="string">tags</span></span><br><span class="line"><span class="attr">archive_dir:</span> <span class="string">archives</span></span><br><span class="line"><span class="attr">category_dir:</span> <span class="string">categories</span></span><br><span class="line"><span class="attr">code_dir:</span> <span class="string">downloads/code</span></span><br><span class="line"><span class="attr">i18n_dir:</span> <span class="string">:lang</span></span><br><span class="line"><span class="attr">skip_render:</span> <span class="string">README.md</span>  <span class="comment"># 跳过渲染的文件 可以不要</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Writing</span></span><br><span class="line"><span class="attr">new_post_name:</span> <span class="string">:title.md</span> <span class="comment"># File name of new posts</span></span><br><span class="line"><span class="attr">default_layout:</span> <span class="string">post</span></span><br><span class="line"><span class="attr">titlecase:</span> <span class="literal">false</span> <span class="comment"># Transform title into titlecase</span></span><br><span class="line"><span class="attr">auto_spacing:</span> <span class="literal">false</span>  <span class="comment"># 中文和英文之间加空格</span></span><br><span class="line"><span class="attr">external_link:</span> <span class="literal">true</span> <span class="comment"># Open external links in new tab</span></span><br><span class="line"><span class="attr">filename_case:</span> <span class="number">0</span></span><br><span class="line"><span class="attr">render_drafts:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">post_asset_folder:</span> <span class="literal">true</span>  <span class="comment"># 启动asset文件夹 如果文章图片多的话 建议开启</span></span><br><span class="line"><span class="attr">relative_link:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">future:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">highlight:</span></span><br><span class="line"><span class="attr">  enable:</span> <span class="literal">true</span>  <span class="comment"># 代码块高亮</span></span><br><span class="line"><span class="attr">  line_number:</span> <span class="literal">true</span>  <span class="comment"># 显示行号</span></span><br><span class="line"><span class="attr">  auto_detect:</span> <span class="literal">false</span>  <span class="comment"># 自动检测语言</span></span><br><span class="line"><span class="attr">  tab_replace:</span> <span class="literal">true</span>  <span class="comment"># tab自动转空格</span></span><br><span class="line">  </span><br><span class="line"><span class="comment"># Home page setting</span></span><br><span class="line"><span class="comment"># path: Root path for your blogs index page. (default = '')</span></span><br><span class="line"><span class="comment"># per_page: Posts displayed per page. (0 = disable pagination)</span></span><br><span class="line"><span class="comment"># order_by: Posts order. (Order by date descending by default)</span></span><br><span class="line"><span class="attr">index_generator:</span></span><br><span class="line"><span class="attr">  path:</span> <span class="string">''</span></span><br><span class="line"><span class="attr">  per_page:</span> <span class="number">10</span></span><br><span class="line"><span class="attr">  order_by:</span> <span class="bullet">-date</span></span><br><span class="line">  </span><br><span class="line"><span class="comment"># Category & Tag</span></span><br><span class="line"><span class="attr">default_category:</span> <span class="string">uncategorized</span></span><br><span class="line"><span class="attr">category_map:</span></span><br><span class="line"><span class="attr">tag_map:</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Date / Time format</span></span><br><span class="line"><span class="comment">## Hexo uses Moment.js to parse and display date</span></span><br><span class="line"><span class="comment">## You can customize the date format as defined in</span></span><br><span class="line"><span class="comment">## http://momentjs.com/docs/#/displaying/format/</span></span><br><span class="line"><span class="attr">date_format:</span> <span class="string">YYYY-MM-DD</span></span><br><span class="line"><span class="attr">time_format:</span> <span class="attr">HH:mm:ss</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Pagination</span></span><br><span class="line"><span class="comment">## Set per_page to 0 to disable pagination</span></span><br><span class="line"><span class="attr">per_page:</span> <span class="number">10</span></span><br><span class="line"><span class="attr">pagination_dir:</span> <span class="string">page</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Themes: https://hexo.io/themes/</span></span><br><span class="line"><span class="attr">theme:</span> <span class="string">next</span>  <span class="comment"># 当前主题名称 当然是要换成刚下载的了</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Deployment</span></span><br><span class="line"><span class="comment">## Docs: https://hexo.io/docs/deployment.html</span></span><br><span class="line"><span class="attr">deploy:</span></span><br><span class="line"><span class="attr">  type:</span> <span class="string">git</span></span><br><span class="line"><span class="attr">  repo:</span></span><br><span class="line">    <span class="comment"># 这个部署就按照这个样式 GitHub的仓库 <用户名>.github.io</span></span><br><span class="line"><span class="attr">    github:</span> <span class="string">git@github.com:SidneyGod/SidneyGod.github.io.git</span></span><br><span class="line">    <span class="comment"># 码云的仓库 <用户名> 码云比较坑 需要手动更新</span></span><br><span class="line"><span class="attr">    gitee:</span> <span class="string">git@gitee.com:SidneyGod/SidneyGod.git</span></span><br><span class="line">    <span class="comment"># coding的仓库 <用户名></span></span><br><span class="line"><span class="attr">    coding:</span> <span class="string">git@git.dev.tencent.com:SidneyGod/SidneyGod.git</span></span><br><span class="line"><span class="attr">  branch:</span> <span class="string">master</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Extensions 下面是一些插件 每个插件我都给了地址 具体怎么安装 可打开那些地址</span></span><br><span class="line"><span class="comment">## Plugins: https://hexo.io/plugins/</span></span><br><span class="line"><span class="comment">### Feed Atom https://github.com/hexojs/hexo-generator-feed</span></span><br><span class="line"><span class="attr">feed:</span></span><br><span class="line"><span class="attr">  type:</span> <span class="string">atom</span></span><br><span class="line"><span class="attr">  path:</span> <span class="string">atom.xml</span></span><br><span class="line"><span class="attr">  limit:</span> <span class="number">20</span></span><br><span class="line"><span class="attr">  order_by:</span> <span class="bullet">-date</span></span><br><span class="line"><span class="attr">  icon:</span> <span class="string">icon.png</span></span><br><span class="line"><span class="attr">  autodiscovery:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### Local Search https://github.com/wzpan/hexo-generator-search</span></span><br><span class="line"><span class="attr">search:</span></span><br><span class="line"><span class="attr">  path:</span> <span class="string">search.xml</span></span><br><span class="line"><span class="attr">  field:</span> <span class="string">post</span></span><br><span class="line"><span class="attr">  format:</span> <span class="string">html</span></span><br><span class="line"><span class="attr">  limit:</span> <span class="number">999</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### https://github.com/theme-next/hexo-symbols-count-time</span></span><br><span class="line"><span class="attr">symbols_count_time:</span></span><br><span class="line"><span class="attr">  symbols:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">  time:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">  total_symbols:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">  total_time:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">  exclude_codeblock:</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### https://github.com/Rozbo/hexo-abbrlink</span></span><br><span class="line"><span class="attr">abbrlink:</span></span><br><span class="line"><span class="attr">  alg:</span> <span class="string">crc32</span>  <span class="comment">#support crc16(default) and crc32</span></span><br><span class="line"><span class="attr">  rep:</span> <span class="string">hex</span>    <span class="comment">#support dec(default) and hex</span></span><br></pre></td></tr></tbody></table></figure><p>好了，hexo的配置文件完了，再举个例子，怎么安装依赖吧，就举那个abbrlink吧</p><p>先打开上面那个地址：<a href="https://github.com/Rozbo/hexo-abbrlink" target="_blank" rel="noopener">https://github.com/Rozbo/hexo-abbrlink</a></p><p>然后跟着他的步骤走一遍</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装</span></span><br><span class="line">npm install hexo-abbrlink --save</span><br><span class="line"><span class="comment"># 修改配置文件</span></span><br><span class="line">vim _config.yml</span><br></pre></td></tr></tbody></table></figure><p>一个是<code>permalink: posts/:abbrlink/</code>，如果你把它修改成<code>permalink: p/:abbrlink/</code>和简书的地址长得就很像了:joy:</p><p>另一个就是在下面添加</p><figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># abbrlink config</span></span><br><span class="line"><span class="attr">abbrlink:</span></span><br><span class="line"><span class="attr">  alg:</span> <span class="string">crc32</span>  <span class="comment">#support crc16(default) and crc32</span></span><br><span class="line"><span class="attr">  rep:</span> <span class="string">hex</span>    <span class="comment">#support dec(default) and hex</span></span><br></pre></td></tr></tbody></table></figure><p>嗯，安装好了，下一个…很简单，对不对，那么问题来了，如果安装了一个插件，然后觉得不好了，咋卸了它呢？直接执行</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm uninstall hexo-abbrlink</span><br><span class="line"><span class="comment"># 然后把你修改过的地方 改回来</span></span><br></pre></td></tr></tbody></table></figure><p>要是忘了这个插件名，怎么办？丢个图，自己体会</p><p><img alt data-src="https://gitee.com/SidneyGod/ImagePlace/raw/master/1570156735242.png"></p><p>好了hexo的配置告一段落</p><p>关于评论的配置，参考：<a href="https://www.jianshu.com/p/f4658df66a15" target="_blank" rel="noopener">https://www.jianshu.com/p/f4658df66a15</a></p><h2 id="2-2-NexT"><a href="#2-2-NexT" class="headerlink" title="2.2 NexT"></a>2.2 NexT</h2><p>接下来看next的配置文件，我们还接着一行一行注释吧，不！我拒绝，1000来行呢，我愿意，这看着也不舒服。丢个网址自己看：<a href="https://theme-next.org/docs/theme-settings/" target="_blank" rel="noopener">https://theme-next.org/docs/theme-settings/</a></p><p>说说插件吧，其实套路都一样</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Post wordcount display settings</span></span><br><span class="line"><span class="comment"># Dependencies: https://github.com/theme-next/hexo-symbols-count-time</span></span><br><span class="line">symbols_count_time:</span><br><span class="line">  separated_meta: <span class="literal">true</span></span><br><span class="line">  item_text_post: <span class="literal">true</span></span><br><span class="line">  item_text_total: <span class="literal">true</span></span><br><span class="line">  awl: 4</span><br><span class="line">  wpm: 275</span><br></pre></td></tr></tbody></table></figure><p>看到没，上面又有地址，这摆明了让你打开它，不打开它都不对不起它对你招了又招的小手：<a href="https://github.com/theme-next/hexo-symbols-count-time" target="_blank" rel="noopener">https://github.com/theme-next/hexo-symbols-count-time</a></p><p>然后你看到了吧，又是安装</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-symbols-count-time --save</span><br></pre></td></tr></tbody></table></figure><p>然后改配置</p><figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">symbols_count_time:</span></span><br><span class="line"><span class="attr">  separated_meta:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">  item_text_post:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">  item_text_total:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">  awl:</span> <span class="number">4</span>  <span class="comment"># 中文建议改成 2</span></span><br><span class="line"><span class="attr">  wpm:</span> <span class="number">275</span>  <span class="comment"># 中文建议改成 300</span></span><br><span class="line"><span class="attr">  suffix:</span> <span class="string">mins.</span></span><br></pre></td></tr></tbody></table></figure><p>要勇于尝试，还有看到别人家有的特效，都可以找找，不过特效越多，加载可能就会慢一点，毕竟文件多了嘛</p><h1 id="3-Beautify"><a href="#3-Beautify" class="headerlink" title="3 Beautify"></a>3 Beautify</h1><p>有了物质基础，当然要享受了，关于美化NexT的文章多得不得了，但是大多针对的是之前的NexT，有的美化可能需要修改<code>*.styl</code>文件什么的，其实没必要，新版本的NexT已经集成了那些特性，修改配置文件就有了</p><p>我比较懒，推荐几篇文档：</p><p><a href="http://shenzekun.cn/hexo的next主题个性化配置教程.html" target="_blank" rel="noopener">hexo的next主题个性化配置教程</a></p><p><a href="https://blog.csdn.net/u012195214/article/details/79204088" target="_blank" rel="noopener">NexT主题的优化定制修改指南</a></p><p><a href="https://leflacon.github.io/59f6b91c/" target="_blank" rel="noopener">如何给个人博客换上专属免费域名</a></p><p>还有自己搜索去吧…</p><p>对前端有了解的话，肯定知道，静态页面咋改都行，浏览器慢慢调试就是咯，NexT之前是有预留<code>_custom.styl</code>给用户自己修改css样式的，现在需要加点东西</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim themes/next/<span class="built_in">source</span>/css/main.styl</span><br></pre></td></tr></tbody></table></figure><p>首先说明，我并不懂这语法，也不想学，但是按照模样修改还是可以的</p><p><img alt data-src="https://gitee.com/SidneyGod/ImagePlace/raw/master/1570158669352.png"></p><p>就加了那句红框，然后在这个目录下创建<code>_custom</code>目录，再创建<code>custom.styl</code>文件，下面给出我的自定义css样式</p><figure class="highlight css"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line">// Custom styles.</span><br><span class="line">// 文章内链接文本样式</span><br><span class="line"><span class="selector-class">.post-body</span> <span class="selector-tag">p</span> <span class="selector-tag">a</span>{</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#0593d3</span>;</span><br><span class="line">  <span class="attribute">border-bottom</span>: none;</span><br><span class="line">  <span class="attribute">border-bottom</span>: <span class="number">1px</span> solid <span class="number">#0593d3</span>;</span><br><span class="line">  &:hover {</span><br><span class="line">    <span class="selector-tag">color</span>: <span class="selector-id">#fc6423</span>;</span><br><span class="line">    <span class="selector-tag">border-bottom</span>: <span class="selector-tag">none</span>;</span><br><span class="line">    <span class="selector-tag">border-bottom</span>: 1<span class="selector-tag">px</span> <span class="selector-tag">solid</span> <span class="selector-id">#fc6423</span>;</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">// 文章背景半透明</span><br><span class="line"><span class="selector-class">.content</span> {</span><br><span class="line">  border-radius: 20px; //文章背景设置圆角</span><br><span class="line">  <span class="selector-tag">padding</span>: 10<span class="selector-tag">px</span> 50<span class="selector-tag">px</span> 20<span class="selector-tag">px</span> 50<span class="selector-tag">px</span>;</span><br><span class="line">  <span class="selector-tag">background</span><span class="selector-pseudo">:rgba(255</span>, 255, 255, 0<span class="selector-class">.8</span>) <span class="selector-tag">none</span> <span class="selector-tag">repeat</span> <span class="selector-tag">scroll</span> !<span class="selector-tag">important</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.post-block</span> {</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="number">10px</span>;</span><br><span class="line">  <span class="attribute">background</span>: <span class="built_in">rgba</span>(255, 255, 255, 0) none repeat scroll <span class="meta">!important</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.post</span> {</span><br><span class="line">  <span class="attribute">background</span>: <span class="built_in">rgba</span>(255, 255, 255, 0) none repeat scroll <span class="meta">!important</span>;</span><br><span class="line">  <span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="built_in">rgba</span>(0, 0, 0, 0), <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="built_in">rgba</span>(0, 0, 0, 0), <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="built_in">rgba</span>(0, 0, 0, 0);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.page</span> {</span><br><span class="line">  <span class="attribute">background</span>: <span class="built_in">rgba</span>(255, 255, 255, 0) none repeat scroll <span class="meta">!important</span>;</span><br><span class="line">  <span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="built_in">rgba</span>(0, 0, 0, 0), <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="built_in">rgba</span>(0, 0, 0, 0), <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="built_in">rgba</span>(0, 0, 0, 0);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">// 去除页面底部页码上面的横线</span><br><span class="line"><span class="selector-class">.pagination</span> {</span><br><span class="line">    <span class="attribute">border</span>: none;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0px</span>;</span><br><span class="line">}</span><br><span class="line">// 去掉图片边框</span><br><span class="line"><span class="selector-class">.posts-expand</span> <span class="selector-class">.post-body</span> <span class="selector-tag">img</span> {</span><br><span class="line">    <span class="attribute">border</span>: none;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0px</span>;</span><br><span class="line">}</span><br><span class="line"><span class="selector-class">.post-gallery</span> <span class="selector-class">.post-gallery-img</span> <span class="selector-tag">img</span> {</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">3px</span>;</span><br><span class="line">}</span><br><span class="line"><span class="selector-class">.posts-expand</span> <span class="selector-class">.post-title</span> {</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">26px</span>;</span><br><span class="line">    <span class="attribute">font-weight</span>: <span class="number">700</span>;</span><br><span class="line">    <span class="attribute">letter-spacing</span>: <span class="number">1px</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">// 去除在页面文章之间的分割线</span><br><span class="line"><span class="selector-class">.posts-expand</span> <span class="selector-class">.post-eof</span> {</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0px</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="built_in">rgba</span>(255, 255, 255, 0);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">// 选中文字部分的样式</span><br><span class="line"><span class="selector-pseudo">::selection</span> {</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#222222</span>;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#fced6d</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">// 鼠标样式</span><br><span class="line">* {</span><br><span class="line">  <span class="attribute">cursor</span>: <span class="built_in">url</span>(<span class="string">"/./cursor/pointer.ico"</span>),auto<span class="meta">!important</span></span><br><span class="line">}</span><br><span class="line"><span class="selector-pseudo">:active</span> {</span><br><span class="line">  <span class="attribute">cursor</span>: <span class="built_in">url</span>(<span class="string">"/./cursor/click.ico"</span>),auto<span class="meta">!important</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">// fonts</span><br><span class="line">@<span class="keyword">font-face</span> {</span><br><span class="line">  <span class="attribute">font-family</span>: <span class="string">'DFGirlFull'</span>;</span><br><span class="line">  <span class="attribute">src</span>: <span class="built_in">url</span>(<span class="string">'/fonts/DFGirlFull.ttf'</span>);</span><br><span class="line">  <span class="attribute">font-weight</span>: <span class="number">400</span>;</span><br><span class="line">}</span><br><span class="line">@<span class="keyword">font-face</span> {</span><br><span class="line">  <span class="attribute">font-family</span>: <span class="string">'ModernAntiqua'</span>;</span><br><span class="line">  <span class="attribute">src</span>: <span class="built_in">url</span>(<span class="string">'/fonts/ModernAntiqua.ttf'</span>);</span><br><span class="line">  <span class="attribute">font-weight</span>: <span class="number">400</span>;</span><br><span class="line">}</span><br><span class="line">@<span class="keyword">font-face</span> {</span><br><span class="line">  <span class="attribute">font-family</span>: <span class="string">'Monaco'</span>;</span><br><span class="line">  <span class="attribute">src</span>: <span class="built_in">url</span>(<span class="string">'/fonts/Monaco.ttf'</span>);</span><br><span class="line">  <span class="attribute">font-weight</span>: <span class="number">400</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>这个文件中的鼠标样式和字体需要自己提供，置于位置，记住<code>blog/themes/next/source</code>就是根目录，然后放哪，你开心就好，这其实就是主题的核心样式位置，还有个布局格式在<code>blog/themes/next/layout</code>，难度不大</p><h1 id="4-Deploy"><a href="#4-Deploy" class="headerlink" title="4 Deploy"></a>4 Deploy</h1><h2 id="4-1-写篇文章"><a href="#4-1-写篇文章" class="headerlink" title="4.1 写篇文章"></a>4.1 写篇文章</h2><p>一切都做好了，终于可以开始愉快的写blog了，新建一篇blog</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo new <span class="string">"Article Name"</span></span><br></pre></td></tr></tbody></table></figure><p>然后就会在<code>blog/source/_posts</code>新建一个<code>Article Name.md</code>文件，打开这个文件你就可以写blog了。问题来了，这以后blog文章一旦多了，找md文件多费事，能不能在new完自动打开这个文件？当然能！hexo作者这点还是想到了的</p><p>首先在<code>hexo</code>目录的<code>scripts</code>目录中创建一个JavaScript文件，文件名随意，如果没有<code>scripts</code>那就创建一个，然后在js文件中添加这么段代码</p><p>Win：</p><figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> spawn = <span class="built_in">require</span>(<span class="string">'child_process'</span>).exec;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Hexo 3 用户复制这段</span></span><br><span class="line">hexo.on(<span class="string">'new'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>{</span><br><span class="line">  <span class="comment">// 这是我打开markdown文件软件的路径</span></span><br><span class="line">  spawn(<span class="string">'start  "D:\Program Files\Typora\Typora.exe" '</span> + data.path);</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure><p>Mac：</p><figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> exec = <span class="built_in">require</span>(<span class="string">'child_process'</span>).exec;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Hexo 3 用户复制这段</span></span><br><span class="line">hexo.on(<span class="string">'new'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>{</span><br><span class="line">    exec(<span class="string">'open -a "markdown编辑器绝对路径.app" '</span> + data.path);</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure><h2 id="4-2-发布"><a href="#4-2-发布" class="headerlink" title="4.2 发布"></a>4.2 发布</h2><p>写好了，那就发布吧</p><h3 id="4-2-1-安装插件"><a href="#4-2-1-安装插件" class="headerlink" title="4.2.1 安装插件"></a>4.2.1 安装插件</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装插件</span></span><br><span class="line">npm install hexo-deployer-git --save</span><br><span class="line"><span class="comment"># 修改hexo配置文件</span></span><br><span class="line">vim _config.yml</span><br></pre></td></tr></tbody></table></figure><p>上面说过的</p><figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Deployment</span></span><br><span class="line"><span class="comment">## Docs: https://hexo.io/docs/deployment.html</span></span><br><span class="line"><span class="attr">deploy:</span></span><br><span class="line"><span class="attr">  type:</span> <span class="string">git</span></span><br><span class="line"><span class="attr">  repo:</span></span><br><span class="line">    <span class="comment"># 这个部署就按照这个样式 GitHub的仓库 <用户名>.github.io</span></span><br><span class="line"><span class="attr">    github:</span> <span class="string">git@github.com:SidneyGod/SidneyGod.github.io.git</span></span><br><span class="line">    <span class="comment"># 码云的仓库 <用户名> 码云比较坑 需要手动更新</span></span><br><span class="line"><span class="attr">    gitee:</span> <span class="string">git@gitee.com:SidneyGod/SidneyGod.git</span></span><br><span class="line">    <span class="comment"># coding的仓库 <用户名></span></span><br><span class="line"><span class="attr">    coding:</span> <span class="string">git@git.dev.tencent.com:SidneyGod/SidneyGod.git</span></span><br><span class="line"><span class="attr">  branch:</span> <span class="string">master</span></span><br></pre></td></tr></tbody></table></figure><h3 id="4-2-2-创建仓库"><a href="#4-2-2-创建仓库" class="headerlink" title="4.2.2 创建仓库"></a>4.2.2 创建仓库</h3><p><strong>github</strong></p><p>创建好<code><用户名>.github.io</code>仓库，git地址也是对的，就可以直接部署了，每次更新，github也会自动更新</p><p>毕竟github不在国内，可能访问速度有点慢</p><p><strong>码云</strong></p><p>创建好同名仓库，然后需要以下操作</p><ol><li><p>进入仓库 > Service > Gitee Pages</p><p><img alt data-src="https://gitee.com/SidneyGod/ImagePlace/raw/master/1570160301420.png"></p></li><li><p>点击Update</p><p><img alt data-src="https://gitee.com/SidneyGod/ImagePlace/raw/master/1570160387541.png"></p></li></ol><p><strong>这不是只要做一次，而是你每次更新页面都需要手动去更新!!!</strong></p><p><strong>coding</strong></p><p>创建好同名仓库，只需要做一次，之后会自动同步</p><ol><li><p>进入仓库 > 代码 > Pages 服务</p><p><img alt data-src="https://gitee.com/SidneyGod/ImagePlace/raw/master/1570160610224.png"></p></li><li><p>一键开启</p><p><img alt data-src="https://gitee.com/SidneyGod/ImagePlace/raw/master/1570160683781.png"></p></li></ol><p>已经被腾讯买了</p><h3 id="4-2-3-hexo命令"><a href="#4-2-3-hexo命令" class="headerlink" title="4.2.3 hexo命令"></a>4.2.3 hexo命令</h3><p>这个时候就可以通过</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 清空public目录 没必要每次都做 除非安装了新插件什么的</span></span><br><span class="line">hexo clean</span><br><span class="line"><span class="comment"># 生成文件</span></span><br><span class="line">hexo g <span class="comment"># hexo generate</span></span><br><span class="line"><span class="comment"># 部署到git仓库</span></span><br><span class="line">hexo d <span class="comment"># hexo deploy</span></span><br></pre></td></tr></tbody></table></figure><p>这时候就可以通过</p><p><a href="https://sidneygod.github.io/">https://sidneygod.github.io/</a></p><p><a href="https://sidneygod.coding.me/" target="_blank" rel="noopener">https://sidneygod.coding.me/</a></p><p><a href="https://sidneygod.gitee.io/" target="_blank" rel="noopener">https://sidneygod.gitee.io/</a></p><p>访问blog了</p></body></html>]]></content>
      
      
      <categories>
          
          <category> Other </category>
          
      </categories>
      
      
        <tags>
            
            <tag> blog </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Git Learning</title>
      <link href="/posts/3ab58e11/"/>
      <url>/posts/3ab58e11/</url>
      
        <content type="html"><![CDATA[<html><head></head><body><h1 id="0-初始化"><a href="#0-初始化" class="headerlink" title="0 初始化"></a>0 初始化</h1><p>每台计算机只需配置一次，升级时会保留配置信息。</p><p>Git自带一个 git config 的工具帮助设置控制Git外观和行为的配置变量，这些变量存在于三个不同的位置：</p><ul><li>/etc/gitconfig：包含系统上每一个用户的及他们仓库的通用配置。如果带有<code>--system</code>选项的git config时，会从此文件读写变量</li><li>~/.gitconfig或~/.config/git/config：只针对当前用户。使用<code>--global</code>选项读写此文件</li><li>当前仓库目录中的config(.git/config)：针对该仓库</li></ul><p>每一级别覆盖上一级别</p><p><strong>基本配置</strong></p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 配置用户名和邮箱</span></span><br><span class="line">git config --global user.name "Sidney Ding"</span><br><span class="line">git config --global user.email "dingfs0527@thundersoft.com"</span><br><span class="line"><span class="meta">#</span><span class="bash"> 文本编辑器 根据喜好</span></span><br><span class="line">git config --glonal core.editor vim</span><br><span class="line"><span class="meta">#</span><span class="bash"> 检查配置信息</span></span><br><span class="line">git config --list</span><br><span class="line">git config user.name</span><br><span class="line"><span class="meta">#</span><span class="bash"> 获取帮助</span></span><br><span class="line">git help <verb></span><br><span class="line">git <verb> --help</span><br><span class="line">man git-<verb></span><br></pre></td></tr></tbody></table></figure><a id="more"></a><h1 id="1-基础"><a href="#1-基础" class="headerlink" title="1 基础"></a>1 基础</h1><p>Git使用基本流程</p><p><img alt data-src="https://gitee.com/SidneyGod/ImagePlace/raw/master/git1.png"></p><h2 id="1-1-获取git仓库"><a href="#1-1-获取git仓库" class="headerlink" title="1.1 获取git仓库"></a>1.1 获取git仓库</h2><p>获取仓库的方法有两种</p><h3 id="1-1-1-现有目录初始化"><a href="#1-1-1-现有目录初始化" class="headerlink" title="1.1.1 现有目录初始化"></a>1.1.1 现有目录初始化</h3><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 进入项目目录</span></span><br><span class="line">cd <ProjectDir></span><br><span class="line"><span class="meta">#</span><span class="bash"> 初始化 会创建一个.git子目录</span></span><br><span class="line">git init</span><br></pre></td></tr></tbody></table></figure><h3 id="1-1-2-克隆现有仓库"><a href="#1-1-2-克隆现有仓库" class="headerlink" title="1.1.2 克隆现有仓库"></a>1.1.2 克隆现有仓库</h3><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> RepoUrl根据协议不同 地址类型也不近相同</span></span><br><span class="line">git clone <RepoUrl></span><br><span class="line"><span class="meta">#</span><span class="bash"> 会在当前目录下创建testRepo目录 并初始化出一个.git文件夹</span></span><br><span class="line">git clone https://github.com/userName/testRepo</span><br><span class="line"><span class="meta">#</span><span class="bash"> 创建的目录变为MyRepo</span></span><br><span class="line">git clone https://github.com/userName/testRepo MyRepo</span><br></pre></td></tr></tbody></table></figure><h2 id="1-2-忽略文件"><a href="#1-2-忽略文件" class="headerlink" title="1.2 忽略文件"></a>1.2 忽略文件</h2><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> cat .gitignore</span></span><br><span class="line">*.[oa]</span><br><span class="line">*~</span><br></pre></td></tr></tbody></table></figure><ul><li>所有空行或以<code>#</code>开头的行都会被git忽略</li><li>可以使用标准的glob模式匹配</li><li>匹配模式可以以<code>/</code>开头防止递归</li><li>匹配模式可以以<code>/</code>结尾指定目录</li><li>要忽略指定模式以外的文件或目录，可以在模式前加<code>!</code>取反</li></ul><p>glob模式：shell中简化的正则</p><ul><li><code>*</code>：匹配零个或任意多个字符</li><li><code>[abc]</code>：匹配a,b,c之间任意一个字符</li><li><code>?</code>：匹配任意一个字符</li><li>[0-9]：表示匹配0-9之间人一个数字</li><li><code>a/**/z</code>：匹配任意中间目录，例：a/b/z,/a/b/c/z…</li><li>more: <a href="https://github.com/github/gitignore" target="_blank" rel="noopener">https://github.com/github/gitignore</a></li></ul><h2 id="1-3-本地文件管理"><a href="#1-3-本地文件管理" class="headerlink" title="1.3 本地文件管理"></a>1.3 本地文件管理</h2><p><img alt data-src="https://gitee.com/SidneyGod/ImagePlace/raw/master/git2.png"></p><ul><li>工作区：未隐藏的部分</li><li>版本库：<code>.git</code>目录<ul><li>Index：<code>.git/index</code>，暂存区</li><li>HEAD：<code>.git/HEAD</code>，是一个指针，指向当前分支的版本</li><li>master：只是一个存放40位sha-1的文件而已</li></ul></li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 用暂存区的文件替换工作区的文件 撤销修改</span></span><br><span class="line">git checkout -- <file></span><br><span class="line">git checkout .</span><br><span class="line"><span class="meta">#</span><span class="bash"> 将文件加到暂存区</span></span><br><span class="line">git add <file></span><br><span class="line"><span class="meta">#</span><span class="bash"> 可以查看文件的状态</span></span><br><span class="line">git status</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看文件的详细状态</span></span><br><span class="line">git diff</span><br><span class="line">git diff --staged</span><br><span class="line"><span class="meta">#</span><span class="bash"> 撤销暂存区的修改</span></span><br><span class="line">git reset HEAD <file></span><br><span class="line"><span class="meta">#</span><span class="bash"> 删除暂存区的文件 工作区的文件不做修改</span></span><br><span class="line">git rm --cached <file></span><br><span class="line"><span class="meta">#</span><span class="bash"> 改名字 等价于三条命令 mv README.md README | git rm README.md | git add README</span></span><br><span class="line">git mv README.md README</span><br><span class="line"><span class="meta">#</span><span class="bash"> 将暂存区的目录树写到版本库中HEAD指向的分支</span></span><br><span class="line">git commit</span><br><span class="line"><span class="meta">#</span><span class="bash"> 修改commit信息</span></span><br><span class="line">git commit --amend</span><br><span class="line"><span class="meta">#</span><span class="bash"> 撤销上一次提交 其实并不是撤销 其实保留了上一次提交 只是copy了上上次提交的状态</span></span><br><span class="line">git revert -m 1 HEAD</span><br><span class="line">git revert -m commitId</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看提交历史 由近及远</span></span><br><span class="line">git log</span><br><span class="line">git log -p</span><br><span class="line">git log -3</span><br><span class="line">git log --pretty=oneline</span><br><span class="line"><span class="meta">#</span><span class="bash"> 回退到前一个版本 1可以改为任意版本内的数字</span></span><br><span class="line">git reset --hard HEAD~1</span><br><span class="line"><span class="meta">#</span><span class="bash"> 回到任意的提交版本 commitId不必写全 HEAD确实是一个指针</span></span><br><span class="line">git reset --hard <commitId></span><br><span class="line"><span class="meta">#</span><span class="bash"> 命令历史</span></span><br><span class="line">git reflog</span><br></pre></td></tr></tbody></table></figure><p>后悔药使用指南:</p><p>git checkout .  还没有add</p><p>git reset</p><h2 id="1-4-远程仓库"><a href="#1-4-远程仓库" class="headerlink" title="1.4 远程仓库"></a>1.4 远程仓库</h2><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 显示所有的读写远程仓库</span></span><br><span class="line">git remote -v</span><br><span class="line"><span class="meta">#</span><span class="bash"> 添加一个远程仓库</span></span><br><span class="line">git remote add <shortname> <url></span><br><span class="line"><span class="meta">#</span><span class="bash"> 从远程仓库获取数据</span></span><br><span class="line">git fetch [remoteName]</span><br><span class="line"><span class="meta">#</span><span class="bash"> 抓取数据并尝试自动合并</span></span><br><span class="line">git pull</span><br><span class="line"><span class="meta">#</span><span class="bash"> 推送到远程仓库</span></span><br><span class="line">git push [remoteName] [branchName]</span><br><span class="line">git push origin master</span><br><span class="line">git push origin HEAD:refs/for/<branchName></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看远程仓库信息</span></span><br><span class="line">git remote show [remoteName]</span><br><span class="line"><span class="meta">#</span><span class="bash"> 重命名远程仓库</span></span><br><span class="line">git remote rename <oldRemoteName> <newRemoteName></span><br><span class="line">git remote rm <remoteName></span><br></pre></td></tr></tbody></table></figure><h2 id="1-5-打标签"><a href="#1-5-打标签" class="headerlink" title="1.5 打标签"></a>1.5 打标签</h2><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 列出所有的标签</span></span><br><span class="line">git tag</span><br><span class="line">git tag -l 'v1.8*'</span><br><span class="line"><span class="meta">#</span><span class="bash"> 打附注标签</span></span><br><span class="line">git tag -a v1.9 -m 'Version 1.9'</span><br><span class="line"><span class="meta">#</span><span class="bash"> 打轻量标签</span></span><br><span class="line">git tag v1.9-lw</span><br><span class="line"><span class="meta">#</span><span class="bash"> 后期打标签</span></span><br><span class="line">git tag -a v1.7 <commitId></span><br><span class="line"><span class="meta">#</span><span class="bash"> 默认标签不会传送到远程仓库</span></span><br><span class="line">git push origin [tagname]</span><br><span class="line">git push origin --tags  # 一次性传很多标签</span><br><span class="line"><span class="meta">#</span><span class="bash"> 删除tag</span></span><br><span class="line">git tag -d <tagName></span><br></pre></td></tr></tbody></table></figure><h2 id="1-5-别名"><a href="#1-5-别名" class="headerlink" title="1.5 别名"></a>1.5 别名</h2><p>可以给命令起别名 简化操作</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 之后可以用 git co 代替 git checkout</span></span><br><span class="line">git config --global alias.co checkout</span><br><span class="line">git config --global alias.br branch</span><br><span class="line">git config --global alias.ci commit</span><br><span class="line">git config --global alias.st status</span><br><span class="line"><span class="meta">#</span><span class="bash"> 使用git last 查看上一次提交</span></span><br><span class="line">git config --global alias.last 'log -a HEAD'</span><br></pre></td></tr></tbody></table></figure><h2 id="1-7-other"><a href="#1-7-other" class="headerlink" title="1.7 other"></a>1.7 other</h2><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 修改author</span></span><br><span class="line">git commit --amend --author="author name..."</span><br></pre></td></tr></tbody></table></figure><h1 id="2-分支"><a href="#2-分支" class="headerlink" title="2 分支"></a>2 分支</h1><p>简单来说就是时间线，每条时间线上有很多时间点(commit)</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 创建分支 dev</span></span><br><span class="line">git branch dev</span><br><span class="line"><span class="meta">#</span><span class="bash"> 切换到 dev 分支</span></span><br><span class="line">git checkout dev</span><br><span class="line"><span class="meta">#</span><span class="bash"> 创建并切换到分支 dev</span></span><br><span class="line">git checkout -b dev</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看当前分支</span></span><br><span class="line">git branch</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看所有分支</span></span><br><span class="line">git branch -a</span><br><span class="line"><span class="meta">#</span><span class="bash"> 合并制定分支到当前分支 fast-forward 代表只是向上游移动</span></span><br><span class="line">git merge dev</span><br><span class="line"><span class="meta">#</span><span class="bash"> 删除分支</span></span><br><span class="line">git branch -d dev</span><br></pre></td></tr></tbody></table></figure><h2 id="2-1-冲突"><a href="#2-1-冲突" class="headerlink" title="2.1 冲突"></a>2.1 冲突</h2><p>当合并分支不再是 fast-forward 模式时，Git只是试图将各自修改的部分合并起来，但这种合并会有冲突</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git merge feature1</span></span><br><span class="line">Auto-merging testFile.txt</span><br><span class="line">CONFLICT (content): Merge conflict in testFile.txt</span><br><span class="line">Automatic merge failed; fix conflicts and then commit the result.</span><br></pre></td></tr></tbody></table></figure><p>Git提示我们需要手动解决冲突后再提交，通过<code>git status</code>也可以知道冲突的文件</p><p>在解决冲突时，可以使用<code>meld fileName</code></p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><<<<<<< HEAD</span><br><span class="line">Creating a new branch is quick & simple.</span><br><span class="line">=======</span><br><span class="line">Creating a new branch is quick AND simple.</span><br><span class="line"><span class="meta">></span><span class="bash">>>>>>></span></span><br></pre></td></tr></tbody></table></figure><p><<<<<<<，=======，>>>>>>> 标记出不同分支的内容，需要手动去解决，比如手动修改后：</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Creating a new branch is quick and simple.</span><br></pre></td></tr></tbody></table></figure><p>这样就可以再进行提交了</p><p>通过<code>git log --graph --pretty=oneline --abbrev-commit</code>可以查看分支合并情况</p><p>中断合并<code>git merge --abort</code></p><h2 id="2-2-bug分支"><a href="#2-2-bug分支" class="headerlink" title="2.2 bug分支"></a>2.2 bug分支</h2><p>背景：当前正在<code>dev</code>进行工作，且进行到一半，还没法提交，预计还需要1天完成，此时来了一个bug，这个bug必须在两小时内修复</p><p>Git提供了<code>stash</code>功能，可以把当前工作现场存储起来，等以后恢复后继续工作</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git stash</span></span><br><span class="line">Saved working directory and index state WIP on dev: f52c633 and merge</span><br></pre></td></tr></tbody></table></figure><p>此时使用<code>git status</code>可以看到工作区是干净的，可以放心创建分支来修复bug。比如现在在master上创建分支修复bug</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">git checkout master</span><br><span class="line">git checkout -b issue-101</span><br><span class="line"><span class="meta">#</span><span class="bash"> 进行一系列复杂操作 修复了bug 提交</span></span><br><span class="line">git commit -m "fix bug 101"</span><br><span class="line"><span class="meta">#</span><span class="bash"> 切换回master分支</span></span><br><span class="line">git checkout master</span><br><span class="line"><span class="meta">#</span><span class="bash"> 合并分支 --no-ff 表示禁用fast-forward模式</span></span><br><span class="line">git merge --no-ff -m "merge bug fix 101" issue-101</span><br><span class="line"><span class="meta">#</span><span class="bash"> 删除bug分支</span></span><br><span class="line">git branch -d issue-101</span><br><span class="line"><span class="meta">#</span><span class="bash"> 切回dev分支继续干活</span></span><br><span class="line">git checkout dev</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看工作现场</span></span><br><span class="line">git stash list</span><br><span class="line"><span class="meta">#</span><span class="bash"> 恢复工作现场同时删除工作现场</span></span><br><span class="line">git stash pop</span><br></pre></td></tr></tbody></table></figure><p>还可以使用<code>git stash apply stash@{0}</code>恢复，然后现场还在，需要通过<code>git stash drop stash@{0}</code>删除</p><blockquote><p>注意：git stash之前，一定要先用git status看一下，是否有Untrackted files。如果有，需要先add。因为git stash不能将untrakcted file压栈</p><p>没有commit切换分支是会报错的</p><p>工作区和暂存区是一个公开的平台，任何一个分支都会用到</p></blockquote><h2 id="2-3-Feature分支"><a href="#2-3-Feature分支" class="headerlink" title="2.3 Feature分支"></a>2.3 Feature分支</h2><p>开发时，每添加一个新功能最好新建一个feature分支，因为这个功能的代码可能是实验性质的，不能把主分支搞乱。</p><p>新建Feature分支，开发，合并，删除Feature分支</p><p>开发到一半，觉得这个不行，可以使用<code>git branch -D fearture</code>进行强行删除</p><h2 id="2-4-多人协作"><a href="#2-4-多人协作" class="headerlink" title="2.4 多人协作"></a>2.4 多人协作</h2><p>首先，试图使用<code>git push origin <branchName></code>推送自己的修改</p><p>如果推送失败，则因为远程分支比你新，需要先用<code>git pull</code>试图合并</p><p>若果有冲突，则解决冲突，并在本地提交</p><p>没有冲突或者解决冲突后，再用<code>git push origin <branchName></code>推送就能成功</p><blockquote><p>如果<code>git pull</code>提示<code>no tracking information</code>，则说明本地分支和远程分支的链接关系没有创建，用命令<code>git branch --setupstream-to=origin/branch-name branch-name</code>建立本地分支与远程分支的关联</p><p>本地新建分支如果不推送到远程，对其他人就是不可见的，于是可以随便玩..</p><p><code>git pull</code> = <code>git fetch</code> + <code>git merge</code></p></blockquote><h2 id="2-5-变基rebase"><a href="#2-5-变基rebase" class="headerlink" title="2.5 变基rebase"></a>2.5 变基rebase</h2><p>合并分支的一种方式</p><ul><li>rebase操作可以把本地未push的分叉提交历史整理成直线</li><li>目的是为了我们在查看历史提交的变化时更容易，因为分叉的提交需要三方对比</li><li>变基有风险！</li></ul><h1 id="3-Patch"><a href="#3-Patch" class="headerlink" title="3 Patch"></a>3 Patch</h1><ul><li>创建补丁</li></ul><p><code>git diff > my.patch</code></p><p><code>git diff --no-prefix > my.patch</code></p><p><code>git diff master > my.patch</code></p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 将最近的三次提交 变为patch文件 -s 表示加上当前用户签名</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git format-patch -s HEAD~3..HEAD</span></span><br><span class="line">0001-Fix-typo-help-to-help.patch</span><br><span class="line">0002-Add-I18N-support.patch</span><br><span class="line">0003-Translate-for-Chinese.patch</span><br></pre></td></tr></tbody></table></figure><ul><li>通过邮件发送补丁</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git send-email *.patch</span><br></pre></td></tr></tbody></table></figure><p><code>git am</code>应用来自邮箱的补丁，特别是被mbox格式化过的</p><ul><li>应用补丁</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 基于HEAD~3创建一个分支</span></span><br><span class="line">git checkout -b branch1 HEAD~3</span><br><span class="line"><span class="meta">#</span><span class="bash"> 应用补丁</span></span><br><span class="line">git apply *.patch</span><br><span class="line"><span class="meta">#</span><span class="bash"> 如果apply一个patch出错，报error: patch failed: drivers/usb/host/xhci.c:918之类的错误，那么是因为本地已经有这个patch了，所以不能够apply</span></span><br></pre></td></tr></tbody></table></figure><ul><li>cherry-pick</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 引入特性分支的某个提交</span></span><br><span class="line">git cherry-pick commitId</span><br></pre></td></tr></tbody></table></figure><h1 id="4-Repo"><a href="#4-Repo" class="headerlink" title="4 Repo"></a>4 Repo</h1><p>repo就是通过Python对git的一个封装，用于管理多个Git版本库</p><h2 id="4-1-安装repo"><a href="#4-1-安装repo" class="headerlink" title="4.1 安装repo"></a>4.1 安装repo</h2><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 下载repo的引导脚本</span></span><br><span class="line">curl https://storage.googleapis.com/git-repo-downloads/repo > ~/bin/repo</span><br><span class="line"><span class="meta">#</span><span class="bash"> 将repo脚本设置为可执行</span></span><br><span class="line">chmod a+x ~/bin/repo</span><br></pre></td></tr></tbody></table></figure><h2 id="4-2-初始化"><a href="#4-2-初始化" class="headerlink" title="4.2 初始化"></a>4.2 初始化</h2><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mkdir work-dir</span><br><span class="line">cd work-dir</span><br><span class="line"><span class="meta">#</span><span class="bash"> 初始化清单文件 就是一个.git文件</span></span><br><span class="line">repo init -u <gitUrl></span><br><span class="line">repo init -u <gitUrl> -b <branchName></span><br><span class="line"><span class="meta">#</span><span class="bash"> 表示优先从本地的mirror同步 提高下载速度</span></span><br><span class="line">repo init -u <gitUrl> -b <branchName> --reference=<localServerMirror></span><br></pre></td></tr></tbody></table></figure><p>此时工作目录就会有个<code>.repo</code>文件夹，其中有个<code>manifest.xml</code>文件，这文件里面包含了Android各项目的信息</p><blockquote><p>代码库本地镜像 <code>repo init --mirror -u <gitUrl></code></p></blockquote><h2 id="4-3-同步"><a href="#4-3-同步" class="headerlink" title="4.3 同步"></a>4.3 同步</h2><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 同步代码到本地</span></span><br><span class="line">repo sync -j6</span><br><span class="line"><span class="meta">#</span><span class="bash"> 其中</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> -j 多任务 过多会起反作用</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> -c 只下载当前代码</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> -d 让工程回退到manifest制定的版本</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> -f 如果某个工程同步失败 继续同步</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 也可以只同步感兴趣的代码</span></span><br><span class="line">repo sync platform/build</span><br></pre></td></tr></tbody></table></figure><h2 id="4-4-常用命令"><a href="#4-4-常用命令" class="headerlink" title="4.4 常用命令"></a>4.4 常用命令</h2><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 获取帮助</span></span><br><span class="line">repo help <command></span><br></pre></td></tr></tbody></table></figure><ul><li><p>repo init</p></li><li><p>repo sync</p><p>相当于<code>git clone</code>或<code>git update</code> + <code>git rebase origin/branch</code></p></li><li><p>repo start</p><p>对<code>git checkout -b</code>的封装</p><p><code>repo start <newBranchName> [--all | <project>...]</code></p></li><li><p>repo checkout</p><p>对<code>git checkout</code>的封装</p></li><li><p>repo status</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">project system/core/                            (*** NO BRANCH ***)</span><br><span class="line"> -m     fs_mgr/fs_mgr_fstab.cpp</span><br></pre></td></tr></tbody></table></figure></li></ul><p>每个小节的首行显示项目名称,以及所在分支名称</p><p>之后显示该项目中文件变更状态。头两个字母显示变更状态,后面显示文件名或者其<br>  他变更信息</p><p>第一个字母表示暂存区的文件修改状态</p><ul><li>- :没有改变<ul><li>A :添加 (不在HEAD中, 在暂存区)</li><li>M :修改 (在HEAD中, 在暂存区, 内容不同)</li><li>D :删除 (在HEAD中, 不在暂存区)</li><li>R :重命名 (不在HEAD中, 在暂存区, 路径修改 )</li><li>C :拷贝 (不在HEAD中, 在暂存区, 从其他文件拷贝)</li><li>T :文件状态改变 (在HEAD中, 在暂存区, 内容相同)</li><li>U :未合并, 需要冲突解决</li></ul></li></ul><p>第二个字母表示工作区文件的更改状态</p><ul><li>- :新/未知 (不在暂存区, 在工作区)<ul><li>m :修改 (在暂存区, 在工作区,被修改)</li><li>d :删除 (在暂存区,不在工作区)</li></ul></li></ul><p>两个表示状态的字母后面,显示文件名信息。如果有文件重命名还会显示改变前后的<br>  文件名以及文件的相似度</p><ul><li><p>repo diff [<project>…]</p><p>是对<code>git diff</code>命令的封装,用以分别显示各个项目工作区下的文件差异</p></li></ul><p><img alt data-src="https://gitee.com/SidneyGod/ImagePlace/raw/master/1562563963220.png"></p><h1 id="5-Gerrit"><a href="#5-Gerrit" class="headerlink" title="5 Gerrit"></a>5 Gerrit</h1><p>先加ssh-key</p><p>Gerrit下的Git服务器只允许用户向特殊的引用<code>ref/for/<branchName></code>推送，这样才会创建一个reviewId</p></body></html>]]></content>
      
      
      <categories>
          
          <category> Other </category>
          
      </categories>
      
      
        <tags>
            
            <tag> git </tag>
            
            <tag> repo </tag>
            
            <tag> gerrit </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
