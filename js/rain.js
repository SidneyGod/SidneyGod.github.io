document.addEventListener("DOMContentLoaded",(function(){demo.init(),window.addEventListener("resize",demo.resize)}));var demo={speed:1,color:{r:"80",g:"175",b:"255",a:"0.5"},started:!1,canvas:null,ctx:null,width:0,height:0,dpr:window.devicePixelRatio||1,drop_time:0,drop_delay:25,wind:4,rain_color:null,rain_color_clear:null,rain:[],rain_pool:[],drops:[],drop_pool:[]};function Rain(){this.x=0,this.y=0,this.z=0,this.speed=25,this.splashed=!1}function Drop(){this.x=0,this.y=0,this.radius=Math.round(2*Math.random()+1)*demo.dpr,this.speed_x=0,this.speed_y=0,this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d");var e=2*this.radius;this.canvas.width=e,this.canvas.height=e;var o=this.ctx.createRadialGradient(this.radius,this.radius,1,this.radius,this.radius,this.radius);o.addColorStop(0,demo.rain_color),o.addColorStop(1,demo.rain_color_clear),this.ctx.fillStyle=o,this.ctx.fillRect(0,0,e,e)}demo.init=function(){if(!demo.started){demo.started=!0,demo.canvas=document.getElementById("canvas-rain"),demo.ctx=demo.canvas.getContext("2d");var e=demo.color;demo.rain_color="rgba("+e.r+","+e.g+","+e.b+","+e.a+")",demo.rain_color_clear="rgba("+e.r+","+e.g+","+e.b+",0)",demo.resize(),Ticker.addListener(demo.step)}},demo.resize=function(){for(var e=demo.rain,o=demo.drops,t=e.length-1;t>=0;t--)e.pop().recycle();for(t=o.length-1;t>=0;t--)o.pop().recycle();demo.width=window.innerWidth,demo.height=window.innerHeight,demo.canvas.width=demo.width*demo.dpr,demo.canvas.height=demo.height*demo.dpr},demo.step=function(e,o){var t=window.demo,i=t.speed,d=t.width,r=t.height,n=t.wind,a=t.rain,s=t.rain_pool,h=t.drops,p=(t.drop_pool,i*o);for(t.drop_time+=e*i;t.drop_time>t.drop_delay;){t.drop_time-=t.drop_delay;var c=s.pop()||new Rain;c.init();var m=Math.abs(r/c.speed*n),l=Math.random()*(d+m);n>0&&(l-=m),c.x=l,a.push(c)}for(var u=a.length-1;u>=0;u--){var v=a[u];v.y+=v.speed*v.z*p,v.x+=v.z*n*p,v.y>r&&v.splash(),(v.y>r+Rain.height*v.z||n<0&&v.x<n||n>0&&v.x>d+n)&&(v.recycle(),a.splice(u,1))}var _=Drop.max_speed;for(u=h.length-1;u>=0;u--){var f=h[u];f.x+=f.speed_x*p,f.y+=f.speed_y*p,f.speed_y+=.3*p,f.speed_x+=n/25*p,f.speed_x<-_?f.speed_x=-_:f.speed_x>_&&(f.speed_x=_),f.y>r+f.radius&&(f.recycle(),h.splice(u,1))}t.draw()},demo.draw=function(){var e=window.demo,o=e.width,t=e.height,i=e.dpr,d=e.rain,r=e.drops,n=e.ctx;n.clearRect(0,0,o*i,t*i),n.beginPath();for(var a=Rain.height*i,s=d.length-1;s>=0;s--){var h=d[s],p=h.x*i,c=h.y*i;n.moveTo(p,c),n.lineTo(p-e.wind*h.z*i*1.5,c-a*h.z)}n.lineWidth=Rain.width*i,n.strokeStyle=e.rain_color,n.stroke();for(s=r.length-1;s>=0;s--){var m=r[s];p=m.x*i-m.radius,c=m.y*i-m.radius;n.drawImage(m.canvas,p,c)}},Rain.width=2,Rain.height=40,Rain.prototype.init=function(){this.y=-100*Math.random(),this.z=.5*Math.random()+.5,this.splashed=!1},Rain.prototype.recycle=function(){demo.rain_pool.push(this)},Rain.prototype.splash=function(){if(!this.splashed){this.splashed=!0;for(var e=demo.drops,o=demo.drop_pool,t=0;t<16;t++){var i=o.pop()||new Drop;e.push(i),i.init(this.x)}}},Drop.max_speed=5,Drop.prototype.init=function(e){this.x=e,this.y=demo.height;var o=Math.random()*Math.PI-.5*Math.PI,t=Math.random()*Drop.max_speed;this.speed_x=Math.sin(o)*t,this.speed_y=-Math.cos(o)*t},Drop.prototype.recycle=function(){demo.drop_pool.push(this)},demo.mouseHandler=function(e){demo.updateCursor(e.clientX,e.clientY)},demo.touchHandler=function(e){e.preventDefault();var o=e.touches[0];demo.updateCursor(o.clientX,o.clientY)},demo.updateCursor=function(e,o){e/=demo.width;var t=1-(o/=demo.height);demo.drop_delay=t*t*t*100+2,demo.wind=50*(e-.5)},document.addEventListener("mousemove",demo.mouseHandler),document.addEventListener("touchstart",demo.touchHandler),document.addEventListener("touchmove",demo.touchHandler);var Ticker=function(){var e={addListener:function(e){if("function"!=typeof e)throw"Ticker.addListener() requires a function reference passed in.";i.push(e),o||(o=!0,d())}},o=!1,t=0,i=[];function d(){window.requestAnimationFrame?requestAnimationFrame(r):webkitRequestAnimationFrame(r)}function r(e){var o=e-t;t=e,o<0?o=17:o>68&&(o=68);for(var r=0,n=i.length;r<n;r++)i[r].call(window,o,o/16.67);d()}return e}();