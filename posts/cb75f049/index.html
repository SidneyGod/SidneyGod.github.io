<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 4.2.0"><link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.ico?v=7.4.1"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico?v=7.4.1"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.ico?v=7.4.1"><link rel="mask-icon" href="/images/logo.svg?v=7.4.1" color="#222"><link rel="alternate" href="/atom.xml" title="Sidney God" type="application/atom+xml"><link rel="stylesheet" href="/css/main.css?v=7.4.1"><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.7.0"><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Gemini",version:"7.4.1",exturl:!1,sidebar:{position:"left",display:"post",offset:12,onmobile:!1},copycode:{enable:!0,show_result:!0,style:"flat"},back2top:{enable:!0,sidebar:!0,scrollpercent:!0},bookmark:{enable:!0,color:"#222",save:"auto"},fancybox:!0,mediumzoom:!0,lazyload:!0,pangu:!1,algolia:{appID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},path:"search.xml",motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},translation:{copy_button:"Copy",copy_success:"Copied",copy_failure:"Copy failed"},sidebarPadding:40}</script><meta name="description" content="参考：https:&#x2F;&#x2F;www.cnblogs.com&#x2F;opsprobe&#x2F;p&#x2F;9420502.htmlhttps:&#x2F;&#x2F;blog.csdn.net&#x2F;lassewang&#x2F;article&#x2F;details&#x2F;91595430 RADIUSRADIUS：（Remote Authentication Dial In User Service）中文名为远程用户拨号认证服务，简称RADIUS，是目前应用最广泛的AAA"><meta property="og:type" content="article"><meta property="og:title" content="Build FreeRADIUS server based on Ubuntu18"><meta property="og:url" content="https://sidneygod.github.io/posts/cb75f049/index.html"><meta property="og:site_name" content="Sidney God"><meta property="og:description" content="参考：https:&#x2F;&#x2F;www.cnblogs.com&#x2F;opsprobe&#x2F;p&#x2F;9420502.htmlhttps:&#x2F;&#x2F;blog.csdn.net&#x2F;lassewang&#x2F;article&#x2F;details&#x2F;91595430 RADIUSRADIUS：（Remote Authentication Dial In User Service）中文名为远程用户拨号认证服务，简称RADIUS，是目前应用最广泛的AAA"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://sidneygod.github.io/posts/cb75f049/assets/Build-FreeRADIUS-server-based-on-Ubuntu18/202205243456723.png"><meta property="og:image" content="https://sidneygod.github.io/posts/cb75f049/assets/Build-FreeRADIUS-server-based-on-Ubuntu18/image-20200822142751997.png"><meta property="og:image" content="https://sidneygod.github.io/posts/cb75f049/assets/Build-FreeRADIUS-server-based-on-Ubuntu18/NTRadPing_Test.jpg"><meta property="article:published_time" content="2020-08-22T14:46:36.000Z"><meta property="article:modified_time" content="2022-05-24T15:03:42.879Z"><meta property="article:author" content="Sidney Ding"><meta property="article:tag" content="freeradius"><meta property="article:tag" content="radius"><meta property="article:tag" content="daloradius"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://sidneygod.github.io/posts/cb75f049/assets/Build-FreeRADIUS-server-based-on-Ubuntu18/202205243456723.png"><link rel="canonical" href="https://sidneygod.github.io/posts/cb75f049/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0,isPage:!1,isArchive:!1}</script><title>Build FreeRADIUS server based on Ubuntu18 | Sidney God</title><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .logo,.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript></head><body itemscope itemtype="http://schema.org/WebPage" lang="en"><div class="container use-motion"><div class="headband"></div><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-meta"><div><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">Sidney God</span> <span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle">Keep quiet time for time</p></div><div class="site-nav-toggle"><div class="toggle" aria-label="Toggle navigation bar"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-fw fa-home"></i>Home</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>About</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>Tags<span class="badge">18</span></a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>Categories<span class="badge">6</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>Archives<span class="badge">23</span></a></li><li class="menu-item menu-item-resources"><a href="/resources/" rel="section"><i class="fa fa-fw fa-book"></i>Resources</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search</a></li></ul></nav><div class="site-search"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"><input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="Searching..." spellcheck="false" type="text" id="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"></div></div><div class="search-pop-overlay"></div></div></div></header><div class="reading-progress-bar"></div><a class="book-mark-link book-mark-link-fixed" href="#"></a> <a href="https://github.com/SidneyGod" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article itemscope itemtype="http://schema.org/Article"><div class="post-block post"><link itemprop="mainEntityOfPage" href="https://sidneygod.github.io/posts/cb75f049/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="Sidney Ding"><meta itemprop="description" content="You laugh at me for being different, but I laugh at you for being the same."><meta itemprop="image" content="/images/avatar.png"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Sidney God"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">Build FreeRADIUS server based on Ubuntu18</h1><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">Posted on</span> <time title="Created: 2020-08-22 22:46:36" itemprop="dateCreated datePublished" datetime="2020-08-22T22:46:36+08:00">2020-08-22</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i> </span><span class="post-meta-item-text">Edited on</span> <time title="Modified: 2022-05-24 23:03:42" itemprop="dateModified" datetime="2022-05-24T23:03:42+08:00">2022-05-24</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span class="post-meta-item-text">In</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Other/" itemprop="url" rel="index"><span itemprop="name">Other</span></a></span> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-comment-o"></i> </span><span class="post-meta-item-text">Valine: </span><a title="valine" href="/posts/cb75f049/#comments" itemprop="discussionUrl"><span class="post-comments-count valine-comment-count" data-xid="/posts/cb75f049/" itemprop="commentCount"></span></a></span><br><span class="post-meta-item" title="Symbols count in article"><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i> </span><span class="post-meta-item-text">Symbols count in article: </span><span>13k</span> </span><span class="post-meta-item" title="Reading time"><span class="post-meta-item-icon"><i class="fa fa-clock-o"></i> </span><span class="post-meta-item-text">Reading time &asymp;</span> <span>22 mins.</span></span></div></header><div class="post-body" itemprop="articleBody"><html><head></head><body><p>参考：</p><p><a href="https://www.cnblogs.com/opsprobe/p/9420502.html" target="_blank" rel="noopener">https://www.cnblogs.com/opsprobe/p/9420502.html</a></p><p><a href="https://blog.csdn.net/lassewang/article/details/9159543" target="_blank" rel="noopener">https://blog.csdn.net/lassewang/article/details/9159543</a></p><h1 id="0-RADIUS"><a href="#0-RADIUS" class="headerlink" title="0 RADIUS"></a>0 RADIUS</h1><p>RADIUS：（Remote Authentication Dial In User Service）中文名为远程用户拨号认证服务，简称RADIUS，是目前应用最广泛的AAA协议（认证、授权和计费）</p><p><img alt="202205243456723" data-src="assets/Build-FreeRADIUS-server-based-on-Ubuntu18/202205243456723.png"></p><p>图中Device（例如交换机）向远程接入用户提供接入及与RADIUS服务器交互的服务。RADIUS服务器上则存储用户的身份信息、授权信息以及访问记录，对用户进行认证、授权和计费服务</p><p><strong>认证过程如下</strong></p><p>（1）客户端向接入设备发送一个EAPoL-Start报文，开始802.1x认证接入；</p><p>（2）接入设备向客户端发送EAP-Request/Identity报文，要求客户端将用户名送上来；</p><a id="more"></a><p>（3）客户端回应一个EAP-Response/Identity给接入设备的请求，其中包括用户名；</p><p>（4）接入设备将EAP-Response/Identity报文封装到RADIUS Access-Request报文中，发送给认证服务器；</p><p>（5）认证服务器产生一个Challenge，通过接入设备将RADIUS Access-Challenge报文发送给客户端，其中包含有EAP-Request/MD5-Challenge；</p><p>（6）接入设备通过EAP-Request/MD5-Challenge发送给客户端，要求客户端进行认证；</p><p>（7）客户端收到EAP-Request/MD5-Challenge报文后，将密码和Challenge做MD5算法后的Challenged-Pass-word，在EAP-Response/MD5-Challenge回应给接入设备；</p><p>（8）接入设备将Challenge，Challenged Password和用户名一起送到RADIUS服务器，由RADIUS服务器进行认证；</p><p>（9）RADIUS服务器根据用户信息，做MD5算法，判断用户是否合法，然后回应认证成功/失败报文到接入设备。如果成功，携带协商参数，以及用户的相关业务属性给用户授权。如果认证失败，则流程到此结束；</p><p>（10）如果认证通过，用户通过标准的DHCP协议 (可以是DHCP Relay) ，通过接入设备获取规划的IP地址；</p><p>（11）如果认证通过，接入设备发起计费开始请求给RADIUS用户认证服务器；</p><p>（12）RADIUS用户认证服务器回应计费开始请求报文，用户上线完毕。</p><p>freeradius是GNU/GPL（通用公共许可证）的原则下，开发的高性能开源radius服务器。常见的radius服务器种类不多，比较强大的当属开源的freeradius，世界上大部分的radius服务器都是基于freeradius开发而来的。</p><p>freeradius可以对支持radius协议的网络设备进行账户认证、授权和记账管理，常见的开源路由器操作系统：如Openwrt，DD-wrt等，都支持radius协议，常见的电信运营商的宽带账户，上网账户管理，记账，也都是使用的radius服务器进行鉴权记账的。</p><p>RADIUS服务器和NAS服务器通过UDP协议进行通信，RADIUS服务器的1812端口负责认证，1813端口负责计费工作。采用UDP的基本考虑是因为NAS和RADIUS服务器大多在同一个局域网中，使用UDP更加快捷方便，而且UDP是无连接的，会减轻RADIUS的压力，也更安全。</p><p>以下均在Ubuntu18上操作的，Ubuntu16上坑太多..看网上教程，CentOS更多..</p><h1 id="1-安装Apache-Web-Server和PHP"><a href="#1-安装Apache-Web-Server和PHP" class="headerlink" title="1 安装Apache Web Server和PHP"></a>1 安装Apache Web Server和PHP</h1><p>在Ubuntu上安装Apache，运行以下命令安装Apache Web服务器：</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install apache2</span><br></pre></td></tr></tbody></table></figure><p>要在Ubuntu 18.04上安装PHP，请运行(<strong>直接运行可能会不成功，因为没这个源</strong>)</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install php libapache2-mod-php php-gd php-common php-mail \</span><br><span class="line">    php-mail-mime php-mysql php-pear php-db php-mbstring php-xml php-curl</span><br></pre></td></tr></tbody></table></figure><p>PHP安装：</p><p>1 添加PHP PPA</p><p>添加ondrej/php，它包含PHP包和其他必需的PHP扩展</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install software-properties-common</span><br><span class="line">sudo add-apt-repository ppa:ondrej/php</span><br><span class="line">sudo apt-get update</span><br></pre></td></tr></tbody></table></figure><p>通过复制以下代码并将其添加到系统的软件源中，可以手动将此PPA添加到系统中</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Ubuntu 18.04 拷贝</span></span><br><span class="line">deb http://ppa.launchpad.net/ondrej/php/ubuntu bionic main </span><br><span class="line">deb-src http://ppa.launchpad.net/ondrej/php/ubuntu bionic main</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加源</span></span><br><span class="line">sudo vim /etc/apt/sources.list</span><br><span class="line">sudo apt update &amp;&amp; sudo apt upgrade</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装PHP</span></span><br><span class="line">sudo apt-get install php libapache2-mod-php php-gd php-common php-mail \</span><br><span class="line">    php-mail-mime php-mysql php-pear php-db php-mbstring php-xml php-curl</span><br><span class="line"></span><br><span class="line"><span class="comment"># 验证</span></span><br><span class="line">php -v</span><br></pre></td></tr></tbody></table></figure><h1 id="2-安装MariaDB并创建数据库"><a href="#2-安装MariaDB并创建数据库" class="headerlink" title="2 安装MariaDB并创建数据库"></a>2 安装MariaDB并创建数据库</h1><p>MariaDB是MySQL的一个分支，目前最新稳定版是10.5，以下是安装步骤</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装software-properties-common</span></span><br><span class="line">sudo apt-get install software-properties-common</span><br><span class="line"><span class="comment"># 导入MariaDB gpg密钥</span></span><br><span class="line">ssudo apt-key adv --fetch-keys <span class="string">'https://mariadb.org/mariadb_release_signing_key.asc'</span></span><br><span class="line"><span class="comment"># 添加apt存储库</span></span><br><span class="line">sudo add-apt-repository <span class="string">'deb [arch=amd64,arm64,ppc64el] https://mirrors.tuna.tsinghua.edu.cn/mariadb/repo/10.5/ubuntu bionic main'</span></span><br><span class="line"><span class="comment"># 安装MariaDB Server</span></span><br><span class="line">sudo apt update</span><br><span class="line">sudo apt -y install mariadb-server mariadb-client</span><br></pre></td></tr></tbody></table></figure><p>安装并运行后，为FreeRADIUS创建一个数据库，这将在稍后阶段使用：</p><p>数据库名称：radius</p><p>数据库用户：radius</p><p>数据库用户密码：radiuspassword</p><p>如果你有专用数据库服务器，请将localhost替换为源FreeRadius服务器的IP：</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 第一次使用，初始化MariaDB</span></span><br><span class="line">sudo mysql_secure_installation</span><br><span class="line"><span class="comment"># 大致会经历这几个阶段</span></span><br><span class="line">Switch to unix_socket authentication [Y/n] &gt;&gt; [直接Enter] 切换到unix_socket身份验证</span><br><span class="line">Change the root password? [Y/n] y</span><br><span class="line">New password: </span><br><span class="line">Re-enter new password:</span><br><span class="line">Remove anonymous users? [Y/n] &gt;&gt; [直接Enter] 是否删除匿名用户</span><br><span class="line">Disallow root login remotely? [Y/n]  &gt;&gt; [直接Enter] 禁止远程root角色登录</span><br><span class="line">Remove <span class="built_in">test</span> database and access to it? [Y/n] &gt;&gt; [直接Enter] 是否删除<span class="built_in">test</span>数据库</span><br><span class="line">Reload privilege tables now? [Y/n] &gt;&gt; [直接Enter] 是否重新加载权限表</span><br><span class="line"></span><br><span class="line"><span class="comment"># 登录</span></span><br><span class="line">mysql -u root -p</span><br><span class="line"><span class="comment"># 输入密码 登录成功后在MariaDB中创建数据库</span></span><br><span class="line">CREATE DATABASE radius;</span><br><span class="line"><span class="comment"># 设置通过root:password可以在任何PC上访问数据库 方便其他电脑上用navicat或datagrip</span></span><br><span class="line">GRANT ALL ON *.* TO <span class="string">'root'</span>@<span class="string">'%'</span> IDENTIFIED BY <span class="string">"password"</span>;</span><br><span class="line"><span class="comment"># 设置通过 radius:radiuspassword 访问radius数据库</span></span><br><span class="line">GRANT ALL ON radius.* TO <span class="string">'radius'</span>@<span class="string">'localhost'</span> IDENTIFIED BY <span class="string">"radiuspassword"</span>;</span><br><span class="line"><span class="comment"># 重新载入权限</span></span><br><span class="line">flush privileges;</span><br><span class="line"><span class="comment"># 退出MariaDB</span></span><br><span class="line">\q</span><br></pre></td></tr></tbody></table></figure><blockquote><p>完全卸载MySQL/MariaDB</p><p>首先删除mysql:<br><code>sudo apt-get remove mysql-*</code><br>然后清理残留的数据<br><code>dpkg -l |grep ^rc|awk '{print $2}' |sudo xargs dpkg -P</code></p><ul><li>查看状态 <code>sudo systemctl status mysql</code></li><li>启动 <code>sudo systemctl start mysql</code></li><li>重启 <code>sudo systemctl restart mysql</code></li><li>关闭 <code>sudo systemctl stop mysql</code></li></ul></blockquote><h1 id="3-安装和配置FreeRADIUS"><a href="#3-安装和配置FreeRADIUS" class="headerlink" title="3 安装和配置FreeRADIUS"></a>3 安装和配置FreeRADIUS</h1><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在Ubuntu 18.04上安装的FreeRADIUS版本是v3.0，使用以下命令从官方Ubuntu apt存储库安装</span></span><br><span class="line">sudo apt-get install freeradius freeradius-mysql freeradius-utils</span><br><span class="line"><span class="comment"># 检测是否安装成功</span></span><br><span class="line">ps -ef | grep freeradius</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看普通用户是否有读取文件权限</span></span><br><span class="line">ll /etc/freeradius/3.0/mods-config/sql/main/mysql/schema.sql</span><br><span class="line"><span class="comment"># 改权限</span></span><br><span class="line">sudo chmod 666 /etc/freeradius/3.0/mods-config/sql/main/mysql/schema.sql</span><br><span class="line"><span class="comment"># 导入freeradius MySQL数据库方案</span></span><br><span class="line">mysql -u root -p radius &lt; /etc/freeradius/3.0/mods-config/sql/main/mysql/schema.sql</span><br><span class="line"><span class="comment"># 查看创建的表</span></span><br><span class="line">mysql -u root -p -e <span class="string">"use radius; show tables;"</span></span><br><span class="line">+------------------+</span><br><span class="line">| Tables_in_radius |</span><br><span class="line">+------------------+</span><br><span class="line">| nas              |</span><br><span class="line">| radacct          |</span><br><span class="line">| radcheck         |</span><br><span class="line">| radgroupcheck    |</span><br><span class="line">| radgroupreply    |</span><br><span class="line">| radpostauth      |</span><br><span class="line">| radreply         |</span><br><span class="line">| radusergroup     |</span><br><span class="line">+------------------+</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在/etc/freeradius/3.0/mods-enabled/下为sql模块创建一个软链接</span></span><br><span class="line">sudo ln -s /etc/freeradius/3.0/mods-available/sql /etc/freeradius/3.0/mods-enabled/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置SQL模块并更改数据库连接参数以适合你的环境</span></span><br><span class="line">sudo vim /etc/freeradius/3.0/mods-enabled/sql</span><br><span class="line">   <span class="comment"># 修改</span></span><br><span class="line">    sql {</span><br><span class="line">        driver = <span class="string">"rlm_sql_mysql"</span></span><br><span class="line">        dialect = <span class="string">"mysql"</span></span><br><span class="line">        <span class="comment"># Connection info:</span></span><br><span class="line">        server = <span class="string">"localhost"</span></span><br><span class="line">        port = 3306</span><br><span class="line">        login = <span class="string">"radius"</span></span><br><span class="line">        password = <span class="string">"radiuspassword"</span></span><br><span class="line">        <span class="comment"># Database table configuration for everything except Oracle</span></span><br><span class="line">        radius_db = <span class="string">"radius"</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># Set to ‘yes’ to read radius clients from the database (‘nas’ table)</span></span><br><span class="line">        <span class="comment"># Clients will ONLY be read on server startup.</span></span><br><span class="line">        read_clients = yes</span><br><span class="line">        <span class="comment"># Table to keep radius client info</span></span><br><span class="line">        client_table = <span class="string">"nas"</span></span><br><span class="line">    }</span><br><span class="line"><span class="comment"># 更改/etc/freeradius/3.0/mods-enabled/sql的组权限</span></span><br><span class="line">sudo chgrp -h freerad /etc/freeradius/3.0/mods-available/sql</span><br><span class="line">sudo chown -R freerad:freerad /etc/freeradius/3.0/mods-enabled/sql</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启freeradius服务</span></span><br><span class="line">sudo systemctl restart freeradius.service</span><br></pre></td></tr></tbody></table></figure><h1 id="4-安装和配置Daloradius"><a href="#4-安装和配置Daloradius" class="headerlink" title="4 安装和配置Daloradius"></a>4 安装和配置Daloradius</h1><p>我们需要安装Daloradius才能获得FreeRADIUS Web管理界面</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下载Daloradius</span></span><br><span class="line">wget https://github.com/lirantal/daloradius/archive/master.zip</span><br><span class="line">unzip master.zip</span><br><span class="line">mv daloradius-master/ daloradius</span><br><span class="line"><span class="built_in">cd</span> daloradius</span><br><span class="line"><span class="comment"># 配置daloradius，现在导入Daloradius mysql表</span></span><br><span class="line">mysql -u root -p radius &lt; contrib/db/fr2-mysql-daloradius-and-freeradius.sql</span><br><span class="line">mysql -u root -p radius &lt; contrib/db/mysql-daloradius.sql</span><br><span class="line"><span class="comment"># 配置daloRADIUS数据库连接详细信息</span></span><br><span class="line"><span class="built_in">cd</span> ..</span><br><span class="line">sudo mv daloradius /var/www/html/</span><br><span class="line"><span class="comment"># 更改http文件夹的权限并为daloradius配置文件设置正确的权限</span></span><br><span class="line">sudo chown -R www-data:www-data /var/www/html/daloradius/</span><br><span class="line">sudo chmod 664 /var/www/html/daloradius/library/daloradius.conf.php</span><br><span class="line"><span class="comment"># 修改filedaloradius.conf.php以调整数据库信息 对应/etc/freeradius/3.0/mods-enabled/sql</span></span><br><span class="line">sudo vim /var/www/html/daloradius/library/daloradius.conf.php</span><br><span class="line">    <span class="comment"># 主要是</span></span><br><span class="line">    CONFIG_DB_USER</span><br><span class="line">    CONFIG_DB_PASS</span><br><span class="line">    CONFIG_DB_NAME</span><br><span class="line"><span class="comment"># 重新启动freeradius和apache2</span></span><br><span class="line">systemctl restart freeradius apache2</span><br></pre></td></tr></tbody></table></figure><p>打开浏览器，访问<strong><code>http://ip-address/daloradius/login.php</code></strong></p><p><img alt="image-20200822142751997" data-src="assets/Build-FreeRADIUS-server-based-on-Ubuntu18/image-20200822142751997.png"></p><p>默认的管理员账户密码是 administrator:radius</p><blockquote><p>查看syslog和daloradius.log时，可能会报错，修改syslog权限为644即可，加到用户组或许效果更好；至于daloradius.log去Config&gt;Logging Settings中把想要监听的log设置成yes就好了</p></blockquote><h1 id="5-修改FreeRADIUS测试账户"><a href="#5-修改FreeRADIUS测试账户" class="headerlink" title="5 修改FreeRADIUS测试账户"></a>5 修改FreeRADIUS测试账户</h1><p>FreeRADIUS的配置默认是文件，打开测试账户</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/freeradius/3.0/users</span><br><span class="line">    <span class="comment"># 找到下面这段信息 注释全打开</span></span><br><span class="line">    73     steve   Cleartext-Password := <span class="string">"testing"</span></span><br><span class="line">    74     Service-Type = Framed-User,</span><br><span class="line">    75     Framed-Protocol = PPP,</span><br><span class="line">    76     Framed-IP-Address = 172.16.3.33,</span><br><span class="line">    77     Framed-IP-Netmask = 255.255.255.0,</span><br><span class="line">    78     Framed-Routing = Broadcast-Listen,</span><br><span class="line">    79     Framed-Filter-Id = <span class="string">"std.ppp"</span>,</span><br><span class="line">    80     Framed-MTU = 1500,</span><br><span class="line">    81     Framed-Compression = Van-Jacobsen-TCP-IP</span><br></pre></td></tr></tbody></table></figure><p>配置路由器或交换机的账号</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/freeradius/3.0/clients.conf</span><br><span class="line">    <span class="comment"># 按照这个格式 里面有个localhost 用作本机测试的</span></span><br><span class="line">    client x.x.x.x {  <span class="comment"># 路由器或交换机的ip</span></span><br><span class="line">        ipaddr = x.x.x.x  <span class="comment"># 路由器或交换机的ip</span></span><br><span class="line">        secret = xxxxx  <span class="comment"># 路由器或交换机访问radius的密码</span></span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure><p>重新开一终端</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 修改了配置文件 需要重启一下服务</span></span><br><span class="line">service freeradius restart</span><br><span class="line"><span class="comment"># 测试账户 接收到 Received Access-Accept 就表示没问题了</span></span><br><span class="line">radtest steve testing localhost 1812 testing123</span><br><span class="line"><span class="comment"># radtest 账号 密码 client_ip radius端口 client_secret</span></span><br></pre></td></tr></tbody></table></figure><p>这也确实，表明FreeRADIUS是通过文件进行配置的，接下来将其改为sql模式，上面改得差不多了，再改俩就行</p><p>修改配置文件<code>/etc/freeradius/3.0/sites-enabled/default</code></p><p>1 找到<code>authorize {</code>(273行)，注释其中的<code>files</code>，并将<code>sql</code>去掉注释或<code>-</code></p><p>2 找到<code>preacct {</code>(555行)，注释其中的<code>files</code></p><p>3 找到<code>accounting {</code>(608行)，去掉<code>sql</code>的注释或<code>-</code></p><p>4 找到<code>session {</code>(677行)，去掉<code>sql</code>的注释或<code>-</code></p><p>5 找到<code>post-auth {</code>(689行)，去掉<code>sql</code>的注释或<code>-</code></p><p>6 找到<code>pre-proxy {</code>(861行)，注释掉<code>files</code></p><p>修改配置文件<code>/etc/freeradius/3.0/sites-enabled/inner-tunnel</code>，和上面一样，注释掉<code>files</code>，去掉<code>sql</code>的注释或<code>-</code></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 重启一下相关的服务</span></span><br><span class="line">service mysql restart</span><br><span class="line">service apache2 restart</span><br><span class="line">service freeradius restart</span><br></pre></td></tr></tbody></table></figure><hr><p>下面进行测试，直接进入MySQL可以通过Navicat或者直接终端(<code>mysql -u root -p; use radius;</code>)，输入下面的sql语句</p><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建用户组</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> radius.radgroupreply (groupname, <span class="keyword">attribute</span>, op, <span class="string">`value`</span>) <span class="keyword">VALUES</span> (<span class="string">'locahost'</span>, <span class="string">'Service-Type'</span>, <span class="string">':='</span>, <span class="string">'Framed-User'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> radius.radgroupreply (groupname, <span class="keyword">attribute</span>, op, <span class="string">`value`</span>) <span class="keyword">VALUES</span> (<span class="string">'locahost'</span>, <span class="string">'Framed-Protocol'</span>, <span class="string">':='</span>, <span class="string">'PPP'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> radius.radgroupreply (groupname, <span class="keyword">attribute</span>, op, <span class="string">`value`</span>) <span class="keyword">VALUES</span> (<span class="string">'locahost'</span>, <span class="string">'Framed-IP-Address'</span>, <span class="string">':='</span>, <span class="string">'192.168.1.109'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> radius.radgroupreply (groupname, <span class="keyword">attribute</span>, op, <span class="string">`value`</span>) <span class="keyword">VALUES</span> (<span class="string">'locahost'</span>, <span class="string">'Framed-IP-Netmask'</span>, <span class="string">':='</span>, <span class="string">'255.255.255.0'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> radius.radgroupreply (groupname, <span class="keyword">attribute</span>, op, <span class="string">`value`</span>) <span class="keyword">VALUES</span> (<span class="string">'locahost'</span>, <span class="string">'Framed-Routing'</span>, <span class="string">':='</span>, <span class="string">'Broadcast-Listen'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> radius.radgroupreply (groupname, <span class="keyword">attribute</span>, op, <span class="string">`value`</span>) <span class="keyword">VALUES</span> (<span class="string">'locahost'</span>, <span class="string">'Framed-Filter-Id'</span>, <span class="string">':='</span>, <span class="string">'"std.ppp"'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> radius.radgroupreply (groupname, <span class="keyword">attribute</span>, op, <span class="string">`value`</span>) <span class="keyword">VALUES</span> (<span class="string">'locahost'</span>, <span class="string">'Framed-MTU'</span>, <span class="string">':='</span>, <span class="string">'1500'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> radius.radgroupreply (groupname, <span class="keyword">attribute</span>, op, <span class="string">`value`</span>) <span class="keyword">VALUES</span> (<span class="string">'locahost'</span>, <span class="string">'Framed-Compression'</span>, <span class="string">':='</span>, <span class="string">'Van-Jacobsen-TCP-IP'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建用户</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> radius.radcheck (username, <span class="keyword">attribute</span>, op, <span class="string">`value`</span>) <span class="keyword">VALUES</span> (<span class="string">'user1'</span>, <span class="string">'Cleartext-Password'</span>, <span class="string">'=='</span>, <span class="string">'password1'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将用户加入组</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> radius.radusergroup (username, groupname) <span class="keyword">VALUES</span> (<span class="string">'user1'</span>, <span class="string">'locahost'</span>);</span><br></pre></td></tr></tbody></table></figure><p>执行完之后，另打开一个终端进行本地测试</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 能接收到 Received Access-Accept 就表示没问题</span></span><br><span class="line">radtest user1 password1 localhost 1812 testing123</span><br></pre></td></tr></tbody></table></figure><p>由于没有路由器和交换机，就只能再开一个Win虚拟机，进行测试，首先向<code>/etc/freeradius/3.0/clients.conf</code>添加Win虚拟机的信息</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/freeradius/3.0/clients.conf</span><br><span class="line">    <span class="comment"># 按照这个格式 里面有个localhost 用作本机测试的</span></span><br><span class="line">    client 192.168.1.109 {  <span class="comment"># Win虚拟机ip</span></span><br><span class="line">        ipaddr = 192.168.1.109  <span class="comment"># Win虚拟机ip</span></span><br><span class="line">        secret = justpwd  <span class="comment"># Win虚拟机访问radius的密码</span></span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure><p>好了，这时候，Win虚拟机上需要一个软件，NTRadPing，测试手法如下</p><p>天翼云：<a href="https://cloud.189.cn/t/AFJnYfy6Jbq2（访问码：kb1q）" target="_blank" rel="noopener">https://cloud.189.cn/t/AFJnYfy6Jbq2（访问码：kb1q）</a></p><p>蓝奏云：<a href="https://sidneygod.lanzous.com/iHcxEfxkqgf" target="_blank" rel="noopener">https://sidneygod.lanzous.com/iHcxEfxkqgf</a></p><p><img alt="NTRadPing_Test" data-src="assets/Build-FreeRADIUS-server-based-on-Ubuntu18/NTRadPing_Test.jpg"></p><p>RADIUS Server/port就填安装freeradius的ip和freeradius的默认端口1812</p><p>Reply timeout这一行就这样</p><p>RADIUS Secret key就是上面配置的secret值</p><p>User-Name和Password还是之前的user1和password1</p><p>其余不用管，点击send，右侧就会得到服务器返回的数据</p><hr><p>毕竟我们有前端页面了，所以添加用户组和用户什么的，肯定不用手动去输MySQL语句，不友好。</p><p>添加用户组：Management &gt; Profiles</p><p>添加用户：Management &gt; Users</p><p>其实这些页面应该对应着数据库的操作..没咋研究，但是像client似乎比如通过配置文件，毕竟路由器没那么多吧..</p><p>还有，关于路由器和交换机的配置，由于手头没设备，没法玩..看教程，tplink的wap2能设置radius服务器信息</p><h1 id="6-拾遗"><a href="#6-拾遗" class="headerlink" title="6 拾遗"></a>6 拾遗</h1><h2 id="6-1-环境问题"><a href="#6-1-环境问题" class="headerlink" title="6.1 环境问题"></a>6.1 环境问题</h2><p>用Ubuntu16搞了一上午，php和MariaDB都不行，然后果断选择Ubuntu18，基本上没出啥错，哦，用的是清华源，不知道和这个有没有关系，本来觉得阿里源挺好，但是16上用的就是，想着换一下..</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 备份</span></span><br><span class="line">sudo cp /etc/apt/sources.list /etc/apt/sources.list.bak</span><br><span class="line"><span class="comment"># 把里面内容全换了</span></span><br><span class="line">sudo gedit /etc/apt/sources.list</span><br><span class="line"></span><br><span class="line"><span class="comment"># 清华源</span></span><br><span class="line">deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic main restricted universe multiverse</span><br><span class="line">deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic main restricted universe multiverse</span><br><span class="line">deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-updates main restricted universe multiverse</span><br><span class="line">deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-updates main restricted universe multiverse</span><br><span class="line">deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-backports main restricted universe multiverse</span><br><span class="line">deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-backports main restricted universe multiverse</span><br><span class="line">deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-security main restricted universe multiverse</span><br><span class="line">deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-security main restricted universe multiverse</span><br><span class="line">deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-proposed main restricted universe multiverse</span><br><span class="line">deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-proposed main restricted universe multiverse</span><br><span class="line"></span><br><span class="line"><span class="comment"># 完了之后记得更新源</span></span><br><span class="line">sudo apt-get update &amp;&amp; sudo apt upgrade</span><br></pre></td></tr></tbody></table></figure><h2 id="6-1-重启服务报错"><a href="#6-1-重启服务报错" class="headerlink" title="6.1 重启服务报错"></a>6.1 重启服务报错</h2><p>用systemctl或者service进行重启freeradius时，有时候会报错，说启动不了。大概长这样子</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Job <span class="keyword">for</span> freeradius.service failed because the control process exited with error code.</span><br><span class="line">See <span class="string">"systemctl status freeradius.service"</span> and <span class="string">"journalctl -xe"</span> <span class="keyword">for</span> details.</span><br></pre></td></tr></tbody></table></figure><p><strong>直接reboot就好</strong>，当然了，实在启动不了，也可以执行<code>sudo freeradius -X</code>，可以看到调试信息</p><h2 id="6-1-关于log"><a href="#6-1-关于log" class="headerlink" title="6.1 关于log"></a>6.1 关于log</h2><p>daloradius有个Reports模块，默认显示四种log：daloRADIUS Log，Radius Log，System Log，Boot Log。其中前俩正常，就是后俩，syslog有这个文件，但是没权限；Boot Log显示的是dmesg，但Ubuntu18上却不是<code>/var/log/dmesg</code>这个文件，而是<code>/var/log/kern.log</code></p><p>于是，修改文件：<code>/var/www/html/daloradius/library/exten-boot_log.php</code>，加三句话</p><figure class="highlight diff"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$logfile_loc1 = '/var/log/dmesg';</span><br><span class="line">$logfile_loc2 = '/usr/local/var/log/dmesg';</span><br><span class="line"><span class="addition">+ $logfile_loc3 = '/var/log/kern.log';</span></span><br><span class="line"> </span><br><span class="line">if (file_exists($logfile_loc1))</span><br><span class="line">    $logfile = $logfile_loc1;</span><br><span class="line">else if (file_exists($logfile_loc2))</span><br><span class="line">    $logfile = $logfile_loc2;</span><br><span class="line"><span class="addition">+ else if (file_exists($logfile_loc3))</span></span><br><span class="line"><span class="addition">+     $logfile = $logfile_loc3;</span></span><br><span class="line">else {</span><br></pre></td></tr></tbody></table></figure><p>但是呢，还是有权限问题，因为<code>syslog</code>和<code>kern.log</code>，要是把这俩文件权限改为644倒是没问题，问题是重启就又不行了。顺带一提，mysql，apache2，freeradius都是开机自启的。不是syslog用户或adm组是没有读文件权限的，于是就把<code>www-data</code>加到adm用户组了，问题解决</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo gpasswd -a www-data adm</span><br></pre></td></tr></tbody></table></figure><p>如果<code>/var/log/</code>下连syslog，kern.log..都没有，查看<code>/etc/rsyslog.d/50-default.conf</code>，是不是把那些log给禁用了，打开注释就好了</p><h2 id="6-1-证书配置"><a href="#6-1-证书配置" class="headerlink" title="6.1 证书配置"></a>6.1 证书配置</h2><p>参考：<a href="https://blog.csdn.net/lassewang/article/details/9159543" target="_blank" rel="noopener">https://blog.csdn.net/lassewang/article/details/9159543</a></p></body></html></div><div style="text-align:center;color:#636363;font-size:14px">------- This article is over <i class="fa fa-leaf" aria-hidden="true"></i> Thank you for your reading -------</div><div id="reward-container"><div>All I need is you needing me.</div><button id="reward-button" disable="enable" onclick="var qr = document.getElementById(&quot;qr&quot;); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">Donate</button><div id="qr" style="display:none"><div style="display:inline-block"><img src="/images/wechatpay.png" alt="Sidney Ding WeChat Pay"><p>WeChat Pay</p></div><div style="display:inline-block"><img src="/images/alipay.jpg" alt="Sidney Ding Alipay"><p>Alipay</p></div></div></div><div><ul class="post-copyright"><li class="post-copyright-author"><strong>Post author: </strong>Sidney Ding</li><li class="post-copyright-link"><strong>Post link: </strong><a href="https://sidneygod.github.io/posts/cb75f049/" title="Build FreeRADIUS server based on Ubuntu18">https://sidneygod.github.io/posts/cb75f049/</a></li><li class="post-copyright-license"><strong>Copyright Notice: </strong>All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i>BY-NC-SA</a> unless stating additionally.</li></ul></div><footer class="post-footer"><div class="post-tags"><a href="/tags/freeradius/" rel="tag"><i class="fa fa-tag"></i> freeradius</a> <a href="/tags/radius/" rel="tag"><i class="fa fa-tag"></i> radius</a> <a href="/tags/daloradius/" rel="tag"><i class="fa fa-tag"></i> daloradius</a></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/posts/4163f7c1/" rel="next" title="[Relearning C/Cpp] Statements and Preprocessor"><i class="fa fa-chevron-left"></i> [Relearning C/Cpp] Statements and Preprocessor</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"><a href="/posts/5d13faf3/" rel="prev" title="Build a leanote server">Build a leanote server <i class="fa fa-chevron-right"></i></a></div></div></footer></div></article></div></div><div class="comments" id="comments"></div></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc">Catalogue</li><li class="sidebar-nav-overview">Overview</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#0-RADIUS"><span class="nav-text">0 RADIUS</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#1-安装Apache-Web-Server和PHP"><span class="nav-text">1 安装Apache Web Server和PHP</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2-安装MariaDB并创建数据库"><span class="nav-text">2 安装MariaDB并创建数据库</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#3-安装和配置FreeRADIUS"><span class="nav-text">3 安装和配置FreeRADIUS</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#4-安装和配置Daloradius"><span class="nav-text">4 安装和配置Daloradius</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#5-修改FreeRADIUS测试账户"><span class="nav-text">5 修改FreeRADIUS测试账户</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#6-拾遗"><span class="nav-text">6 拾遗</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#6-1-环境问题"><span class="nav-text">6.1 环境问题</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-1-重启服务报错"><span class="nav-text">6.1 重启服务报错</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-1-关于log"><span class="nav-text">6.1 关于log</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-1-证书配置"><span class="nav-text">6.1 证书配置</span></a></li></ol></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><a href="#"><img class="site-author-image" itemprop="image" src="/images/avatar.png" alt="Sidney Ding"></a><p class="site-author-name" itemprop="name">Sidney Ding</p><div class="site-description" itemprop="description">You laugh at me for being different, but I laugh at you for being the same.</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"><a href="/archives"><span class="site-state-item-count">23</span> <span class="site-state-item-name">posts</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/"><span class="site-state-item-count">6</span> <span class="site-state-item-name">categories</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/"><span class="site-state-item-count">18</span> <span class="site-state-item-name">tags</span></a></div></nav></div><div class="feed-link motion-element"><a href="/atom.xml" rel="alternate"><i class="fa fa-rss"></i>RSS</a></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/SidneyGod" title="GitHub &amp;rarr; https:&#x2F;&#x2F;github.com&#x2F;SidneyGod" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a> </span><span class="links-of-author-item"><a href="mailto:sidneyding183@gmail.com" title="E-Mail &amp;rarr; mailto:sidneyding183@gmail.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a></span></div><div class="cc-license motion-element" itemprop="license"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a></div><div class="links-of-blogroll motion-element"><div class="links-of-blogroll-title"><i class="fa fa-fw fa-link"></i> Links</div><ul class="links-of-blogroll-list"><li class="links-of-blogroll-item"><a href="https://google.com/" title="https:&#x2F;&#x2F;google.com" rel="noopener" target="_blank">Google</a></li><li class="links-of-blogroll-item"><a href="https://bing.com/" title="https:&#x2F;&#x2F;bing.com" rel="noopener" target="_blank">Bing</a></li></ul></div></div><div class="back-to-top motion-element"><i class="fa fa-arrow-up"></i> <span>0%</span></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright">&copy; 2019 – <span itemprop="copyrightYear">2022</span> <span class="with-love" id="animate"><i class="fa fa-heart"></i> </span><span class="author" itemprop="copyrightHolder">Sidney Ding</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-area-chart"></i> </span><span class="post-meta-item-text">Symbols count total: </span><span title="Symbols count total">304k</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-coffee"></i> </span><span class="post-meta-item-text">Reading time total &asymp;</span> <span title="Reading time total">8:26</span></div><div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> v4.2.0</div><span class="post-meta-divider">|</span><div class="theme-info">Theme – <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> v7.4.1</div><div><span><i class="fa fa-bomb"></i> </span><span id="showDays"></span></div><script>var seconds=1e3,minutes=60*seconds,hours=60*minutes,days=24*hours,years=365*days,birthDay=Date.UTC(2019,10,1,0,0,0);setInterval(function(){var e=(n=new Date).getFullYear(),s=n.getMonth()+1,t=n.getDate(),a=n.getHours(),o=n.getMinutes(),n=n.getSeconds(),s=Date.UTC(e,s,t,a,o,n)-birthDay,t=Math.floor(s/years),a=Math.floor(s/days-365*t),o=Math.floor((s-(365*t+a)*days)/hours),n=Math.floor((s-(365*t+a)*days-o*hours)/minutes),s=Math.floor((s-(365*t+a)*days-o*hours-n*minutes)/seconds);document.getElementById("showDays").innerHTML="This website has been running for "+t+" years, "+a+" days, "+o+" hours, "+n+" minutes, "+s+" seconds"},1e3)</script></div></footer></div><script src="/lib/anime.min.js?v=3.1.0"></script><script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script><script src="//cdn.jsdelivr.net/npm/medium-zoom@1/dist/medium-zoom.min.js"></script><script src="//cdn.jsdelivr.net/npm/lozad@1/dist/lozad.min.js"></script><script src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script src="/js/utils.js?v=7.4.1.js"></script><script src="/js/motion.js?v=7.4.1.js"></script><script src="/js/schemes/pisces.js?v=7.4.1.js"></script><script src="/js/next-boot.js?v=7.4.1.js"></script><script src="/js/bookmark.js?v=7.4.1.js"></script><script defer src="//cdn.jsdelivr.net/gh/theme-next/theme-next-three@1/three.min.js"></script><script defer src="//cdn.jsdelivr.net/gh/theme-next/theme-next-three@latest/three-waves.min.js"></script><script src="/js/local-search.js?v=7.4.1.js"></script><script>document.querySelectorAll("div.pdf").length&&NexT.utils.getScript("//cdn.jsdelivr.net/npm/pdfobject@2/pdfobject.min.js",()=>{document.querySelectorAll("div.pdf").forEach(e=>{PDFObject.embed(e.getAttribute("target"),e,{pdfOpenParams:{navpanes:0,toolbar:0,statusbar:0,pagemode:"thumbs",view:"FitH"},PDFJS_URL:"/lib/pdf/web/viewer.html",height:e.getAttribute("height")||"500px"})})},window.PDFObject)</script><script>NexT.utils.getScript("//unpkg.com/valine/dist/Valine.min.js",()=>{var e=["nick","mail","link"],i="nick,mail,link".split(",").filter(i=>e.includes(i));new Valine({el:"#comments",verify:!0,notify:!1,appId:"IJiDbg4VAiIeDsIj4MBo39Hq-gzGzoHsz",appKey:"0osu23DWjzCzrIVH4Ybe3ihh",placeholder:"Just go go",avatar:"monsterid",meta:i,pageSize:"10",visitor:!1,lang:"en",path:location.pathname,recordIP:!0,serverURLs:""})},window.Valine)</script><script src="/js/snowflakes.min.js"></script><script>new Snowflakes({color:"rgba(129, 161, 193, 0.87)"})</script><script async src="/js/love.js"></script><script async src="/js/fireworks.js"></script><script>var titleTime,OriginTitile=document.title;document.addEventListener("visibilitychange",function(){document.hidden?(document.title="(つェ⊂) 我藏好了哦~"+OriginTitile,clearTimeout(titleTime)):(document.title="(*´∇｀*) 被你发现啦~"+OriginTitile,titleTime=setTimeout(function(){document.title=OriginTitile},2e3))})</script><script src="/js/activate-power-mode.min.js"></script><script>POWERMODE.colorful=!0,POWERMODE.shake=!0,document.body.addEventListener("input",POWERMODE)</script></body></html>