<!DOCTYPE html>





<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.ico?v=7.4.1">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico?v=7.4.1">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.ico?v=7.4.1">
  <link rel="mask-icon" href="/images/logo.svg?v=7.4.1" color="#222">
  <link rel="alternate" href="/atom.xml" title="Sidney God" type="application/atom+xml">

<link rel="stylesheet" href="/css/main.css?v=7.4.1">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.7.0">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '7.4.1',
    exturl: false,
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false},
    copycode: {"enable":true,"show_result":true,"style":"flat"},
    back2top: {"enable":true,"sidebar":true,"scrollpercent":true},
    bookmark: {"enable":true,"color":"#222","save":"auto"},
    fancybox: true,
    mediumzoom: true,
    lazyload: true,
    pangu: false,
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: 'search.xml',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: 'Copy',
      copy_success: 'Copied',
      copy_failure: 'Copy failed'
    },
    sidebarPadding: 40
  };
</script>

  <meta name="description" content="数组和指针一般不能分开，尤其是C语言里面，让人又爱又恨的东西..而一谈到这俩玩意就得画图.. 1 数组对数组下定义，抱歉，我不会。但是我有词典，a way of organizing and storing related data in a computer memory。这么一看就清晰多了 元素类型为char的数组可以如下声明 int c[6];  &#x2F;&#x2F; 可以存6个整数的数组 在声明中[]表示">
<meta property="og:type" content="article">
<meta property="og:title" content="[Relearning C&#x2F;Cpp] Array and Pointer">
<meta property="og:url" content="https://sidneygod.github.io/posts/61dcf29f/index.html">
<meta property="og:site_name" content="Sidney God">
<meta property="og:description" content="数组和指针一般不能分开，尤其是C语言里面，让人又爱又恨的东西..而一谈到这俩玩意就得画图.. 1 数组对数组下定义，抱歉，我不会。但是我有词典，a way of organizing and storing related data in a computer memory。这么一看就清晰多了 元素类型为char的数组可以如下声明 int c[6];  &#x2F;&#x2F; 可以存6个整数的数组 在声明中[]表示">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://gitee.com/SidneyGod/ImagePlace/raw/master/watch.webp">
<meta property="og:image" content="https://gitee.com/SidneyGod/ImagePlace/raw/master/pointer.svg">
<meta property="og:image" content="https://gitee.com/SidneyGod/ImagePlace/raw/master/struct_mem_20210418183714.svg">
<meta property="article:published_time" content="2021-04-17T07:47:30.000Z">
<meta property="article:modified_time" content="2021-04-26T14:54:34.271Z">
<meta property="article:author" content="Sidney Ding">
<meta property="article:tag" content="C">
<meta property="article:tag" content="Cpp">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://gitee.com/SidneyGod/ImagePlace/raw/master/watch.webp">
  <link rel="canonical" href="https://sidneygod.github.io/posts/61dcf29f/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true,
    isPage: false,
    isArchive: false
  };
</script>

  <title>[Relearning C/Cpp] Array and Pointer | Sidney God</title>
  








  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">
  <div class="container use-motion">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Sidney God</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">Keep quiet time for time</p>
      
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
      
      
      
        
        <li class="menu-item menu-item-home">
      
    
      
      
        
      
        
      
        
      
    

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>Home</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-about">
      
    
      
      
        
      
        
      
        
      
    

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>About</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-tags">
      
    
      
      
        
      
        
      
        
          
        
      
    

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>Tags<span class="badge">20</span></a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-categories">
      
    
      
      
        
      
        
          
        
      
        
      
    

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>Categories<span class="badge">4</span></a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-archives">
      
    
      
      
        
          
        
      
        
      
        
      
    

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>Archives<span class="badge">20</span></a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-commonweal">
      
    
      
      
        
      
        
      
        
      
    

    <a href="/404/" rel="section"><i class="fa fa-fw fa-heartbeat"></i>Commonweal 404</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-resources">
      
    
      
      
        
      
        
      
        
      
    

    <a href="/resources/" rel="section"><i class="fa fa-fw fa-book"></i>Resources</a>

  </li>
      <li class="menu-item menu-item-search">
        <a href="javascript:;" class="popup-trigger">
        
          <i class="fa fa-search fa-fw"></i>Search</a>
      </li>
    
  </ul>

</nav>
  <div class="site-search">
    <div class="popup search-popup">
    <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocorrect="off" autocapitalize="none"
           placeholder="Searching..." spellcheck="false"
           type="text" id="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result"></div>

</div>
<div class="search-pop-overlay"></div>

  </div>
</div>
    </header>

    
  <div class="reading-progress-bar"></div>
  <a class="book-mark-link book-mark-link-fixed" href="#"></a>

  <a href="https://github.com/SidneyGod" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
            

          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
      <article itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block post">
    <link itemprop="mainEntityOfPage" href="https://sidneygod.github.io/posts/61dcf29f/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Sidney Ding">
      <meta itemprop="description" content="You laugh at me for being different, but I laugh at you for being the same.">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sidney God">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">[Relearning C/Cpp] Array and Pointer

          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              
                
              

              <time title="Created: 2021-04-17 15:47:30" itemprop="dateCreated datePublished" datetime="2021-04-17T15:47:30+08:00">2021-04-17</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-04-26 22:54:34" itemprop="dateModified" datetime="2021-04-26T22:54:34+08:00">2021-04-26</time>
              </span>
            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/C-Cpp/" itemprop="url" rel="index"><span itemprop="name">C/Cpp</span></a></span>

                
                
              
            </span>
          

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
        
      
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/posts/61dcf29f/#comments" itemprop="discussionUrl"><span class="post-comments-count valine-comment-count" data-xid="/posts/61dcf29f/" itemprop="commentCount"></span></a>
  </span>
  
  
          <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
              
                <span class="post-meta-item-text">Symbols count in article: </span>
              
              <span>31k</span>
            </span>
          
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
              
                <span class="post-meta-item-text">Reading time &asymp;</span>
              
              <span>51 mins.</span>
            </span>
          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <html><head></head><body><p>数组和指针一般不能分开，尤其是C语言里面，让人又爱又恨的东西..而一谈到这俩玩意就得画图..</p>
<h1 id="1-数组"><a href="#1-数组" class="headerlink" title="1 数组"></a>1 数组</h1><p>对数组下定义，抱歉，我不会。但是我有词典，a way of organizing and storing related data in a computer memory。这么一看就清晰多了</p>
<p>元素类型为char的数组可以如下声明</p>
<p><code>int c[6];  // 可以存6个整数的数组</code></p>
<p>在声明中<code>[]</code>表示xxx的数组，所有数组下标都是从0开始，计算机中很多东西都是从0开始，为什么？搜索一下吧。数组的大小，就是那个6，必须得是个常量表达式，这么看，数组一旦定义好了大小就定下来了呀</p>
<p>数组名也是标识符，也要符合规则，不能和其他变量重名</p>
<p>数组初始化的时候可以部分初始化，也可以整体初始化；赋值的时候不能整体赋值，只能单个元素得赋值(数组拷贝，那个不算)</p>
<a id="more"></a>

<figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> arr[] = {<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>};  <span class="comment">// 这样就是整体初始化，可以不用写数组大小</span></span><br><span class="line"><span class="comment">// arr = {5, 4, 3, 2, 1};  // 不带这样的赋值</span></span><br><span class="line">arr[<span class="number">1</span>] = <span class="number">4</span>;  <span class="comment">// 只能单个赋值</span></span><br></pre></td></tr></tbody></table></figure>

<p>另外有一点就是大家常说的，数组是在内存里面开辟一块连续的空间</p>
<figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">int</span> arr[<span class="number">5</span>] = {<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>};</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i < <span class="number">5</span>; ++i) {</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"a[%d]'s addr is %p\n"</span>, i, &arr[i]);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br><span class="line"><span class="comment">/* output</span></span><br><span class="line"><span class="comment">a[0]'s addr is 000000000062FE00</span></span><br><span class="line"><span class="comment">a[1]'s addr is 000000000062FE04</span></span><br><span class="line"><span class="comment">a[2]'s addr is 000000000062FE08</span></span><br><span class="line"><span class="comment">a[3]'s addr is 000000000062FE0C</span></span><br><span class="line"><span class="comment">a[4]'s addr is 000000000062FE10</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></tbody></table></figure>

<p>可以看到都是4个4个往上加的连续地址</p>
<p>再说多维数组，多维数组给我们的直观感受是这样的</p>
<figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 比如这是个二维的，那就应该是个平面</span></span><br><span class="line"><span class="keyword">int</span> arr[<span class="number">2</span>][<span class="number">3</span>] = {</span><br><span class="line">    {<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>},</span><br><span class="line">    {<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>}</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure>

<p>但是显然内存不是个平面，还是个线性的</p>
<figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">int</span> arr[<span class="number">2</span>][<span class="number">3</span>] = {</span><br><span class="line">            {<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>},</span><br><span class="line">            {<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>}</span><br><span class="line">    };</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i < <span class="number">2</span>; ++i) {</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j < <span class="number">3</span>; ++j) {</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"a[%d][%d]'s addr is %p\n"</span>, i, j, &arr[i][j]);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br><span class="line"><span class="comment">/* output</span></span><br><span class="line"><span class="comment">a[0][0]'s addr is 000000000062FE00</span></span><br><span class="line"><span class="comment">a[0][1]'s addr is 000000000062FE04</span></span><br><span class="line"><span class="comment">a[0][2]'s addr is 000000000062FE08</span></span><br><span class="line"><span class="comment">a[1][0]'s addr is 000000000062FE0C</span></span><br><span class="line"><span class="comment">a[1][1]'s addr is 000000000062FE10</span></span><br><span class="line"><span class="comment">a[1][2]'s addr is 000000000062FE14</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></tbody></table></figure>

<p>汇编出来看看</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">main:</span><br><span class="line">    pushq    %rbp</span><br><span class="line">    ...</span><br><span class="line">    .seh_endprologue</span><br><span class="line">    call    __main</span><br><span class="line">    movl    $1, -32(%rbp)</span><br><span class="line">    movl    $2, -28(%rbp)</span><br><span class="line">    movl    $3, -24(%rbp)</span><br><span class="line">    movl    $4, -20(%rbp)</span><br><span class="line">    movl    $5, -16(%rbp)</span><br><span class="line">    movl    $6, -12(%rbp)</span><br><span class="line">    movl    $0, -4(%rbp)</span><br><span class="line">    jmp    .L2</span><br><span class="line">...</span><br><span class="line">.L2:</span><br><span class="line">    cmpl    $1, -4(%rbp)</span><br><span class="line">    jle    .L5</span><br><span class="line">    movl    $0, %eax</span><br><span class="line">    addq    $64, %rsp</span><br><span class="line">    popq    %rbp</span><br><span class="line">    ret</span><br></pre></td></tr></tbody></table></figure>

<p>现在对(%rbp)前面的数字就有那么点感觉了哈，<code>-8(%rbp)</code>去哪了？是j呀</p>
<p>数组里面还有一个特殊的，就是字符数组，在C语言里面就指望这个当字符串了</p>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">char</span> str[] = <span class="string">"hello world!"</span>;</span><br><span class="line">    <span class="keyword">char</span> arr[] = {<span class="string">'h'</span>, <span class="string">'e'</span>, <span class="string">'l'</span>, <span class="string">'l'</span>, <span class="string">'o'</span>, <span class="string">' '</span>, <span class="string">'w'</span>, <span class="string">'o'</span>, <span class="string">'r'</span>, <span class="string">'l'</span>, <span class="string">'d'</span>, <span class="string">'!'</span>};</span><br><span class="line">    <span class="keyword">char</span> tmp[] = {<span class="string">'h'</span>, <span class="string">'\0'</span>};</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i < <span class="keyword">sizeof</span>(str) / <span class="keyword">sizeof</span>(<span class="keyword">char</span>); ++i) {</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"(%c)"</span>, str[i]);</span><br><span class="line">    }</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"\n%s\n"</span>, str);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i < <span class="keyword">sizeof</span>(arr) / <span class="keyword">sizeof</span>(<span class="keyword">char</span>); ++i) {</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"(%c)"</span>, arr[i]);</span><br><span class="line">    }</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"\n%s\n"</span>, arr);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br><span class="line"><span class="comment">/* output</span></span><br><span class="line"><span class="comment">(h)(e)(l)(l)(o)( )(w)(o)(r)(l)(d)(!)( )</span></span><br><span class="line"><span class="comment">hello world!</span></span><br><span class="line"><span class="comment">(h)(e)(l)(l)(o)( )(w)(o)(r)(l)(d)(!)</span></span><br><span class="line"><span class="comment">hello world!hello world!</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></tbody></table></figure>

<p>汇编出来瞅瞅</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">main:</span><br><span class="line">    pushq    %rbp</span><br><span class="line">    ...</span><br><span class="line">    call    __main</span><br><span class="line">    movabsq    $8031924123371070824, %rax  # 8个字节</span><br><span class="line">    movq    %rax, -21(%rbp)</span><br><span class="line">    movl    $560229490, -13(%rbp)  # 4个字节 和前面8个加起来就是 hello world!</span><br><span class="line">    movb    $0, -9(%rbp)     # 最后面的\0 到这里为止应该是str的定义及声明</span><br><span class="line">    movb    $104, -33(%rbp)  # h</span><br><span class="line">    movb    $101, -32(%rbp)</span><br><span class="line">    movb    $108, -31(%rbp)</span><br><span class="line">    movb    $108, -30(%rbp)</span><br><span class="line">    movb    $111, -29(%rbp)</span><br><span class="line">    movb    $32, -28(%rbp)</span><br><span class="line">    movb    $119, -27(%rbp)</span><br><span class="line">    movb    $111, -26(%rbp)</span><br><span class="line">    movb    $114, -25(%rbp)</span><br><span class="line">    movb    $108, -24(%rbp)</span><br><span class="line">    movb    $100, -23(%rbp)</span><br><span class="line">    movb    $33, -22(%rbp)   # ! 到这里位置应该是arr的</span><br><span class="line">    movb    $104, -35(%rbp) # h</span><br><span class="line">    movb    $0, -34(%rbp)   # 这里就是tmp的了</span><br><span class="line">    movl    $0, -4(%rbp)</span><br><span class="line">    jmp    .L2</span><br><span class="line">.L3:</span><br></pre></td></tr></tbody></table></figure>

<p>从这段程序至少可以看出，字符数组要想编程字符串后面必须有<code>'\0'</code>，字符串不论何种形式，内存占的大小是一样的，但是用字符数组去初始化字符串通常会比较慢(好像每种指令执行速度不一样，这句话不一定对哦)</p>
<p>还有一个C和C++的字符串是不一样的，它们之间的转换</p>
<figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="built_in">string</span> cppString = <span class="string">"abc"</span>;</span><br><span class="line">    <span class="comment">//char* cString = "cstr";  // ISO C++ 11不允许这么干</span></span><br><span class="line">    <span class="keyword">char</span> cArr[] = <span class="string">"cArr"</span>;</span><br><span class="line">    <span class="keyword">char</span> *cString = cArr;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *tmpStr = cppString.c_str();</span><br><span class="line">    <span class="built_in">string</span> aStr = cString;</span><br><span class="line">    <span class="built_in">string</span> bStr = cArr;</span><br><span class="line">    <span class="built_in">string</span> cStr = tmpStr;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">char</span> *tmpCStr = <span class="keyword">static_cast</span><<span class="keyword">char</span> *>(<span class="built_in">malloc</span>(<span class="number">10</span>));</span><br><span class="line">    cppString.copy(tmpCStr, cppString.length(), <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">char</span> tmpCArr[<span class="number">10</span>];</span><br><span class="line">    cppString.copy(tmpCArr, cppString.length(), <span class="number">0</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">char</span> *cDataStr = cppString.data();  <span class="comment">// C++11报错 要const，C++17没事</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>数组单个玩没意思，还是需要结合指针玩</p>
<h1 id="2-指针"><a href="#2-指针" class="headerlink" title="2 指针"></a>2 指针</h1><p>先不要把这玩意想象成指针</p>
<img style="zoom: 33%;" data-src="https://gitee.com/SidneyGod/ImagePlace/raw/master/watch.webp">

<p>就当成一个数据类型，这个数据类型是存地址的，地址是啥，就一串数字，说白了就是存了一串数字。从这里我们就知道了指针的大小了，地址是无符号数，那么32位的程序就是4个字节，64位的程序就是8个字节</p>
<figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 下面三个输出都是8 我是64位的</span></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%llu\n"</span>, <span class="keyword">sizeof</span>(<span class="keyword">char</span>*));</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%llu\n"</span>, <span class="keyword">sizeof</span>(<span class="keyword">int</span>*));</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%llu\n"</span>, <span class="keyword">sizeof</span>(<span class="keyword">long</span>*));</span><br></pre></td></tr></tbody></table></figure>

<p>再看指针的声明定义啥的</p>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> a = <span class="number">10</span>;</span><br><span class="line"><span class="keyword">int</span>* iP = &a;  <span class="comment">// 我们称iP为 "指向"a的指针；&取地址符号只能应用于内存中的对象，不能用作表达式，常量，register的变量</span></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d"</span>, *iP);  <span class="comment">// 这里的*表示间接寻址或间接引用，访问指针所指向的对象</span></span><br></pre></td></tr></tbody></table></figure>

<p>指针只能指向某个特定数据类型的对象，但是void型指针比较特殊，可以指向任意数据类型的对象，但它不能间接引用自身。注意读法<font color="red"><strong>“aa指向bb的指针”</strong></font>(读法来自K&R的《C程序设计语言》)，读不好，后面就得绕进去</p>
<h2 id="2-1-指针和数组"><a href="#2-1-指针和数组" class="headerlink" title="2.1 指针和数组"></a>2.1 指针和数组</h2><p>通过数组下标所能完成的任何任务都能通过指针来实现。一般来说，用指针实现的程序比用数组下标实现的程序执行速度更快(现在优化得两者差不多了)</p>
<figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">int</span> arr[] = {<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>};</span><br><span class="line">    <span class="keyword">int</span>* pInt = &arr[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">int</span>* pArr = arr;</span><br><span class="line"></span><br><span class="line">    pInt = pInt + <span class="number">1</span>;</span><br><span class="line">    pArr = pArr + <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>汇编一下</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">main:</span><br><span class="line">    pushq    %rbp</span><br><span class="line">    ...</span><br><span class="line">    .seh_endprologue</span><br><span class="line">    call    __main</span><br><span class="line">    movl    $1, -64(%rbp)  # arr[0]</span><br><span class="line">    movl    $2, -60(%rbp)</span><br><span class="line">    movl    $3, -56(%rbp)</span><br><span class="line">    movl    $4, -52(%rbp)</span><br><span class="line">    movl    $5, -48(%rbp)</span><br><span class="line">    movl    $6, -44(%rbp)</span><br><span class="line">    movl    $7, -40(%rbp)</span><br><span class="line">    movl    $8, -36(%rbp)</span><br><span class="line">    movl    $9, -32(%rbp)</span><br><span class="line">    leaq    -64(%rbp), %rax  # load effective address</span><br><span class="line">    movq    %rax, -8(%rbp)   # pInt</span><br><span class="line">    leaq    -64(%rbp), %rax</span><br><span class="line">    movq    %rax, -16(%rbp)  # pArr</span><br><span class="line">    addq    $4, -8(%rbp)     # 地址加立即数4，因为int是4字节的</span><br><span class="line">    addq    $8, -16(%rbp)    # 地址加立即数8，两个4呀</span><br><span class="line">    movl    $0, %eax</span><br><span class="line">    addq    $96, %rsp</span><br><span class="line">    popq    %rbp</span><br><span class="line">    ret</span><br></pre></td></tr></tbody></table></figure>

<p>所以从汇编的角度来看arr就是指向arr[0]的地址，指针加n，实际上就是<code>指针的值(地址) + n * sizeof(数据类型)</code>，那么减法应当也是一样咯，地址往前往后的区别。</p>
<p>知道这层关系之后，再来讨论一下指针和多维数组之间的关系</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">int</span> arr[<span class="number">3</span>][<span class="number">4</span>] = {</span><br><span class="line">            {<span class="number">1</span>, <span class="number">2</span>,  <span class="number">3</span>,  <span class="number">4</span>},</span><br><span class="line">            {<span class="number">5</span>, <span class="number">6</span>,  <span class="number">7</span>,  <span class="number">8</span>},</span><br><span class="line">            {<span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>}</span><br><span class="line">    };</span><br><span class="line"></span><br><span class="line">    <span class="comment">// pArr是指向int的指针的数组 指针数组 pArr是个存放int型指针的一维数组</span></span><br><span class="line">    <span class="keyword">int</span> *pArr[<span class="number">3</span>] = {arr[<span class="number">0</span>], arr[<span class="number">1</span>] + <span class="number">1</span>, arr[<span class="number">2</span>] + <span class="number">2</span>};</span><br><span class="line">    <span class="comment">// int *(pArr[3]) = {arr[0], arr[1] + 1, arr[2] + 2};</span></span><br><span class="line">    <span class="comment">// p1是指向4 int数组的指针 数组指针 p1是个指针，指向的是一个数组，这样说，可能有点不明白，换个方式。</span></span><br><span class="line">    <span class="comment">// 把arr当作一维数组，存的就是4个数组的首地址，现在再看p1是个指针，指向存有4个数组首地址的数组的首地址</span></span><br><span class="line">    <span class="keyword">int</span> (*p1)[<span class="number">4</span>] = arr;</span><br><span class="line">    <span class="comment">// int (*p1)[] = arr;  // 4是可以去掉的，因为arr很明确</span></span><br><span class="line">    <span class="comment">// p2是指向指向3 int的指针的数组的指针 指向指针数组的指针</span></span><br><span class="line">    <span class="keyword">int</span> *(*p2)[<span class="number">3</span>] = &pArr;</span><br><span class="line">    <span class="comment">// int* (*p2)[] = &pArr;</span></span><br><span class="line">    <span class="comment">// p3是指向 指向4 int数组的指针 的指针，指向数组指针的指针，二级指针</span></span><br><span class="line">    <span class="keyword">int</span> (**p3)[<span class="number">4</span>] = &p1;</span><br><span class="line">    <span class="comment">// int (**p3)[] = &p1;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// p4是指向int的指针 arr == &arr[0][0]</span></span><br><span class="line">    <span class="keyword">int</span> *p4 = *arr;</span><br><span class="line">    <span class="comment">// int* p2 = arr;  这会有warning initialization of 'int *' from incompatible pointer type 'int (*)[4]'</span></span><br><span class="line"></span><br><span class="line">    printf(<span class="string">"%d\n"</span>, *(pArr[<span class="number">1</span>] + <span class="number">0</span>));       <span class="comment">// 6</span></span><br><span class="line">    printf(<span class="string">"%d\n"</span>, *(*(p1 + <span class="number">1</span>) + <span class="number">1</span>));     <span class="comment">// 6</span></span><br><span class="line">    printf(<span class="string">"%d\n"</span>, *(*(*(p2) + <span class="number">1</span>) + <span class="number">0</span>));  <span class="comment">// 6</span></span><br><span class="line">    printf(<span class="string">"%d\n"</span>, *(*(*p3 + <span class="number">1</span>) + <span class="number">1</span>));    <span class="comment">// 6</span></span><br><span class="line">    printf(<span class="string">"%d\n"</span>, *(p4 + <span class="number">5</span>));            <span class="comment">// 6</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>汇编一下</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">main:</span><br><span class="line">    pushq    %rbp              # push当然是入栈的意思</span><br><span class="line">    .seh_pushreg    %rbp</span><br><span class="line">    movq    %rsp, %rbp        # rbp是堆栈基指针 rsp是栈顶指针 现在它俩对齐了</span><br><span class="line">    .seh_setframe    %rbp, 0</span><br><span class="line">    subq    $160, %rsp        # 给变量开辟空间 160个字节</span><br><span class="line">    .seh_stackalloc    160</span><br><span class="line">    .seh_endprologue</span><br><span class="line">    call    __main</span><br><span class="line">    movl    $1, -80(%rbp)     # arr[0][0]</span><br><span class="line">    movl    $2, -76(%rbp)</span><br><span class="line">    movl    $3, -72(%rbp)</span><br><span class="line">    movl    $4, -68(%rbp)</span><br><span class="line">    movl    $5, -64(%rbp)</span><br><span class="line">    movl    $6, -60(%rbp)</span><br><span class="line">    movl    $7, -56(%rbp)</span><br><span class="line">    movl    $8, -52(%rbp)</span><br><span class="line">    movl    $9, -48(%rbp)</span><br><span class="line">    movl    $10, -44(%rbp)</span><br><span class="line">    movl    $11, -40(%rbp)</span><br><span class="line">    movl    $12, -36(%rbp)    # arr[2][3]</span><br><span class="line">    leaq    -80(%rbp), %rax   # 将-80(%rbp)的地址存到%rax</span><br><span class="line">    movq    %rax, -112(%rbp)  # pArr[0] = -112(%rbp) = -80(%rbp)的地址</span><br><span class="line">    leaq    -80(%rbp), %rax</span><br><span class="line">    addq    $16, %rax</span><br><span class="line">    addq    $4, %rax</span><br><span class="line">    movq    %rax, -104(%rbp)  # pArr[1] = -104(%rbp) = (-80 + 16 + 4)(%rbp)的地址</span><br><span class="line">    leaq    -80(%rbp), %rax</span><br><span class="line">    addq    $32, %rax</span><br><span class="line">    addq    $8, %rax</span><br><span class="line">    movq    %rax, -96(%rbp)   # pArr[2] = -96(%rbp) = (-80 + 32 + 8)(%rbp)的地址</span><br><span class="line">    leaq    -80(%rbp), %rax</span><br><span class="line">    movq    %rax, -120(%rbp)  # p1 = -120(%rbp) = -80(%rbp)的地址</span><br><span class="line">    leaq    -112(%rbp), %rax</span><br><span class="line">    movq    %rax, -8(%rbp)    # p2 = -8(%rbp) =  -112(%rbp)的地址</span><br><span class="line">    leaq    -120(%rbp), %rax</span><br><span class="line">    movq    %rax, -16(%rbp)   # p3 = -16(%rbp) = -120(%rbp)的地址</span><br><span class="line">    leaq    -80(%rbp), %rax</span><br><span class="line">    movq    %rax, -24(%rbp)   # p4 = -24(%rbp) = -80(%rbp)的地址</span><br><span class="line">    movq    -104(%rbp), %rax</span><br><span class="line">    movl    (%rax), %eax</span><br><span class="line">    movl    %eax, %edx</span><br><span class="line">    leaq    .LC0(%rip), %rcx</span><br><span class="line">    call    printf</span><br><span class="line">    movq    -120(%rbp), %rax</span><br><span class="line">    addq    $16, %rax</span><br><span class="line">    addq    $4, %rax</span><br><span class="line">    movl    (%rax), %eax</span><br><span class="line">    movl    %eax, %edx</span><br><span class="line">    leaq    .LC0(%rip), %rcx</span><br><span class="line">    call    printf</span><br><span class="line">    movq    -8(%rbp), %rax</span><br><span class="line">    addq    $8, %rax</span><br><span class="line">    movq    (%rax), %rax</span><br><span class="line">    movl    (%rax), %eax</span><br><span class="line">    movl    %eax, %edx</span><br><span class="line">    leaq    .LC0(%rip), %rcx</span><br><span class="line">    call    printf</span><br><span class="line">    movq    -16(%rbp), %rax</span><br><span class="line">    addq    $8, %rax</span><br><span class="line">    movq    (%rax), %rax</span><br><span class="line">    addq    $16, %rax</span><br><span class="line">    movl    (%rax), %eax</span><br><span class="line">    movl    %eax, %edx</span><br><span class="line">    leaq    .LC0(%rip), %rcx</span><br><span class="line">    call    printf</span><br><span class="line">    movl    $0, %eax</span><br><span class="line">    addq    $160, %rsp</span><br><span class="line">    popq    %rbp</span><br><span class="line">    ret</span><br></pre></td></tr></tbody></table></figure>

<p>再来一张图</p>
<img data-src="https://gitee.com/SidneyGod/ImagePlace/raw/master/pointer.svg">

<p>这整个搞完，发现一个很重要的点，就是当前指针的步长是多少，当前指针存储地址是多少，这样就可以无限递归推算下去。</p>
<p>PS：没系统学过汇编，可能表述的有点问题..</p>
<h2 id="2-2-指针运算"><a href="#2-2-指针运算" class="headerlink" title="2.2 指针运算"></a>2.2 指针运算</h2><p>再探讨一下比较好玩的事，常量指针和指针常量</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 没有const的话，我们读作 变量a；加了const，我们读作 常量a</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">char</span> a;</span><br><span class="line"><span class="keyword">char</span> <span class="keyword">const</span> b;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 变量p1是指向 常量char 的指针，变量p1，那么p1的值可以变，但是p1指向的值不能变</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">char</span> *p1;</span><br><span class="line"><span class="comment">// 变量p1是指向 char常量 的指针</span></span><br><span class="line"><span class="keyword">char</span> <span class="keyword">const</span> *p1;</span><br><span class="line">    </span><br><span class="line"><span class="comment">// 常量p2是指向 char变量 的指针，常量p2，那么p2的值不能变，但是p2指向的值可以变</span></span><br><span class="line"><span class="keyword">char</span>* <span class="keyword">const</span> p2;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 常量p3是指向 常量char 的指针，都是常量，那就是都不能变</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">char</span>* <span class="keyword">const</span> p3;</span><br><span class="line"><span class="keyword">char</span> <span class="keyword">const</span> * <span class="keyword">const</span> p3;  <span class="comment">// 看起来很奇怪对不对 但是能够读得通 那就没毛病</span></span><br><span class="line"></span><br><span class="line">p1 = &a;  <span class="comment">// OK</span></span><br><span class="line"><span class="comment">// *p1 = 'a';   Read-only variable is not assignable</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// p2 = &a;  Cannot assign to variable 'p3' with const-qualified type 'char *const'</span></span><br><span class="line">*p2 = <span class="string">'a'</span>;  <span class="comment">// OK</span></span><br></pre></td></tr></tbody></table></figure>

<p>啥常量指针，指针常量，那第三个咋读？常量指针常量？精简就容易带来误解</p>
<p>好了，那只是个题外话，接下来说说，指针相关的计算，就是加减乘除啥的</p>
<p><strong>指针和基本数据类型</strong></p>
<p>从上面我们了解到，指针和int可以做加减，实际就是指针存储的值做偏移，比如下面的程序，一点毛病没有</p>
<figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">int</span> arr[] = {<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>};</span><br><span class="line">    <span class="keyword">int</span> *pArr = arr;</span><br><span class="line">    pArr++;</span><br><span class="line">    pArr--;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>问题1：那有个好玩的数据类型，void，这个呢？可以与int做加减吗？根据搜索得知</p>
<blockquote>
<p>void* pvoid;</p>
<p>pvoid++; // ANSI：错误</p>
<p>pvoid += 1; // ANSI：错误</p>
<p>pvoid++; //GNU：正确</p>
<p>pvoid += 1; //GNU：正确</p>
<p>(char *) pvoid++; // ANSI：正确；GNU：正确</p>
<p>(char *) pvoid += 1; // ANSI：错误；GNU：正确</p>
</blockquote>
<p>这么说，ANSI限制贼严格..切换成ANSI全报红了..还是GNU比较奔放。通过实验也可以发现，在GNU下，<code>sizeof(void)</code>的值是1</p>
<p>问题2：能和浮点数相加吗？能和char相加吗？能和long相加吗？</p>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> arr[] = {<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>};</span><br><span class="line"><span class="keyword">int</span>* pInt = arr;</span><br><span class="line"><span class="comment">// pInt += 2.1;  // Invalid operands to binary expression ('int *' and 'double')</span></span><br><span class="line">pInt += <span class="string">'0'</span>;</span><br><span class="line">pInt += <span class="number">1L</span>;</span><br><span class="line"><span class="keyword">short</span> s = <span class="number">1</span>;</span><br><span class="line">pInt += s;</span><br></pre></td></tr></tbody></table></figure>

<p>答案还是比较容易想到的</p>
<p>问题3：指针可以乘除吗？</p>
<p>Invalid operands to binary expression (‘int *’ and ‘int’)。我只能说隐式转换不成功</p>
<p><strong>指针和指针</strong></p>
<p>问题1：指针和指针相加会有什么特效？</p>
<p>Invalid operands to binary expression (‘int *’ and ‘int *’)</p>
<p>当然也不要想着乘除了，存在必合理，不存在那肯定就是不合理了</p>
<p>问题2：指针和指针相减会有什么特效？</p>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> arr[] = {<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>};</span><br><span class="line"><span class="keyword">int</span>* pInt1 = arr;</span><br><span class="line"><span class="keyword">int</span>* pInt2 = arr + <span class="number">1</span>;</span><br><span class="line"><span class="keyword">long</span> <span class="keyword">long</span> diff = pInt2 - pInt1;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%llu\n"</span>, diff);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%lld"</span>, pInt1 - pInt2);  <span class="comment">// 很容易想到吧</span></span><br></pre></td></tr></tbody></table></figure>

<p>这是同类型的，那不同类型的呢？</p>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> a;</span><br><span class="line"><span class="keyword">unsigned</span> u;</span><br><span class="line"><span class="keyword">char</span> b;</span><br><span class="line"><span class="keyword">long</span> c;</span><br><span class="line"><span class="keyword">double</span> d;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span>* pa = &a;</span><br><span class="line"><span class="keyword">unsigned</span> *pu = &u;</span><br><span class="line"><span class="keyword">char</span>* pb = &b;</span><br><span class="line"><span class="keyword">long</span>* pc = &c;</span><br><span class="line"><span class="keyword">double</span>* pd = &d;</span><br><span class="line"></span><br><span class="line"><span class="comment">// pa - pb;  'int *' and 'char *' are not pointers to compatible types</span></span><br><span class="line"><span class="comment">// pa - pu;</span></span><br><span class="line"><span class="comment">// pa - pc;</span></span><br><span class="line"><span class="comment">// pa - pd;</span></span><br></pre></td></tr></tbody></table></figure>

<p>这报的错叫aa和bb不是指向兼容的指针，难道还有类型不一样，但是类型兼容的指针？指针减一下就知道是不是同类型的了，不是编译都过不了</p>
<p><strong>指针逻辑运算</strong></p>
<p>不打算研究那么多了，指针能够比较大小吗？</p>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> arr[] = {<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>};</span><br><span class="line"><span class="keyword">int</span> *pInt1 = arr;</span><br><span class="line"><span class="keyword">int</span> *pInt2 = arr + <span class="number">1</span>;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d\n"</span>, pInt1 < pInt2);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d\n"</span>, pInt1 < <span class="number">0</span>);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d\n"</span>, pInt1 < <span class="number">0xFFFFFFFFFF</span>);  <span class="comment">// Ordered comparison between pointer and integer ('int *' and 'long long')</span></span><br></pre></td></tr></tbody></table></figure>

<p>汇编一下</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">main:</span><br><span class="line">    pushq    %rbp</span><br><span class="line">    .seh_pushreg    %rbp</span><br><span class="line">    movq    %rsp, %rbp</span><br><span class="line">    .seh_setframe    %rbp, 0</span><br><span class="line">    subq    $64, %rsp</span><br><span class="line">    .seh_stackalloc    64</span><br><span class="line">    .seh_endprologue</span><br><span class="line">    call    __main</span><br><span class="line">    movl    $10, -28(%rbp)    # arr[0]</span><br><span class="line">    movl    $2, -24(%rbp)     # arr[1]</span><br><span class="line">    movl    $3, -20(%rbp)     # arr[2]</span><br><span class="line">    leaq    -28(%rbp), %rax</span><br><span class="line">    movq    %rax, -8(%rbp)   # pInt1</span><br><span class="line">    leaq    -28(%rbp), %rax</span><br><span class="line">    addq    $4, %rax</span><br><span class="line">    movq    %rax, -16(%rbp)  # pInt2</span><br><span class="line">    movq    -8(%rbp), %rax</span><br><span class="line">    cmpq    -16(%rbp), %rax  # 直接拿存储的地址进行比较</span><br><span class="line">    setb    %al</span><br><span class="line">    movzbl    %al, %eax</span><br><span class="line">    movl    %eax, %edx</span><br><span class="line">    leaq    .LC0(%rip), %rcx</span><br><span class="line">    call    printf</span><br><span class="line">    movl    $0, %edx              # 这应该是被优化了 都不比较了</span><br><span class="line">    leaq    .LC0(%rip), %rcx</span><br><span class="line">    call    printf</span><br><span class="line">    movabsq    $1099511627774, %rax</span><br><span class="line">    cmpq    %rax, -16(%rbp)       # 拿地址和数字进行比较</span><br><span class="line">    setbe    %al</span><br><span class="line">    movzbl    %al, %eax</span><br><span class="line">    movl    %eax, %edx</span><br><span class="line">    leaq    .LC0(%rip), %rcx</span><br><span class="line">    call    printf</span><br><span class="line">    movl    $0, %eax</span><br><span class="line">    addq    $64, %rsp</span><br><span class="line">    popq    %rbp</span><br><span class="line">    ret</span><br></pre></td></tr></tbody></table></figure>

<p>总结一下</p>
<blockquote>
<p>有效的指针运算包括相同类型指针之间的赋值运算；指针同整数之间的加法或减法运算；指向相同数组中元素的两个指针间的减法或比较运算；将指针赋值为0或指针与0之间的比较运算。其他所有形式的指针运算都是非法的，指针之间加减乘除，移位或屏蔽运算；指针同float或double类型之间的加法；不经强制类型转换而直接将指向一种类型对象的指针赋值给指向另一种类型对象的指针运算(两个指针之一是void*类型的情况除外)</p>
</blockquote>
<p>至于函数指针，指针函数这俩玩意放到函数那块再讨论</p>
<h1 id="3-引用"><a href="#3-引用" class="headerlink" title="3 引用"></a>3 引用</h1><p>引用这个概念是Cpp的，C没有，在Cpp的世界里，指针与引用是分不开的</p>
<p>和指针类似，引用作为对象的别名存放的也是对象的机器地址，与指针相比，引用不会带来额外的开销，引用与指针的却别主要包括：</p>
<ul>
<li><p>访问引用与访问对象本身从语法形式上是一样的</p>
</li>
<li><p>引用所引的永远是一开始初始化的那个对象</p>
</li>
<li><p>不存在“空引用”，我们可以认为引用一定对应着某个对象</p>
</li>
</ul>
<p>引用实际上是对象的别名。引用最重要的用途是作为函数的实参或返回值，此外它也被用于重载运算符</p>
<p>左值引用：引用那些我们希望改变的对象</p>
<p>const引用：引用那些我们不希望改变值的对象(比如常量)</p>
<p>右值引用：所引对象的值在我们使用之后就无需保留了(比如临时变量)</p>
<p>前两种都叫做左值引用</p>
<h2 id="3-1-左值引用"><a href="#3-1-左值引用" class="headerlink" title="3.1 左值引用"></a>3.1 左值引用</h2><figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span>& r = i;</span><br><span class="line">    <span class="keyword">int</span> ii = r;</span><br><span class="line">    r = <span class="number">4</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%d, %d, %d, %p\n"</span>, i, r, ii, &r);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br><span class="line"><span class="comment">/* output</span></span><br><span class="line"><span class="comment">4, 4, 1, 000000000064fe10</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></tbody></table></figure>

<p>说明引用是有地址的，引用和(*p)是很像的，但是引用这玩意比较智能一点，汇编一波</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">main:</span><br><span class="line">    pushq    %rbp</span><br><span class="line">    ...</span><br><span class="line">    .seh_endprologue</span><br><span class="line">    call    __main</span><br><span class="line">    movl    $1, -16(%rbp)     # int i = 1;</span><br><span class="line">    leaq    -16(%rbp), %rax</span><br><span class="line">    movq    %rax, -8(%rbp)    # int& r = i;</span><br><span class="line">    movq    -8(%rbp), %rax</span><br><span class="line">    movl    (%rax), %eax</span><br><span class="line">    movl    %eax, -12(%rbp)   # int ii = r;</span><br><span class="line">    movq    -8(%rbp), %rax</span><br><span class="line">    movl    $4, (%rax)        # r = 4;</span><br><span class="line">    movq    -8(%rbp), %rax</span><br><span class="line">    movl    (%rax), %ecx      # i</span><br><span class="line">    movl    -16(%rbp), %eax   # r</span><br><span class="line">    movl    -12(%rbp), %r8d   # ii</span><br><span class="line">    movq    -8(%rbp), %rdx</span><br><span class="line">    movq    %rdx, 32(%rsp)    # &r</span><br><span class="line">    movl    %r8d, %r9d</span><br><span class="line">    movl    %ecx, %r8d</span><br><span class="line">    movl    %eax, %edx</span><br><span class="line">    leaq    .LC0(%rip), %rcx</span><br><span class="line">    call    _ZL6printfPKcz</span><br><span class="line">    movl    $0, %eax</span><br><span class="line">    addq    $64, %rsp</span><br><span class="line">    popq    %rbp</span><br><span class="line">    ret</span><br></pre></td></tr></tbody></table></figure>

<p>再把引用换成指针</p>
<figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"iostream"</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span>* r = &i;</span><br><span class="line">    <span class="keyword">int</span> ii = *r;</span><br><span class="line">    *r = <span class="number">4</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%d, %d, %d, %p\n"</span>, i, *r, ii, &(*r));  <span class="comment">// 这才是引用的本质</span></span><br><span class="line">    <span class="comment">// printf("%d, %d, %d, %p\n", i, *r, ii, &r);  // 这样汇编会少一句 movl    %eax, %edx</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br><span class="line"><span class="comment">/* output</span></span><br><span class="line"><span class="comment">4, 4, 1, 000000000064fe10</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></tbody></table></figure>

<p>汇编一下</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">main:</span><br><span class="line">    pushq    %rbp</span><br><span class="line">    ...</span><br><span class="line">    .seh_endprologue</span><br><span class="line">    call    __main</span><br><span class="line">    movl    $1, -16(%rbp)</span><br><span class="line">    leaq    -16(%rbp), %rax</span><br><span class="line">    movq    %rax, -8(%rbp)</span><br><span class="line">    movq    -8(%rbp), %rax</span><br><span class="line">    movl    (%rax), %eax</span><br><span class="line">    movl    %eax, -12(%rbp)</span><br><span class="line">    movq    -8(%rbp), %rax</span><br><span class="line">    movl    $4, (%rax)</span><br><span class="line">    movq    -8(%rbp), %rax</span><br><span class="line">    movl    (%rax), %ecx</span><br><span class="line">    movl    -16(%rbp), %eax</span><br><span class="line">    movl    -12(%rbp), %r8d</span><br><span class="line">    movq    -8(%rbp), %rdx</span><br><span class="line">    movq    %rdx, 32(%rsp)</span><br><span class="line">    movl    %r8d, %r9d</span><br><span class="line">    movl    %ecx, %r8d</span><br><span class="line">    movl    %eax, %edx</span><br><span class="line">    leaq    .LC0(%rip), %rcx</span><br><span class="line">    call    _ZL6printfPKcz</span><br><span class="line">    movl    $0, %eax</span><br><span class="line">    addq    $64, %rsp</span><br><span class="line">    popq    %rbp</span><br><span class="line">    ret</span><br></pre></td></tr></tbody></table></figure>

<p>汇编出来的代码都一毛一样，所以，你懂我意思吧。</p>
<p><strong>为了确保引用对应某个对象，必须初始化引用</strong></p>
<p>再来看一个牛逼一点的常量引用</p>
<figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">10</span>;</span><br><span class="line">    <span class="comment">// 常量引用的本质 汇编代码是一样的</span></span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span>& r = i;</span><br><span class="line">    <span class="keyword">int</span>* <span class="keyword">const</span> p = &i;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> t = <span class="number">10</span>;</span><br><span class="line">    <span class="comment">// r = &i;  Cannot assign to variable 'r' with const-qualified type 'const int &'</span></span><br><span class="line">    <span class="comment">// p = &t;  Cannot assign to variable 'p' with const-qualified type 'int *const'</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span>& r1 = <span class="number">1</span>;  <span class="comment">// 这个稍微强一点 只不过是少写点代码而已</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h2 id="3-2-右值引用"><a href="#3-2-右值引用" class="headerlink" title="3.2 右值引用"></a>3.2 右值引用</h2><p>右值引用对应一个临时对象，用户可以修改这个对象，并且认定这个对象以后不会用到了</p>
<figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="comment">// int a = 10;</span></span><br><span class="line">    <span class="comment">// int&& rr = a;  // Rvalue reference to type 'int' cannot bind to lvalue of type 'int'</span></span><br><span class="line">    <span class="keyword">int</span> && rr = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span>&& rr1 = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>rr是个临时变量，不允许绑定左值，只允许绑定右值。虽然可以声明定义const右值引用，但是一般不用，因为右值引用就是用来修改的，加了const就不能改了</p>
<p>右值引用和const左值引用都能绑定右值，但是它们的目标完全不同</p>
<ul>
<li><p>右值引用实现了一种破坏性读取，某些数据本来需要拷贝，使用右值引用可以优化其性能</p>
</li>
<li><p>const左值引用的目的是保护参数内容不被修改</p>
</li>
</ul>
<p>为什么说提高性能</p>
<figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span><<span class="class"><span class="keyword">class</span> <span class="title">T</span>></span></span><br><span class="line"><span class="class"><span class="title">void</span> <span class="title">swap1</span>(<span class="title">T</span>& <span class="title">a</span>, <span class="title">T</span>& <span class="title">b</span>) {</span></span><br><span class="line">    T tmp = <span class="keyword">static_cast</span><T&&>(a);</span><br><span class="line">    a = <span class="keyword">static_cast</span><T&&>(b);</span><br><span class="line">    b = <span class="keyword">static_cast</span><T&&>(tmp);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span><<span class="class"><span class="keyword">class</span> <span class="title">T</span>></span></span><br><span class="line"><span class="class"><span class="title">void</span> <span class="title">swap2</span>(<span class="title">T</span>& <span class="title">a</span>, <span class="title">T</span>& <span class="title">b</span>) {</span></span><br><span class="line">    T tmp = <span class="built_in">std</span>::move(a);</span><br><span class="line">    a = <span class="built_in">std</span>::move(b);</span><br><span class="line">    b = <span class="built_in">std</span>::move(tmp);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>move函数并没有移动，而是将左值强转为右值。这里需要插播一下，何为左值，何为右值</p>
<blockquote>
<p>右值是”不能作为左值的值”，比如像函数返回值一样的临时值。右值的定义多么清晰，只要知道什么是左值就行了。当考虑对象的寻址，拷贝，移动等操作时，有两种属性特别关键</p>
<ul>
<li>有身份，在程序中有对象的名字，或者指向该对象的指针，或该对象的引用，这样我们就能判断两个对象是否相等或对象值是否发生改变</li>
<li>可移动，能把对象的内容移出来(比如，能把它的值移动到其他某处，剩下的对象处于合法但未指定状态，与拷贝是有差别的)</li>
</ul>
<p>根据排列组合可知，有身份和可移动可以组合成四种形式，但是既没有身份又不可移动的对象不重要。</p>
<p>左值：有身份 && !可移动</p>
<p>特别值：有身份 && 可移动</p>
<p>纯右值：!有身份 && 可移动<br>其中左值和特别值又称泛左值(有身份)，纯右值和特别值又称右值(可移动)。在实际编程中考虑左值和右值就够了，一条表达式要么是左值，要么是右值，不可能两者都是</p>
</blockquote>
<p>程序一：</p>
<figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">int</span> a = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> b = <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">int</span> tmp = <span class="keyword">static_cast</span><<span class="keyword">int</span>&&>(a);</span><br><span class="line">    a = <span class="keyword">static_cast</span><<span class="keyword">int</span>&&>(b);</span><br><span class="line">    b = <span class="keyword">static_cast</span><<span class="keyword">int</span>&&>(tmp);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%d, %d, %d\n"</span>, a, b, tmp);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br><span class="line"><span class="comment">/* output</span></span><br><span class="line"><span class="comment">2, 1, 1</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></tbody></table></figure>

<p>汇编一下</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">main:</span><br><span class="line">    pushq    %rbp</span><br><span class="line">    movq    %rsp, %rbp</span><br><span class="line">    subq    $48, %rsp</span><br><span class="line">    call    __main</span><br><span class="line">    movl    $1, -4(%rbp)       # int a = 1;</span><br><span class="line">    movl    $2, -8(%rbp)       # int b = 2;</span><br><span class="line">    movl    -4(%rbp), %eax     # %eax临时变量的角色 1</span><br><span class="line">    movl    %eax, -12(%rbp)    # int tmp = 1;</span><br><span class="line">    movl    -8(%rbp), %eax     # %eax的值换成了2</span><br><span class="line">    movl    %eax, -4(%rbp)     # a = 2;</span><br><span class="line">    movl    -12(%rbp), %eax    # 临时变量又换成了 1</span><br><span class="line">    movl    %eax, -8(%rbp)     # b = 1;</span><br><span class="line">    movl    -12(%rbp), %ecx</span><br><span class="line">    movl    -8(%rbp), %edx</span><br><span class="line">    movl    -4(%rbp), %eax</span><br><span class="line">    movl    %ecx, %r9d</span><br><span class="line">    movl    %edx, %r8d</span><br><span class="line">    movl    %eax, %edx</span><br><span class="line">    leaq    .LC0(%rip), %rcx</span><br><span class="line">    call    _ZL6printfPKcz</span><br><span class="line">    movl    $0, %eax</span><br><span class="line">    addq    $48, %rsp</span><br><span class="line">    popq    %rbp</span><br><span class="line">    ret</span><br></pre></td></tr></tbody></table></figure>

<p>程序二：</p>
<figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">int</span> a = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> b = <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">int</span> tmp = a;</span><br><span class="line">    a = b;</span><br><span class="line">    b = tmp;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%d, %d, %d\n"</span>, a, b, tmp);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>汇编一下</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">main:</span><br><span class="line">    pushq    %rbp</span><br><span class="line">    movq    %rsp, %rbp</span><br><span class="line">    subq    $48, %rsp</span><br><span class="line">    call    __main</span><br><span class="line">    movl    $1, -4(%rbp)</span><br><span class="line">    movl    $2, -8(%rbp)</span><br><span class="line">    movl    -4(%rbp), %eax</span><br><span class="line">    movl    %eax, -12(%rbp)</span><br><span class="line">    movl    -8(%rbp), %eax</span><br><span class="line">    movl    %eax, -4(%rbp)</span><br><span class="line">    movl    -12(%rbp), %eax</span><br><span class="line">    movl    %eax, -8(%rbp)</span><br><span class="line">    movl    -12(%rbp), %ecx</span><br><span class="line">    movl    -8(%rbp), %edx</span><br><span class="line">    movl    -4(%rbp), %eax</span><br><span class="line">    movl    %ecx, %r9d</span><br><span class="line">    movl    %edx, %r8d</span><br><span class="line">    movl    %eax, %edx</span><br><span class="line">    leaq    .LC0(%rip), %rcx</span><br><span class="line">    call    _ZL6printfPKcz</span><br><span class="line">    movl    $0, %eax</span><br><span class="line">    addq    $48, %rsp</span><br><span class="line">    popq    %rbp</span><br><span class="line">    ret</span><br></pre></td></tr></tbody></table></figure>

<p>和程序1的汇编代码是一毛一样的..难道右值引用只是个噱头？</p>
<p>程序三：</p>
<figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="built_in">string</span> s1 = <span class="string">"a"</span>;</span><br><span class="line">    <span class="built_in">string</span> s2 = <span class="string">"b"</span>;</span><br><span class="line">    <span class="built_in">string</span> tmp = s1;</span><br><span class="line">    s1 = s2;</span><br><span class="line">    s2 = tmp;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"s1: %s\n"</span>, s1.c_str());</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"s2: %s\n"</span>, s2.c_str());</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"tmp: %s\n"</span>, tmp.c_str());</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br><span class="line"><span class="comment">/* output</span></span><br><span class="line"><span class="comment">s1: b</span></span><br><span class="line"><span class="comment">s2: a</span></span><br><span class="line"><span class="comment">tmp: a</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></tbody></table></figure>

<p>程序四：</p>
<figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="built_in">string</span> s1 = <span class="string">"a"</span>;</span><br><span class="line">    <span class="built_in">string</span> s2 = <span class="string">"b"</span>;</span><br><span class="line">    <span class="built_in">string</span> tmp = <span class="keyword">static_cast</span><<span class="built_in">string</span>&&>(s1);</span><br><span class="line">    s1 = <span class="keyword">static_cast</span><<span class="built_in">string</span>&&>(s2);</span><br><span class="line">    s2 = <span class="keyword">static_cast</span><<span class="built_in">string</span>&&>(tmp);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"s1: %s\n"</span>, s1.c_str());</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"s2: %s\n"</span>, s2.c_str());</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"tmp: %s\n"</span>, tmp.c_str());</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br><span class="line"><span class="comment">/* output</span></span><br><span class="line"><span class="comment">s1: b</span></span><br><span class="line"><span class="comment">s2: a</span></span><br><span class="line"><span class="comment">tmp:</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></tbody></table></figure>

<p>从结果来看，tmp里面的东西真的移走了，程序三个程序四的汇编代码很类似，只是程序四较程序三少一点东西</p>
<p>再来个程序看左引用和右引用</p>
<figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">int</span>&& rr = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">10</span>;</span><br><span class="line">    <span class="keyword">int</span>& r = i;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>汇编一下</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">main:</span><br><span class="line">    pushq    %rbp</span><br><span class="line">    ...</span><br><span class="line">    call    __main</span><br><span class="line">    movl    $11, %eax</span><br><span class="line">    movl    %eax, -20(%rbp)  # 11也是有地址的</span><br><span class="line">    leaq    -20(%rbp), %rax</span><br><span class="line">    movq    %rax, -8(%rbp)   # int&& rr = 10;</span><br><span class="line">    movl    $10, -24(%rbp)   # int i = 10</span><br><span class="line">    leaq    -24(%rbp), %rax</span><br><span class="line">    movq    %rax, -16(%rbp)  # r = &i;</span><br><span class="line">    movl    $0, %eax</span><br><span class="line">    addq    $64, %rsp</span><br><span class="line">    popq    %rbp</span><br><span class="line">    ret</span><br></pre></td></tr></tbody></table></figure>

<p>事实上右值(临时变量)是有地址的，只是我们不知道存在哪罢了，并且这个右值与它的引用具有相同的生命周期。<strong>临时变量根本上来说就是一个没有名字的变量而已</strong>，有名字的10(i)和没名字的11的处理方式基本一致</p>
<h2 id="3-3-引用的引用"><a href="#3-3-引用的引用" class="headerlink" title="3.3 引用的引用"></a>3.3 引用的引用</h2><p>如果用引用指向某类型的引用，那么得到还是该类型的引用，而非特殊的引用的引用类型。就是传说中的引用折叠(reference collapse)问题。</p>
<figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> rr_i = <span class="keyword">int</span>&&;</span><br><span class="line"><span class="keyword">using</span> lr_i = <span class="keyword">int</span>&;</span><br><span class="line"><span class="keyword">using</span> rr_rr_i = rr_i&&;  <span class="comment">// int&& && 的类型是 int&&</span></span><br><span class="line"><span class="keyword">using</span> lr_rr_i = rr_i&;   <span class="comment">// int&& &  的类型是 int&</span></span><br><span class="line"><span class="keyword">using</span> rr_lr_i = lr_i&&;  <span class="comment">// int& &&  的类型是 int&</span></span><br><span class="line"><span class="keyword">using</span> lr_lr_i = lr_i&;   <span class="comment">// int& &   的类型是 int&</span></span><br></pre></td></tr></tbody></table></figure>

<p>永远是左值引用优先，不管怎么做都无法改变左值引用绑定左值的事实。</p>
<p>C++不允许<code>int&& &r = i;</code>的语法</p>
<h1 id="4-结构"><a href="#4-结构" class="headerlink" title="4 结构"></a>4 结构</h1><p>这个应该叫做自定义数据类型的，struct，enum，union，class等，这绝对是个大章节，想想就有很多知识点..</p>
<p>可别把结构体搞成这样</p>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Declaration does not declare anything</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> {</span></span><br><span class="line">    <span class="keyword">int</span> a;</span><br><span class="line">    <span class="keyword">int</span> b;</span><br><span class="line">};  <span class="comment">// 声明成这样 让人咋用？</span></span><br></pre></td></tr></tbody></table></figure>

<p>好歹给名字让人能叫出来名字</p>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 形式1</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">POINT</span>{</span></span><br><span class="line">    <span class="keyword">int</span> x;</span><br><span class="line">    <span class="keyword">int</span> y;</span><br><span class="line">};</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">POINT</span> <span class="title">p</span> = {</span><span class="number">0</span>, <span class="number">0</span>};</span><br><span class="line"></span><br><span class="line"><span class="comment">// 形式2</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> {</span></span><br><span class="line">    <span class="keyword">int</span> x;</span><br><span class="line">    <span class="keyword">int</span> y;</span><br><span class="line">} P;</span><br><span class="line">P p1 = {<span class="number">1</span>,<span class="number">2</span>};</span><br><span class="line"></span><br><span class="line"><span class="comment">// 形式3</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">P2</span> {</span></span><br><span class="line">    <span class="keyword">int</span> x;</span><br><span class="line">    <span class="keyword">int</span> y;</span><br><span class="line">} P1;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">P2</span> <span class="title">p2</span>;</span></span><br><span class="line">P1 p3;</span><br></pre></td></tr></tbody></table></figure>

<p>我们来汇编一个结构，来看看在内存里面长啥样</p>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">POINT</span> {</span></span><br><span class="line">        <span class="keyword">int</span> x;</span><br><span class="line">        <span class="keyword">char</span> y;</span><br><span class="line">        <span class="keyword">char</span> z;</span><br><span class="line">    };</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">POINT</span> <span class="title">p</span> = {</span><span class="number">1</span>, <span class="string">'a'</span>, <span class="string">'b'</span>};</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%p\n"</span>, &p);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%p\n"</span>, &p.x);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%p\n"</span>, &p.y);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%p\n"</span>, &p.z);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>汇编一下</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">main:</span><br><span class="line">    pushq    %rbp</span><br><span class="line">    ...</span><br><span class="line">    .seh_endprologue</span><br><span class="line">    call    __main</span><br><span class="line">    movl    $1, -8(%rbp)       # p.x</span><br><span class="line">    movb    $97, -4(%rbp)      # p.y</span><br><span class="line">    movb    $98, -3(%rbp)      # p.z</span><br><span class="line">    leaq    -8(%rbp), %rax     # 结构提名就是第一个元素的地址</span><br><span class="line">    movq    %rax, %rdx</span><br><span class="line">    leaq    .LC0(%rip), %rcx</span><br><span class="line">    call    printf</span><br><span class="line">    leaq    -8(%rbp), %rax     # 第一个元素的地址</span><br><span class="line">    movq    %rax, %rdx</span><br><span class="line">    leaq    .LC0(%rip), %rcx</span><br><span class="line">    call    printf</span><br><span class="line">    leaq    -8(%rbp), %rax</span><br><span class="line">    addq    $4, %rax           # 第二个元素地址</span><br><span class="line">    movq    %rax, %rdx</span><br><span class="line">    leaq    .LC0(%rip), %rcx</span><br><span class="line">    call    printf</span><br><span class="line">    leaq    -8(%rbp), %rax</span><br><span class="line">    addq    $5, %rax           # 第三个元素地址</span><br><span class="line">    movq    %rax, %rdx</span><br><span class="line">    leaq    .LC0(%rip), %rcx</span><br><span class="line">    call    printf</span><br><span class="line">    movl    $0, %eax</span><br><span class="line">    addq    $48, %rsp</span><br><span class="line">    popq    %rbp</span><br><span class="line">    ret</span><br></pre></td></tr></tbody></table></figure>

<p>貌似和数组一样，结构体名字不占空间，顺着基地址往上顶就完了，那么这里就来了第一个问题，结构体在内存大小的问题，</p>
<h2 id="3-1-内存对齐"><a href="#3-1-内存对齐" class="headerlink" title="3.1 内存对齐"></a>3.1 内存对齐</h2><p>来看一个程序</p>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">P1</span> {</span></span><br><span class="line">        <span class="keyword">int</span> x;</span><br><span class="line">        <span class="keyword">char</span> c;</span><br><span class="line">        <span class="keyword">short</span> s;</span><br><span class="line">    } P1;</span><br><span class="line">    P1 p1 = {<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>};</span><br><span class="line"></span><br><span class="line">    <span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">P2</span> {</span></span><br><span class="line">        <span class="keyword">char</span> c;</span><br><span class="line">        <span class="keyword">int</span> x;</span><br><span class="line">        <span class="keyword">short</span> s;</span><br><span class="line">    } P2;</span><br><span class="line">    P2 p2 = {<span class="number">2</span>, <span class="number">1</span>, <span class="number">3</span>};</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"sizeof(P1): %lld\n"</span>, <span class="keyword">sizeof</span>(P1));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"sizeof(P2): %lld\n"</span>, <span class="keyword">sizeof</span>(P2));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br><span class="line"><span class="comment">/* output</span></span><br><span class="line"><span class="comment">sizeof(P1): 8</span></span><br><span class="line"><span class="comment">sizeof(P2): 12</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></tbody></table></figure>

<p>汇编一下</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">main:</span><br><span class="line">    pushq    %rbp</span><br><span class="line">    ...</span><br><span class="line">    .seh_endprologue</span><br><span class="line">    call    __main</span><br><span class="line">    movl    $1, -8(%rbp)    # p1.x</span><br><span class="line">    movb    $2, -4(%rbp)    # p1.c</span><br><span class="line">    movw    $3, -2(%rbp)    # p1.s</span><br><span class="line">    movb    $2, -20(%rbp)   # p2.c</span><br><span class="line">    movl    $1, -16(%rbp)   # p2.x</span><br><span class="line">    movw    $3, -12(%rbp)   # p2.s</span><br><span class="line">    movl    $8, %edx</span><br><span class="line">    leaq    .LC0(%rip), %rcx</span><br><span class="line">    call    printf</span><br><span class="line">    movl    $12, %edx</span><br><span class="line">    leaq    .LC1(%rip), %rcx</span><br><span class="line">    call    printf</span><br><span class="line">    movl    $0, %eax</span><br><span class="line">    addq    $64, %rsp</span><br><span class="line">    popq    %rbp</span><br><span class="line">    ret</span><br></pre></td></tr></tbody></table></figure>

<p>多么有意思，调个位置，占得内存大小就不一样了，画个图，很容易就能搞明白</p>
<img data-src="https://gitee.com/SidneyGod/ImagePlace/raw/master/struct_mem_20210418183714.svg">

<p>灰色的就是被浪费了，为啥呢，因为要内存对齐，很多语言都有的特性。尽管内存是以字节为单位，但是大部分处理器并不是按字节块来存取内存的。它一般会以2字节，4字节，8字节，16字节甚至32字节为单位来存取内存。每个特定平台上的编译器都有自己的默认“对齐系数”（也叫对齐模数）。gcc中默认<code>#pragma pack(4)</code>，可以通过预编译命令<code>#pragma pack(n), n = 1,2,4,8,16</code>来改变这一系数。</p>
<p>1 对齐值</p>
<p>数据类型自身对齐值：基本数据类型的自身所占空间大小</p>
<p>指定对齐值：使用<code>#pragam pack(value)</code>时，指定的对齐值value</p>
<p>结构体或类的自身对齐值：其中成员对齐值最大的那个值</p>
<p>结构体和类的<strong>有效对齐值</strong>：自身对其值和指定对其值中较小的那个值，有效对齐值也叫<strong>对齐单位</strong>。</p>
<p>2 结构体第一个成员的<strong>偏移量（offset）</strong>为0，以后每个成员相对于结构体首地址的offset都是<strong>该成员大小与有效对齐值中较小那个</strong>的整数倍，如有需要编译器会在成员之间加上填充字节。</p>
<p>3 <strong>结构体的总大小</strong>为 有效对齐值 的<strong>整数倍</strong>，如有需要编译器会在最末一个成员之后加上填充字节。</p>
<p>分别解释一下P1和P2</p>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// P1，最长的数据类型是 int x; 是4，我电脑默认指定对齐值是8，那么有效对齐值就是4</span></span><br><span class="line"><span class="comment">// 第一个数据类型是 int x; offset是0，直接放进去内存</span></span><br><span class="line"><span class="comment">// 第二个数据类型是 char c; offset是成员大小(1)与有效对齐值(4)较小的那个整数倍，5比8小，紧挨着放</span></span><br><span class="line"><span class="comment">// 第三个数据类型是 short s; offset是成员大小(2)与有效对齐值(4)较小的那个整数倍，6比8小，放在6的位置，中间补个空，浪费掉</span></span><br><span class="line"><span class="comment">// 结构体总大小是有效对齐值的整数倍，此时P1的大小已经是4(x) + 1(c) + 1(补充) + 2(s) = 8 = 4 * 2，所以不用补充</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// P2，最长的数据类型是 int x; 是4，我电脑默认指定对齐值是8，那么有效对齐值就是4</span></span><br><span class="line"><span class="comment">// 第一个数据是 short s; offset是0，直接放进去</span></span><br><span class="line"><span class="comment">// 第二个数据是 int x; offset是成员大小(4)与有效对齐值(4)较小的那个整数倍，那就是4，中间补2</span></span><br><span class="line"><span class="comment">// 第三个数据是 char c; offset是成员大小(1)与有效对齐值(4)较小的那个整数倍，5比8小，紧挨着放</span></span><br><span class="line"><span class="comment">// 结构体总大小是有效对齐值的整数倍，此时P2的大小是 2(s) + 2(补) + 4(x) + 1(c) = 9，对齐最小整数倍是 12 = 4 * 3，所以后面再补3</span></span><br></pre></td></tr></tbody></table></figure>

<p>在程序中加了那个宏就不一样了</p>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">P1</span> {</span></span><br><span class="line">        <span class="keyword">int</span> x;</span><br><span class="line">        <span class="keyword">char</span> c;</span><br><span class="line">        <span class="keyword">short</span> s;</span><br><span class="line">    } P1;</span><br><span class="line">    P1 p1 = {<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>};</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> pack(2)  <span class="comment">// 按2字节对齐</span></span></span><br><span class="line">    <span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">P2</span> {</span></span><br><span class="line">        <span class="keyword">char</span> c;</span><br><span class="line">        <span class="keyword">int</span> x;</span><br><span class="line">        <span class="keyword">short</span> s;</span><br><span class="line">    } P2;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> pack()  <span class="comment">// 取消指定对齐，恢复默认对齐</span></span></span><br><span class="line">    P2 p2 = {<span class="number">2</span>, <span class="number">1</span>, <span class="number">3</span>};</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"sizeof(P1): %lld\n"</span>, <span class="keyword">sizeof</span>(P1));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"sizeof(P2): %lld\n"</span>, <span class="keyword">sizeof</span>(P2));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br><span class="line"><span class="comment">/* output</span></span><br><span class="line"><span class="comment">sizeof(P1): 8</span></span><br><span class="line"><span class="comment">sizeof(P2): 8</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></tbody></table></figure>

<p>那么为啥要内存对齐？经过搜索我们知道了，和CPU读取数据的效率有关，假设CPU一次能读取4个字节的数据，这时候没有内存对齐，都揉在一起了，比如P2那种情况，想要获取中间的x值，先要读取前4个字节数据，并且还要把第一个字节数据剔除掉，因为那是char的，然后再读取后面的4个字节，完了还得把后面3个去掉，最后把前面3个和后面一个拼起来才是我们想要的x的值，这工作量太大了</p>
<p><strong>正确处理内存对齐</strong></p>
<p>数组：按照基本数据类型对齐，第一个对齐了后面的自然也就对齐了。<br>联合：按其包含的长度最大的数据类型对齐。<br>结构体：结构体中每个数据类型都要对齐。</p>
<p>建议非必要不修改默认对齐值</p>
<p><strong>什么时候需要设置对齐</strong></p>
<p>在设计不同CPU下的通信协议时，或者编写硬件驱动程序时寄存器的结构这两个地方都需要按一字节对齐。即使看起来本来就自然对齐的也要使其对齐，以免不同的编译器生成的代码不一样。</p>
<p><strong>针对字节对齐，我们在编程中如何考虑</strong></p>
<p>1 如果在编程的时候要考虑节约空间的话，那么基本的原则就是把结构中的变量按照类型大小从小到大声明，尽量减少中间的填补空间</p>
<p>2 以空间换取时间的效率，我们显示的进行填补空间进行对齐，比如：有一种使用空间换时间做法是显式的插入reserved成员</p>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">A</span>{</span></span><br><span class="line">    <span class="keyword">char</span> a;</span><br><span class="line">    <span class="keyword">char</span> reserved[<span class="number">3</span>];  <span class="comment">// 使用空间换时间</span></span><br><span class="line">    <span class="keyword">int</span> b;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>reserved成员对我们的程序没有什么意义，它只是起到填补空间以达到字节对齐的目的，当然即使不加这个成员通常编译器也会给我们自动填补对齐，我们自己加上它只是起到显式的提醒作用</p>
<p><strong>如何修改编译器的默认对齐值</strong></p>
<p>除了上面用的<code>#pragma pack(n)</code>，还有另外一种方式，<code>__attribute((aligned (n)))</code>，让所作用的结构成员对齐在n字节自然边界上。如果结构中有成员的长度大于n，则按照最大成员的长度来对齐。<code>__attribute__ ((packed))</code>，取消结构在编译过程中的优化对齐，按照实际占用字节数进行对齐</p>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">P1</span> {</span></span><br><span class="line">    <span class="keyword">int</span> x;</span><br><span class="line">    <span class="keyword">char</span> c;</span><br><span class="line">    <span class="keyword">short</span> s;</span><br><span class="line">} __attribute__ ((packed)) P1;</span><br></pre></td></tr></tbody></table></figure>

<p><strong>字节对齐可能带来的隐患</strong></p>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> i = <span class="number">0x12345678</span>;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> *p = <span class="literal">NULL</span>;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">short</span> *p1 = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">p = &i;</span><br><span class="line">*p = <span class="number">0x00</span>;</span><br><span class="line">p1 = (<span class="keyword">unsigned</span> <span class="keyword">short</span> *) (p + <span class="number">1</span>);</span><br><span class="line">*p1 = <span class="number">0x0000</span>;</span><br></pre></td></tr></tbody></table></figure>

<p>最后两句代码，从奇数边界去访问unsignedshort型变量，显然不符合对齐的规定</p>
<p>在x86上，类似的操作只会影响效率，但是在MIPS或者sparc上，可能就是一个error，因为它们要求必须字节对齐</p>
<h2 id="3-2-位字段"><a href="#3-2-位字段" class="headerlink" title="3.2 位字段"></a>3.2 位字段</h2><p>位字段（bit-field）是一个由具有特定数量的位组成的整数变量</p>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> {</span></span><br><span class="line">    <span class="keyword">unsigned</span> x:<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">unsigned</span> y:<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">unsigned</span> z:<span class="number">1</span>;</span><br><span class="line">} flag;</span><br><span class="line"></span><br><span class="line">flag f = {<span class="number">0b1</span>, <span class="number">0b1</span>, <span class="number">0b1</span>};</span><br><span class="line"><span class="comment">// printf("%p", &(f.x));  error: Address of bit-field requested</span></span><br></pre></td></tr></tbody></table></figure>

<p>这里就限制了x,y,z只有两种取值方式，0 or 1</p>
<p>位字段的声明格式为：<code>类型[成员名称]：宽度;</code><br>各部分的详细描述如下：</p>
<p>(1) 类型<br>指定一个整数类型，用来决定该位字段值被解释的方式。类型可以是 _Bool、int、signed int、unsigned int，或者为所选实现版本所提供的类型。这里的类型也可以包含类型限定符。</p>
<p>具有 signed int 类型的位字段会被解释成有符号数；具有 unsigned int 类型的位字段会被解释成无符号数。具有 int 类型的位字段可以是有符号或无符号的类型，由编译器决定。</p>
<p>(2) 成员名称<br>成员名称是可选的（可以不写）。但是，如果声明了一个无名称的位字段，就没有办法获取它。没有名称的位字段只能用于填充（padding），以帮助后续的位字段在机器字中对齐到特定的地址边界。</p>
<p>(3) 宽度<br>位字段中位的数量。宽度必须是一个常量整数表达式，其值是非负的，并且必须小于或等于指定类型的位宽。无名称位字段的宽度可以是 0。在这种情况下，下一个声明的位字段就会从新的可寻址内存单元开始。</p>
<p>呃，感觉没啥好介绍的..</p>
<p><strong>字段不是数组，并且没有地址，因此不能对它们使用 & 运算符</strong></p>
<h2 id="3-3-零长数组"><a href="#3-3-零长数组" class="headerlink" title="3.3 零长数组"></a>3.3 零长数组</h2><p>看一个程序吧</p>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> {</span></span><br><span class="line">        <span class="keyword">int</span> len;</span><br><span class="line">        <span class="keyword">char</span>* data;</span><br><span class="line">    } STR1;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> {</span></span><br><span class="line">        <span class="keyword">int</span> len;</span><br><span class="line">        <span class="keyword">char</span> data[<span class="number">0</span>];</span><br><span class="line">    } STR2;</span><br><span class="line"></span><br><span class="line">    STR1 str1 = {};</span><br><span class="line">    STR2 str2 = {};</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"STR1: %llu\n"</span>, <span class="keyword">sizeof</span>(STR1));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"STR2: %llu\n"</span>, <span class="keyword">sizeof</span>(STR2));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br><span class="line"><span class="comment">/* output</span></span><br><span class="line"><span class="comment">STR1: 16</span></span><br><span class="line"><span class="comment">STR2: 4</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></tbody></table></figure>

<p>这么一看，差距还挺大的，对不对，汇编一下</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">main:</span><br><span class="line">    pushq    %rbp</span><br><span class="line">    ...</span><br><span class="line">    .seh_endprologue</span><br><span class="line">    call    __main</span><br><span class="line">    movq    $0, -16(%rbp)  # STR1.len</span><br><span class="line">    movq    $0, -8(%rbp)   # STR1.data</span><br><span class="line">    movl    $0, -20(%rbp)  # STR2.len</span><br><span class="line">    movl    $16, %edx</span><br><span class="line">    leaq    .LC0(%rip), %rcx</span><br><span class="line">    call    printf</span><br><span class="line">    movl    $4, %edx</span><br><span class="line">    leaq    .LC1(%rip), %rcx</span><br><span class="line">    call    printf</span><br><span class="line">    movl    $0, %eax</span><br><span class="line">    addq    $64, %rsp</span><br><span class="line">    popq    %rbp</span><br><span class="line">    ret</span><br></pre></td></tr></tbody></table></figure>

<p>为什么是16，能想得明白哈，中间补了4个。零长数组优点</p>
<p>第一，节省内存。从上面的例子中可以看出，零长度数组不占用内存空间，而指针却占用内存空间。</p>
<p>第二，方便内存释放。如果我们的代码是在一个给别人用的函数中，你在里面做了二次内存分配，并把整个结构体返回给用户。用户调用free可以释放结构体，但是用户并不知道这个结构体内的成员也需要free，所以你不能指望用户来发现这个事。所以，如果我们把结构体的内存以及其成员要的内存一次性分配好了，并返回给用户一个结构体指针，用户做一次free就可以把所有的内存也给释放掉。</p>
<p>第三，这样有利于访问速度。连续的内存有益于提高访问速度，也有益于减少内存碎片。</p>
<p>但是有个缺点，在结构体中，数组为0的数组必须在最后声明，使用上有一定限制。</p>
<p>我发现一个有意思的事情，下面这程序..</p>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> {</span></span><br><span class="line">        <span class="keyword">char</span>* data;</span><br><span class="line">        <span class="keyword">int</span> len;</span><br><span class="line">    } STR1;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> {</span></span><br><span class="line">        <span class="keyword">int</span> len;</span><br><span class="line">        <span class="keyword">char</span> data[<span class="number">0</span>];</span><br><span class="line">    } STR2;</span><br><span class="line"></span><br><span class="line">    STR1 str1 = {};</span><br><span class="line">    STR2 str2 = {};</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(str1.data) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"--before STR1--\n"</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"--%s\n"</span>, str1.data);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"--before STR1--\n"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!str2.data) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"--before STR2--\n"</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"--%s\n"</span>, str2.data);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"--before STR2--\n"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br><span class="line"><span class="comment">/* output</span></span><br><span class="line"><span class="comment">--before STR1--</span></span><br><span class="line"><span class="comment">--(null)</span></span><br><span class="line"><span class="comment">--before STR1--</span></span><br><span class="line"><span class="comment">--before STR2--</span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">--before STR2--</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></tbody></table></figure>

<h2 id="3-4-结构体指针"><a href="#3-4-结构体指针" class="headerlink" title="3.4 结构体指针"></a>3.4 结构体指针</h2><p>这个其实没啥好说的，主要就是认识一下两个运算符”.”和”->”，正好使用一下0长数组</p>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> {</span></span><br><span class="line">        <span class="keyword">int</span> len;</span><br><span class="line">        <span class="keyword">char</span> data[<span class="number">0</span>];</span><br><span class="line">    } STR;</span><br><span class="line"></span><br><span class="line">    STR *str = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="comment">// 一次开辟</span></span><br><span class="line">    <span class="keyword">if</span> ((str = (STR *)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(STR) + <span class="keyword">sizeof</span>(<span class="keyword">char</span>) * <span class="number">10</span>)) != <span class="literal">NULL</span>) {</span><br><span class="line">        str->len = <span class="number">10</span>;</span><br><span class="line">        <span class="built_in">memcpy</span>(str->data, <span class="string">"hello!"</span>, str->len);</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">// 如果是结构体对象就用 . 如果是指针就用 -></span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"len: %d, data: %s\n"</span>, (*str).len, str->data);</span><br><span class="line">    <span class="comment">// 一次销毁</span></span><br><span class="line">    <span class="built_in">free</span>(str);</span><br><span class="line">    str = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>其他的，好像也没啥了</p>
<h1 id="5-联合与枚举"><a href="#5-联合与枚举" class="headerlink" title="5 联合与枚举"></a>5 联合与枚举</h1><p>union和enum，这俩</p>
<p>结构体和共用体的区别在于：结构体的各个成员会占用不同的内存，互相之间没有影响；而共用体的所有成员占用同一段内存，修改一个成员会影响其余所有成员。</p>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">typedef</span> <span class="keyword">union</span> {</span><br><span class="line">        <span class="keyword">int</span> a;</span><br><span class="line">        <span class="keyword">short</span> b;</span><br><span class="line">        <span class="keyword">char</span> c;</span><br><span class="line">    } U;</span><br><span class="line"></span><br><span class="line">    U u = {<span class="number">1</span>};</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%d, %d, %d\n"</span>, u.a, u.b, u.c);</span><br><span class="line">    u.b = <span class="number">2</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%d, %d, %d\n"</span>, u.a, u.b, u.c);</span><br><span class="line">    u.c = <span class="number">3</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%d, %d, %d\n"</span>, u.a, u.b, u.c);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%p\n%p\n%p\n%p\n"</span>, &u, &u.a, &u.b, &u.c);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br><span class="line"><span class="comment">/* output</span></span><br><span class="line"><span class="comment">1, 1, 1</span></span><br><span class="line"><span class="comment">2, 2, 2</span></span><br><span class="line"><span class="comment">3, 3, 3</span></span><br><span class="line"><span class="comment">000000000063FE1C</span></span><br><span class="line"><span class="comment">000000000063FE1C</span></span><br><span class="line"><span class="comment">000000000063FE1C</span></span><br><span class="line"><span class="comment">000000000063FE1C</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></tbody></table></figure>

<p>汇编一下</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">main:</span><br><span class="line">    pushq    %rbp</span><br><span class="line">    ...</span><br><span class="line">    .seh_endprologue</span><br><span class="line">    call    __main</span><br><span class="line">    movl    $1, -4(%rbp)    # u.a = 1</span><br><span class="line">    movzbl    -4(%rbp), %eax</span><br><span class="line">    movsbl    %al, %ecx</span><br><span class="line">    movzwl    -4(%rbp), %eax</span><br><span class="line">    movswl    %ax, %edx</span><br><span class="line">    movl    -4(%rbp), %eax</span><br><span class="line">    movl    %ecx, %r9d</span><br><span class="line">    movl    %edx, %r8d</span><br><span class="line">    movl    %eax, %edx</span><br><span class="line">    leaq    .LC0(%rip), %rcx</span><br><span class="line">    call    printf</span><br><span class="line">    movw    $2, -4(%rbp)     # u.b = 2</span><br><span class="line">    ...</span><br><span class="line">    movb    $3, -4(%rbp)      # u.c = 3</span><br><span class="line">    ...</span><br><span class="line">    movl    $0, %eax</span><br><span class="line">    addq    $48, %rsp</span><br><span class="line">    popq    %rbp</span><br><span class="line">    ret</span><br></pre></td></tr></tbody></table></figure>

<p>实际上union就是struct，只不过union所有的成员相对于基地址的偏移量都是0</p>
<p>再看enum</p>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> week{ Mon, Tues, Wed, Thurs, Fri, Sat, Sun };</span><br></pre></td></tr></tbody></table></figure>

<p>仅仅给出了名字，却没有给出名字对应的值，这是因为枚举值默认从0开始，往后逐个加（递增）；也就是说，week中的Mon、Tues … Sun 对应的值分别为 0、1 … 6。</p>
<p>枚举和宏其实非常类似：宏在预处理阶段将名字替换成对应的值，枚举在编译阶段将名字替换成对应的值。我们可以将枚举理解为编译阶段的宏</p>
<p>枚举列表中的 Mon、Tues、Wed 这些标识符的作用范围是全局的（严格来说是 main() 函数内部），不能再定义与它们名字相同的变量</p>
<p>Mon、Tues、Wed 等都是常量，不能对它们赋值，只能将它们的值赋给其他的变量</p>
<p>Mon、Tues、Wed 这些名字都被替换成了对应的数字。这意味着，Mon、Tues、Wed 等都不是变量，它们不占用数据区（常量区、全局数据区、栈区和堆区）的内存，而是直接被编译到命令里面，放到代码区，所以不能用<code>&</code>取得它们的地址。这就是枚举的本质</p>
</body></html>
    </div>

    
    
    
      


      <div style="text-align:center;color:#636363;font-size:14px;">------- This article is over <i class="fa fa-leaf" aria-hidden="true"></i> Thank you for your reading -------</div>
        
      
        <div id="reward-container">
  <div>All I need is you needing me.</div>
  <button id="reward-button" disable="enable" onclick="var qr = document.getElementById(&quot;qr&quot;); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
    Donate
  </button>
  <div id="qr" style="display: none;">
        
      
      <div style="display: inline-block">
        <img src="/images/wechatpay.png" alt="Sidney Ding WeChat Pay">
        <p>WeChat Pay</p>
      </div>
        
      
      <div style="display: inline-block">
        <img src="/images/alipay.jpg" alt="Sidney Ding Alipay">
        <p>Alipay</p>
      </div>

  </div>
</div>

      
        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>Post author:  </strong>Sidney Ding</li>
  <li class="post-copyright-link">
    <strong>Post link: </strong>
    <a href="https://sidneygod.github.io/posts/61dcf29f/" title="[Relearning C&#x2F;Cpp] Array and Pointer">https://sidneygod.github.io/posts/61dcf29f/</a>
  </li>
  <li class="post-copyright-license">
    <strong>Copyright Notice:  </strong>All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i>BY-NC-SA</a> unless stating additionally.</li>
</ul>
</div>

      

      <footer class="post-footer">
          
            
          
          <div class="post-tags">
            
              <a href="/tags/C/" rel="tag"><i class="fa fa-tag"></i> C</a>
            
              <a href="/tags/Cpp/" rel="tag"><i class="fa fa-tag"></i> Cpp</a>
            
          </div>
        

        

          <div class="post-nav">
            <div class="post-nav-next post-nav-item">
              
                <a href="/posts/5d13faf3/" rel="next" title="Build a leanote server">
                  <i class="fa fa-chevron-left"></i> Build a leanote server
                </a>
              
            </div>

            <span class="post-nav-divider"></span>

            <div class="post-nav-prev post-nav-item">
              
                <a href="/posts/e4de57a8/" rel="prev" title="[Relearning C/Cpp] Initialization and Functions">
                  [Relearning C/Cpp] Initialization and Functions <i class="fa fa-chevron-right"></i>
                </a>
              
            </div>
          </div>
        
      </footer>
    
  </div>
  
  
  
  </article>

  </div>


          </div>
          
    
    <div class="comments" id="comments"></div>
  

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">
        
        
        
        
      

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Catalogue
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#1-数组"><span class="nav-text">1 数组</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2-指针"><span class="nav-text">2 指针</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#2-1-指针和数组"><span class="nav-text">2.1 指针和数组</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-2-指针运算"><span class="nav-text">2.2 指针运算</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#3-引用"><span class="nav-text">3 引用</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#3-1-左值引用"><span class="nav-text">3.1 左值引用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-2-右值引用"><span class="nav-text">3.2 右值引用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-3-引用的引用"><span class="nav-text">3.3 引用的引用</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#4-结构"><span class="nav-text">4 结构</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#3-1-内存对齐"><span class="nav-text">3.1 内存对齐</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-2-位字段"><span class="nav-text">3.2 位字段</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-3-零长数组"><span class="nav-text">3.3 零长数组</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-4-结构体指针"><span class="nav-text">3.4 结构体指针</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#5-联合与枚举"><span class="nav-text">5 联合与枚举</span></a></li></ol></div>
        
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <a href="#">
      <img class="site-author-image" itemprop="image"
        src="/images/avatar.png"
        alt="Sidney Ding">
    </a>
  <p class="site-author-name" itemprop="name">Sidney Ding</p>
  <div class="site-description" itemprop="description">You laugh at me for being different, but I laugh at you for being the same.</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives">
        <!--
        
          <a href="/archives/%20%7C%7C%20archive">
        
        -->
          <span class="site-state-item-count">20</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
    
      
      
      <div class="site-state-item site-state-categories">
        
            <a href="/categories/">
          <!--
          
            <a href="/categories/%20%7C%7C%20th">
          
          -->
        
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">categories</span>
        </a>
      </div>
    
      
      
      <div class="site-state-item site-state-tags">
        
            <a href="/tags/">
          <!--
          
            <a href="/tags/%20%7C%7C%20tags">
          
          -->
        
        <span class="site-state-item-count">20</span>
        <span class="site-state-item-name">tags</span>
        </a>
      </div>
    
  </nav>
</div>
  <div class="feed-link motion-element">
    <a href="/atom.xml" rel="alternate">
      <i class="fa fa-rss"></i>RSS
    </a>
  </div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
      
      
        
      
      
        
      
        <a href="https://github.com/SidneyGod" title="GitHub &amp;rarr; https:&#x2F;&#x2F;github.com&#x2F;SidneyGod" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
    
      <span class="links-of-author-item">
      
      
        
      
      
        
      
        <a href="mailto:sidneyding183@gmail.com" title="E-Mail &amp;rarr; mailto:sidneyding183@gmail.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
      </span>
    
  </div>
  <div class="cc-license motion-element" itemprop="license">
    
  
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title">
      <i class="fa fa-fw fa-link"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://google.com/" title="https:&#x2F;&#x2F;google.com" rel="noopener" target="_blank">Google</a>
        </li>
      
        <li class="links-of-blogroll-item">
          <a href="https://bing.com/" title="https:&#x2F;&#x2F;bing.com" rel="noopener" target="_blank">Bing</a>
        </li>
      
    </ul>
  </div>

      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
      

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>
    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2019 – <span itemprop="copyrightYear">2021</span>
  <span class="with-love" id="animate">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Sidney Ding</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
      <span class="post-meta-item-text">Symbols count total: </span>
    
    <span title="Symbols count total">216k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span class="post-meta-item-text">Reading time total &asymp;</span>
    
    <span title="Reading time total">6:01</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> v4.2.0</div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">Theme – <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> v7.4.1</div>
  <div>
    <span><i class="fa fa-bomb"></i> </span>
    <span id="showDays"></span>
  </div>

<script>
  var seconds = 1000;
  var minutes = seconds * 60;
  var hours = minutes * 60;
  var days = hours * 24;
  var years = days * 365;
  var birthDay = Date.UTC(2019,10,1,00,00,00);
  setInterval(function() {
    var today = new Date();
    var todayYear = today.getFullYear();
    var todayMonth = today.getMonth()+1;
    var todayDate = today.getDate();
    var todayHour = today.getHours();
    var todayMinute = today.getMinutes();
    var todaySecond = today.getSeconds();
    var now = Date.UTC(todayYear,todayMonth,todayDate,todayHour,todayMinute,todaySecond);
    var diff = now - birthDay;
    var diffYears = Math.floor(diff/years);
    var diffDays = Math.floor((diff/days)-diffYears*365);
    var diffHours = Math.floor((diff-(diffYears*365+diffDays)*days)/hours);
    var diffMinutes = Math.floor((diff-(diffYears*365+diffDays)*days-diffHours*hours)/minutes);
    var diffSeconds = Math.floor((diff-(diffYears*365+diffDays)*days-diffHours*hours-diffMinutes*minutes)/seconds);
    document.getElementById('showDays').innerHTML="This website has been running for "+diffYears+" years, "+diffDays+" days, "+diffHours+" hours, "+diffMinutes+" minutes, "+diffSeconds+" seconds";
  }, 1000);
</script>

        












        
      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js?v=3.1.0"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/medium-zoom@1/dist/medium-zoom.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/lozad@1/dist/lozad.min.js"></script>
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

<script src="/js/utils.js?v=7.4.1.js"></script>

<script src="/js/motion.js?v=7.4.1.js"></script>


<script src="/js/schemes/pisces.js?v=7.4.1.js"></script>



<script src="/js/next-boot.js?v=7.4.1.js"></script>

<script src="/js/bookmark.js?v=7.4.1.js"></script>


  <script defer src="//cdn.jsdelivr.net/gh/theme-next/theme-next-three@1/three.min.js"></script>
    
    <script defer src="//cdn.jsdelivr.net/gh/theme-next/theme-next-three@latest/three-waves.min.js"></script>
  


  








  
<script src="/js/local-search.js?v=7.4.1.js"></script>









<script>
if (document.querySelectorAll('div.pdf').length) {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/pdfobject@2/pdfobject.min.js', () => {
    document.querySelectorAll('div.pdf').forEach(element => {
      PDFObject.embed(element.getAttribute('target'), element, {
        pdfOpenParams: {
          navpanes: 0,
          toolbar: 0,
          statusbar: 0,
          pagemode: 'thumbs',
          view: 'FitH'
        },
        PDFJS_URL: '/lib/pdf/web/viewer.html',
        height: element.getAttribute('height') || '500px'
      });
    });
  }, window.PDFObject);
}
</script>





    

  

    

    


<script>
NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
  var GUEST = ['nick', 'mail', 'link'];
  var guest = 'nick,mail,link';
  guest = guest.split(',').filter(item => {
    return GUEST.includes(item);
  });
  new Valine({
    el: '#comments',
    verify: true,
    notify: false,
    appId: 'IJiDbg4VAiIeDsIj4MBo39Hq-gzGzoHsz',
    appKey: '0osu23DWjzCzrIVH4Ybe3ihh',
    placeholder: 'Just go go',
    avatar: 'monsterid',
    meta: guest,
    pageSize: '10' || 10,
    visitor: false,
    lang: 'en' || 'zh-cn',
    path: location.pathname,
    recordIP: true,
    serverURLs: ''
  });
}, window.Valine);
</script>


  <canvas id="canvas-rain" style="position: fixed; top: 0px; left: 0px; z-index: -1; opacity: 1;">Canvas is not supported in your browser</canvas>
  <script type="text/javascript" src="/js/rain.js"></script>
  <script async type="text/javascript" src="/js/love.js"></script>
  <script async type="text/javascript" src="/js/fireworks.js"></script>
  
<script>
  var OriginTitile = document.title;
  var titleTime;
  document.addEventListener("visibilitychange", function() {
    if (document.hidden) {
      document.title = "(つェ⊂) 我藏好了哦~" + OriginTitile;
      clearTimeout(titleTime);
    } else {
      document.title = "(*´∇｀*) 被你发现啦~" + OriginTitile;
      titleTime = setTimeout(function() {
        document.title = OriginTitile;
      }, 2000);
    }
  });
</script>

  
  <script src="/js/activate-power-mode.min.js"></script>
  <script>
    POWERMODE.colorful = true;
    POWERMODE.shake = true;
    document.body.addEventListener('input', POWERMODE);
  </script>

</body>
</html>
